<!DOCTYPE html>
<html lang="en" data-accent-color="amber" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>sqlalchemy.sql.schema - Advanced Alchemy</title><link rel="shortcut icon" href="../../../_static/favicon.svg"/><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=83eaa723" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_paramlinks.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/litestar-sphinx-theme.css?v=e9f54662" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="sqlalchemy.sql.schema"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="_static/logo-light.png"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../../_static/logo-light.png" alt="advanced_alchemy" height="28" loading="lazy" />
      <img class="dark-logo" src="../../../_static/logo-dark.png" alt="advanced_alchemy" height="28" loading="lazy" />
      <strong>advanced_alchemy</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../../index.html">Home</a></li>
      <li class="link"><button type="button">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="../../../contribution-guide.html">
                <span>Contributing</span>
                <small>Learn how to contribute to the Advanced Alchemy project</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Advanced Alchemy community</small>
              </a></li><li><a href="https://github.com/litestar-org/.github?tab=coc-ov-file#security-ov-file">
                <span>Security</span>
                <small>Overview of Advanced Alchemy's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://litestar.dev/about/organization">
                <span>Litestar Organization</span>
                <small>Details about the Litestar organization</small>
              </a></li><li><a href="../../../releases.html">
                <span>Releases</span>
                <small>Explore the release process, versioning, and deprecation policy for Advanced Alchemy</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>Release notes</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="../../../changelog.html">
                <span>Changelog</span>
                <small>All changes for Advanced Alchemy</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://discord.gg/litestar">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://github.com/litestar-org/advanced-alchemy/discussions">
                <span>GitHub Discussions</span>
                <small>GitHub Discussions</small>
              </a></li><li><a href="https://stackoverflow.com/questions/tagged/litestar">
                <span>Stack Overflow</span>
                <small>We monitor the <code><b>litestar</b></code> tag on Stack Overflow</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/Litestar-Org">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/litestar-org/advanced-alchemy" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a>
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
  <a href="https://discord.gg/litestar" aria-label="Discord">
    <iconify-icon icon="simple-icons:discord"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/orgs/litestar-org/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/modeling.html">Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/repositories.html">Repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/utilities.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/frameworks/litestar.html">Litestar Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/frameworks/fastapi.html">FastAPI Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/mixins/index.html">mixins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/mixins/unique.html">unique</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/config/index.html">config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/asyncio.html">asyncio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/common.html">common</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/engine.html">engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/sync.html">sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/config/types.html">types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/operations.html">operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/types.html">types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/exceptions.html">exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/utils.html">utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/repository.html">repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/filters.html">filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/service.html">services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/extensions/index.html">extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/litestar/index.html">litestar</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/alembic.html">alembic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/dto.html">dto</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/extensions/litestar/plugins.html">plugin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/sanic.html">sanic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extensions/starlette.html">starlette</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/alembic/index.html">alembic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/alembic/commands.html">commands</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribution-guide.html">Contribution guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/search?q=user%3Alitestar-org+state%3Aopen+label%3A%22good+first+issue%22+++no%3Aassignee+repo%3A%22advanced-alchemy%22&amp;type=issues">Available Issues</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/litestar-org/.github?tab=coc-ov-file#readme">Code of Conduct</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/litestar-org/advanced-alchemy"
  data-type="github" data-user="litestar-org" data-repo="advanced-alchemy">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>litestar-org/advanced-alchemy</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6"><div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">advanced_alchemy</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">sqlalchemy.sql.schema</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for sqlalchemy.sql.schema</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="c1"># sql/schema.py</span>
</span><span data-line="2"><span class="c1"># Copyright (C) 2005-2024 the SQLAlchemy authors and contributors</span>
</span><span data-line="3"><span class="c1"># &lt;see AUTHORS file&gt;</span>
</span><span data-line="4"><span class="c1">#</span>
</span><span data-line="5"><span class="c1"># This module is part of SQLAlchemy and is released under</span>
</span><span data-line="6"><span class="c1"># the MIT License: https://www.opensource.org/licenses/mit-license.php</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">&quot;&quot;&quot;The schema module provides the building blocks for database metadata.</span>
</span><span data-line="9">
</span><span data-line="10"><span class="sd">Each element within this module describes a database entity which can be</span>
</span><span data-line="11"><span class="sd">created and dropped, or is otherwise part of such an entity.  Examples include</span>
</span><span data-line="12"><span class="sd">tables, columns, sequences, and indexes.</span>
</span><span data-line="13">
</span><span data-line="14"><span class="sd">All entities are subclasses of :class:`~sqlalchemy.schema.SchemaItem`, and as</span>
</span><span data-line="15"><span class="sd">defined in this module they are intended to be agnostic of any vendor-specific</span>
</span><span data-line="16"><span class="sd">constructs.</span>
</span><span data-line="17">
</span><span data-line="18"><span class="sd">A collection of entities are grouped into a unit called</span>
</span><span data-line="19"><span class="sd">:class:`~sqlalchemy.schema.MetaData`. MetaData serves as a logical grouping of</span>
</span><span data-line="20"><span class="sd">schema elements, and can also be associated with an actual database connection</span>
</span><span data-line="21"><span class="sd">such that operations involving the contained elements can contact the database</span>
</span><span data-line="22"><span class="sd">as needed.</span>
</span><span data-line="23">
</span><span data-line="24"><span class="sd">Two of the elements here also build upon their &quot;syntactic&quot; counterparts, which</span>
</span><span data-line="25"><span class="sd">are defined in :class:`~sqlalchemy.sql.expression.`, specifically</span>
</span><span data-line="26"><span class="sd">:class:`~sqlalchemy.schema.Table` and :class:`~sqlalchemy.schema.Column`.</span>
</span><span data-line="27"><span class="sd">Since these objects are part of the SQL expression language, they are usable</span>
</span><span data-line="28"><span class="sd">as components in SQL expressions.</span>
</span><span data-line="29">
</span><span data-line="30"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="31"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span data-line="32">
</span><span data-line="33"><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span>
</span><span data-line="34"><span class="kn">import</span> <span class="nn">collections</span>
</span><span data-line="35"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span><span data-line="36"><span class="kn">import</span> <span class="nn">operator</span>
</span><span data-line="37"><span class="kn">import</span> <span class="nn">typing</span>
</span><span data-line="38"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
</span><span data-line="39"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
</span><span data-line="40"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span>
</span><span data-line="41"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Collection</span>
</span><span data-line="42"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
</span><span data-line="43"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
</span><span data-line="44"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span>
</span><span data-line="45"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span><span data-line="46"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span>
</span><span data-line="47"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NoReturn</span>
</span><span data-line="48"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
</span><span data-line="49"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>
</span><span data-line="50"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span> <span class="k">as</span> <span class="n">_typing_Sequence</span>
</span><span data-line="51"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
</span><span data-line="52"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
</span><span data-line="53"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="54"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
</span><span data-line="55"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span data-line="56">
</span><span data-line="57"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">coercions</span>
</span><span data-line="58"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ddl</span>
</span><span data-line="59"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">roles</span>
</span><span data-line="60"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">type_api</span>
</span><span data-line="61"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">visitors</span>
</span><span data-line="62"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_DefaultDescriptionTuple</span>
</span><span data-line="63"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_NoArg</span>
</span><span data-line="64"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_NoneName</span>
</span><span data-line="65"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_SentinelColumnCharacterization</span>
</span><span data-line="66"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_SentinelDefaultCharacterization</span>
</span><span data-line="67"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">DedupeColumnCollection</span>
</span><span data-line="68"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">DialectKWArgs</span>
</span><span data-line="69"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">Executable</span>
</span><span data-line="70"><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">SchemaEventTarget</span> <span class="k">as</span> <span class="n">SchemaEventTarget</span>
</span><span data-line="71"><span class="kn">from</span> <span class="nn">.coercions</span> <span class="kn">import</span> <span class="n">_document_text_coercion</span>
</span><span data-line="72"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ClauseElement</span>
</span><span data-line="73"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ColumnClause</span>
</span><span data-line="74"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">ColumnElement</span>
</span><span data-line="75"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">quoted_name</span>
</span><span data-line="76"><span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">TextClause</span>
</span><span data-line="77"><span class="kn">from</span> <span class="nn">.selectable</span> <span class="kn">import</span> <span class="n">TableClause</span>
</span><span data-line="78"><span class="kn">from</span> <span class="nn">.type_api</span> <span class="kn">import</span> <span class="n">to_instance</span>
</span><span data-line="79"><span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">ExternallyTraversible</span>
</span><span data-line="80"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">event</span>
</span><span data-line="81"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">exc</span>
</span><span data-line="82"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">inspection</span>
</span><span data-line="83"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">util</span>
</span><span data-line="84"><span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">HasMemoized</span>
</span><span data-line="85"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Final</span>
</span><span data-line="86"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Literal</span>
</span><span data-line="87"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Protocol</span>
</span><span data-line="88"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">Self</span>
</span><span data-line="89"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>
</span><span data-line="90"><span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>
</span><span data-line="91">
</span><span data-line="92"><span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="93">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_AutoIncrementType</span>
</span><span data-line="94">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_DDLColumnArgument</span>
</span><span data-line="95">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_InfoType</span>
</span><span data-line="96">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_TextCoercedExpressionArgument</span>
</span><span data-line="97">    <span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="n">_TypeEngineArgument</span>
</span><span data-line="98">    <span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">ReadOnlyColumnCollection</span>
</span><span data-line="99">    <span class="kn">from</span> <span class="nn">.compiler</span> <span class="kn">import</span> <span class="n">DDLCompiler</span>
</span><span data-line="100">    <span class="kn">from</span> <span class="nn">.elements</span> <span class="kn">import</span> <span class="n">BindParameter</span>
</span><span data-line="101">    <span class="kn">from</span> <span class="nn">.functions</span> <span class="kn">import</span> <span class="n">Function</span>
</span><span data-line="102">    <span class="kn">from</span> <span class="nn">.type_api</span> <span class="kn">import</span> <span class="n">TypeEngine</span>
</span><span data-line="103">    <span class="kn">from</span> <span class="nn">.visitors</span> <span class="kn">import</span> <span class="n">anon_map</span>
</span><span data-line="104">    <span class="kn">from</span> <span class="nn">..engine</span> <span class="kn">import</span> <span class="n">Connection</span>
</span><span data-line="105">    <span class="kn">from</span> <span class="nn">..engine</span> <span class="kn">import</span> <span class="n">Engine</span>
</span><span data-line="106">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">_CoreMultiExecuteParams</span>
</span><span data-line="107">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">CoreExecuteOptionsParameter</span>
</span><span data-line="108">    <span class="kn">from</span> <span class="nn">..engine.interfaces</span> <span class="kn">import</span> <span class="n">ExecutionContext</span>
</span><span data-line="109">    <span class="kn">from</span> <span class="nn">..engine.mock</span> <span class="kn">import</span> <span class="n">MockConnection</span>
</span><span data-line="110">    <span class="kn">from</span> <span class="nn">..engine.reflection</span> <span class="kn">import</span> <span class="n">_ReflectionInfo</span>
</span><span data-line="111">    <span class="kn">from</span> <span class="nn">..sql.selectable</span> <span class="kn">import</span> <span class="n">FromClause</span>
</span><span data-line="112">
</span><span data-line="113"><span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Any&quot;</span><span class="p">)</span>
</span><span data-line="114"><span class="n">_SI</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_SI&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;SchemaItem&quot;</span><span class="p">)</span>
</span><span data-line="115"><span class="n">_TAB</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_TAB&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s2">&quot;Table&quot;</span><span class="p">)</span>
</span><span data-line="116">
</span><span data-line="117">
</span><span data-line="118"><span class="n">_CreateDropBind</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Engine&quot;</span><span class="p">,</span> <span class="s2">&quot;Connection&quot;</span><span class="p">,</span> <span class="s2">&quot;MockConnection&quot;</span><span class="p">]</span>
</span><span data-line="119">
</span><span data-line="120"><span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_NoneName</span><span class="p">]]</span>
</span><span data-line="121">
</span><span data-line="122"><span class="n">_ServerDefaultArgument</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span data-line="123">    <span class="s2">&quot;FetchedValue&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span data-line="124"><span class="p">]</span>
</span><span data-line="125">
</span><span data-line="126"><span class="n">_ServerOnUpdateArgument</span> <span class="o">=</span> <span class="n">_ServerDefaultArgument</span>
</span><span data-line="127">
</span><span data-line="128">
</span><span data-line="129"><span class="k">class</span> <span class="nc">SchemaConst</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="130">    <span class="n">RETAIN_SCHEMA</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="131"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating that a :class:`_schema.Table`, :class:`.Sequence`</span>
</span><span data-line="132"><span class="sd">    or in some cases a :class:`_schema.ForeignKey` object, in situations</span>
</span><span data-line="133"><span class="sd">    where the object is being copied for a :meth:`.Table.to_metadata`</span>
</span><span data-line="134"><span class="sd">    operation, should retain the schema name that it already has.</span>
</span><span data-line="135">
</span><span data-line="136"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="137">
</span><span data-line="138">    <span class="n">BLANK_SCHEMA</span> <span class="o">=</span> <span class="mi">2</span>
</span><span data-line="139"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating that a :class:`_schema.Table` or :class:`.Sequence`</span>
</span><span data-line="140"><span class="sd">    should have &#39;None&#39; for its schema, even if the parent</span>
</span><span data-line="141"><span class="sd">    :class:`_schema.MetaData` has specified a schema.</span>
</span><span data-line="142">
</span><span data-line="143"><span class="sd">    .. seealso::</span>
</span><span data-line="144">
</span><span data-line="145"><span class="sd">        :paramref:`_schema.MetaData.schema`</span>
</span><span data-line="146">
</span><span data-line="147"><span class="sd">        :paramref:`_schema.Table.schema`</span>
</span><span data-line="148">
</span><span data-line="149"><span class="sd">        :paramref:`.Sequence.schema`</span>
</span><span data-line="150">
</span><span data-line="151"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="152">
</span><span data-line="153">    <span class="n">NULL_UNSPECIFIED</span> <span class="o">=</span> <span class="mi">3</span>
</span><span data-line="154"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol indicating the &quot;nullable&quot; keyword was not passed to a Column.</span>
</span><span data-line="155">
</span><span data-line="156"><span class="sd">    This is used to distinguish between the use case of passing</span>
</span><span data-line="157"><span class="sd">    ``nullable=None`` to a :class:`.Column`, which has special meaning</span>
</span><span data-line="158"><span class="sd">    on some backends such as SQL Server.</span>
</span><span data-line="159">
</span><span data-line="160"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="161">
</span><span data-line="162">
</span><span data-line="163"><span class="n">RETAIN_SCHEMA</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="164">    <span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span>
</span><span data-line="165"><span class="p">)</span>
</span><span data-line="166"><span class="n">BLANK_SCHEMA</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="167">    <span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span>
</span><span data-line="168"><span class="p">)</span>
</span><span data-line="169"><span class="n">NULL_UNSPECIFIED</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="170">    <span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span>
</span><span data-line="171"><span class="p">)</span>
</span><span data-line="172">
</span><span data-line="173">
</span><span data-line="174"><span class="k">def</span> <span class="nf">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="175">    <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="176">        <span class="k">return</span> <span class="n">name</span>
</span><span data-line="177">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="178">        <span class="k">return</span> <span class="n">schema</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span data-line="179">
</span><span data-line="180">
</span><span data-line="181"><span class="c1"># this should really be in sql/util.py but we&#39;d have to</span>
</span><span data-line="182"><span class="c1"># break an import cycle</span>
</span><span data-line="183"><span class="k">def</span> <span class="nf">_copy_expression</span><span class="p">(</span>
</span><span data-line="184">    <span class="n">expression</span><span class="p">:</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span data-line="185">    <span class="n">source_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">],</span>
</span><span data-line="186">    <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">],</span>
</span><span data-line="187"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="188">    <span class="k">if</span> <span class="n">source_table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="189">        <span class="k">return</span> <span class="n">expression</span>
</span><span data-line="190">
</span><span data-line="191">    <span class="n">fixed_source_table</span> <span class="o">=</span> <span class="n">source_table</span>
</span><span data-line="192">    <span class="n">fixed_target_table</span> <span class="o">=</span> <span class="n">target_table</span>
</span><span data-line="193">
</span><span data-line="194">    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span>
</span><span data-line="195">        <span class="n">element</span><span class="p">:</span> <span class="n">ExternallyTraversible</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="196">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ExternallyTraversible</span><span class="p">]:</span>
</span><span data-line="197">        <span class="k">if</span> <span class="p">(</span>
</span><span data-line="198">            <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="199">            <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="n">fixed_source_table</span>
</span><span data-line="200">            <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">fixed_source_table</span><span class="o">.</span><span class="n">c</span>
</span><span data-line="201">        <span class="p">):</span>
</span><span data-line="202">            <span class="k">return</span> <span class="n">fixed_target_table</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="203">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="204">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="205">
</span><span data-line="206">    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span>
</span><span data-line="207">        <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span data-line="208">        <span class="n">visitors</span><span class="o">.</span><span class="n">replacement_traverse</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="p">{},</span> <span class="n">replace</span><span class="p">),</span>
</span><span data-line="209">    <span class="p">)</span>
</span><span data-line="210">
</span><span data-line="211">
</span><span data-line="212"><span class="nd">@inspection</span><span class="o">.</span><span class="n">_self_inspects</span>
</span><span data-line="213"><span class="k">class</span> <span class="nc">SchemaItem</span><span class="p">(</span><span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="n">visitors</span><span class="o">.</span><span class="n">Visitable</span><span class="p">):</span>
</span><span data-line="214"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for items that define a database schema.&quot;&quot;&quot;</span>
</span><span data-line="215">
</span><span data-line="216">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;schema_item&quot;</span>
</span><span data-line="217">
</span><span data-line="218">    <span class="n">create_drop_stringify_dialect</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span data-line="219">
</span><span data-line="220">    <span class="k">def</span> <span class="nf">_init_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaItem</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="221"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the list of child items for this SchemaItem.&quot;&quot;&quot;</span>
</span><span data-line="222">        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span data-line="223">            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="224">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="225">                    <span class="n">spwd</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span>
</span><span data-line="226">                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span data-line="227">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="228">                        <span class="s2">&quot;&#39;SchemaItem&#39; object, such as a &#39;Column&#39; or a &quot;</span>
</span><span data-line="229">                        <span class="sa">f</span><span class="s2">&quot;&#39;Constraint&#39; expected, got </span><span class="si">{</span><span class="n">item</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span data-line="230">                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
</span><span data-line="231">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="232">                    <span class="n">spwd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="233">
</span><span data-line="234">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="235">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">generic_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omit_kwarg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;info&quot;</span><span class="p">])</span>
</span><span data-line="236">
</span><span data-line="237">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span data-line="238">    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InfoType</span><span class="p">:</span>
</span><span data-line="239"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Info dictionary associated with the object, allowing user-defined</span>
</span><span data-line="240"><span class="sd">        data to be associated with this :class:`.SchemaItem`.</span>
</span><span data-line="241">
</span><span data-line="242"><span class="sd">        The dictionary is automatically generated when first accessed.</span>
</span><span data-line="243"><span class="sd">        It can also be specified in the constructor of some objects,</span>
</span><span data-line="244"><span class="sd">        such as :class:`_schema.Table` and :class:`_schema.Column`.</span>
</span><span data-line="245">
</span><span data-line="246"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="247">        <span class="k">return</span> <span class="p">{}</span>
</span><span data-line="248">
</span><span data-line="249">    <span class="k">def</span> <span class="nf">_schema_item_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_item</span><span class="p">:</span> <span class="n">_SI</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_SI</span><span class="p">:</span>
</span><span data-line="250">        <span class="k">if</span> <span class="s2">&quot;info&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
</span><span data-line="251">            <span class="n">schema_item</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="252">        <span class="n">schema_item</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">)</span>
</span><span data-line="253">        <span class="k">return</span> <span class="n">schema_item</span>
</span><span data-line="254">
</span><span data-line="255">    <span class="n">_use_schema_map</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="256">
</span><span data-line="257">
</span><span data-line="258"><span class="k">class</span> <span class="nc">HasConditionalDDL</span><span class="p">:</span>
</span><span data-line="259"><span class="w">    </span><span class="sd">&quot;&quot;&quot;define a class that includes the :meth:`.HasConditionalDDL.ddl_if`</span>
</span><span data-line="260"><span class="sd">    method, allowing for conditional rendering of DDL.</span>
</span><span data-line="261">
</span><span data-line="262"><span class="sd">    Currently applies to constraints and indexes.</span>
</span><span data-line="263">
</span><span data-line="264"><span class="sd">    .. versionadded:: 2.0</span>
</span><span data-line="265">
</span><span data-line="266">
</span><span data-line="267"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="268">
</span><span data-line="269">    <span class="n">_ddl_if</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ddl</span><span class="o">.</span><span class="n">DDLIf</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="270">
</span><span data-line="271">    <span class="k">def</span> <span class="nf">ddl_if</span><span class="p">(</span>
</span><span data-line="272">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="273">        <span class="n">dialect</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="274">        <span class="n">callable_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ddl</span><span class="o">.</span><span class="n">DDLIfCallable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="275">        <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="276">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span data-line="277"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;apply a conditional DDL rule to this schema item.</span>
</span><span data-line="278">
</span><span data-line="279"><span class="sd">        These rules work in a similar manner to the</span>
</span><span data-line="280"><span class="sd">        :meth:`.ExecutableDDLElement.execute_if` callable, with the added</span>
</span><span data-line="281"><span class="sd">        feature that the criteria may be checked within the DDL compilation</span>
</span><span data-line="282"><span class="sd">        phase for a construct such as :class:`.CreateTable`.</span>
</span><span data-line="283"><span class="sd">        :meth:`.HasConditionalDDL.ddl_if` currently applies towards the</span>
</span><span data-line="284"><span class="sd">        :class:`.Index` construct as well as all :class:`.Constraint`</span>
</span><span data-line="285"><span class="sd">        constructs.</span>
</span><span data-line="286">
</span><span data-line="287"><span class="sd">        :param dialect: string name of a dialect, or a tuple of string names</span>
</span><span data-line="288"><span class="sd">         to indicate multiple dialect types.</span>
</span><span data-line="289">
</span><span data-line="290"><span class="sd">        :param callable\_: a callable that is constructed using the same form</span>
</span><span data-line="291"><span class="sd">         as that described in</span>
</span><span data-line="292"><span class="sd">         :paramref:`.ExecutableDDLElement.execute_if.callable_`.</span>
</span><span data-line="293">
</span><span data-line="294"><span class="sd">        :param state: any arbitrary object that will be passed to the</span>
</span><span data-line="295"><span class="sd">         callable, if present.</span>
</span><span data-line="296">
</span><span data-line="297"><span class="sd">        .. versionadded:: 2.0</span>
</span><span data-line="298">
</span><span data-line="299"><span class="sd">        .. seealso::</span>
</span><span data-line="300">
</span><span data-line="301"><span class="sd">            :ref:`schema_ddl_ddl_if` - background and usage examples</span>
</span><span data-line="302">
</span><span data-line="303">
</span><span data-line="304"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="305">        <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span> <span class="o">=</span> <span class="n">ddl</span><span class="o">.</span><span class="n">DDLIf</span><span class="p">(</span><span class="n">dialect</span><span class="p">,</span> <span class="n">callable_</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
</span><span data-line="306">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="307">
</span><span data-line="308">
</span><span data-line="309"><span class="k">class</span> <span class="nc">HasSchemaAttr</span><span class="p">(</span><span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="310"><span class="w">    </span><span class="sd">&quot;&quot;&quot;schema item that includes a top-level schema name&quot;&quot;&quot;</span>
</span><span data-line="311">
</span><span data-line="312">    <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="313">
</span><span data-line="314">
</span><span data-line="315"><span class="k">class</span> <span class="nc">Table</span><span class="p">(</span>
</span><span data-line="316">    <span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">HasSchemaAttr</span><span class="p">,</span> <span class="n">TableClause</span><span class="p">,</span> <span class="n">inspection</span><span class="o">.</span><span class="n">Inspectable</span><span class="p">[</span><span class="s2">&quot;Table&quot;</span><span class="p">]</span>
</span><span data-line="317"><span class="p">):</span>
</span><span data-line="318"><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Represent a table in a database.</span>
</span><span data-line="319">
</span><span data-line="320"><span class="sd">    e.g.::</span>
</span><span data-line="321">
</span><span data-line="322"><span class="sd">        mytable = Table(</span>
</span><span data-line="323"><span class="sd">            &quot;mytable&quot;, metadata,</span>
</span><span data-line="324"><span class="sd">            Column(&#39;mytable_id&#39;, Integer, primary_key=True),</span>
</span><span data-line="325"><span class="sd">            Column(&#39;value&#39;, String(50))</span>
</span><span data-line="326"><span class="sd">        )</span>
</span><span data-line="327">
</span><span data-line="328"><span class="sd">    The :class:`_schema.Table`</span>
</span><span data-line="329"><span class="sd">    object constructs a unique instance of itself based</span>
</span><span data-line="330"><span class="sd">    on its name and optional schema name within the given</span>
</span><span data-line="331"><span class="sd">    :class:`_schema.MetaData` object. Calling the :class:`_schema.Table`</span>
</span><span data-line="332"><span class="sd">    constructor with the same name and same :class:`_schema.MetaData` argument</span>
</span><span data-line="333"><span class="sd">    a second time will return the *same* :class:`_schema.Table`</span>
</span><span data-line="334"><span class="sd">    object - in this way</span>
</span><span data-line="335"><span class="sd">    the :class:`_schema.Table` constructor acts as a registry function.</span>
</span><span data-line="336">
</span><span data-line="337"><span class="sd">    .. seealso::</span>
</span><span data-line="338">
</span><span data-line="339"><span class="sd">        :ref:`metadata_describing` - Introduction to database metadata</span>
</span><span data-line="340">
</span><span data-line="341"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="342">
</span><span data-line="343">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;table&quot;</span>
</span><span data-line="344">
</span><span data-line="345">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="346">
</span><span data-line="347">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="348">        <span class="k">def</span> <span class="nf">primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PrimaryKeyConstraint</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="349">
</span><span data-line="350">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="351">        <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]:</span> <span class="o">...</span>
</span><span data-line="352">
</span><span data-line="353">    <span class="n">_columns</span><span class="p">:</span> <span class="n">DedupeColumnCollection</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="354">
</span><span data-line="355">    <span class="n">_sentinel_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="356">
</span><span data-line="357">    <span class="n">constraints</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]</span>
</span><span data-line="358"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.Constraint` objects associated with</span>
</span><span data-line="359"><span class="sd">      this :class:`_schema.Table`.</span>
</span><span data-line="360">
</span><span data-line="361"><span class="sd">      Includes :class:`_schema.PrimaryKeyConstraint`,</span>
</span><span data-line="362"><span class="sd">      :class:`_schema.ForeignKeyConstraint`, :class:`_schema.UniqueConstraint`,</span>
</span><span data-line="363"><span class="sd">      :class:`_schema.CheckConstraint`.  A separate collection</span>
</span><span data-line="364"><span class="sd">      :attr:`_schema.Table.foreign_key_constraints` refers to the collection</span>
</span><span data-line="365"><span class="sd">      of all :class:`_schema.ForeignKeyConstraint` objects, and the</span>
</span><span data-line="366"><span class="sd">      :attr:`_schema.Table.primary_key` attribute refers to the single</span>
</span><span data-line="367"><span class="sd">      :class:`_schema.PrimaryKeyConstraint` associated with the</span>
</span><span data-line="368"><span class="sd">      :class:`_schema.Table`.</span>
</span><span data-line="369">
</span><span data-line="370"><span class="sd">      .. seealso::</span>
</span><span data-line="371">
</span><span data-line="372"><span class="sd">            :attr:`_schema.Table.constraints`</span>
</span><span data-line="373">
</span><span data-line="374"><span class="sd">            :attr:`_schema.Table.primary_key`</span>
</span><span data-line="375">
</span><span data-line="376"><span class="sd">            :attr:`_schema.Table.foreign_key_constraints`</span>
</span><span data-line="377">
</span><span data-line="378"><span class="sd">            :attr:`_schema.Table.indexes`</span>
</span><span data-line="379">
</span><span data-line="380"><span class="sd">            :class:`_reflection.Inspector`</span>
</span><span data-line="381">
</span><span data-line="382">
</span><span data-line="383"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="384">
</span><span data-line="385">    <span class="n">indexes</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
</span><span data-line="386"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.Index` objects associated with this</span>
</span><span data-line="387"><span class="sd">      :class:`_schema.Table`.</span>
</span><span data-line="388">
</span><span data-line="389"><span class="sd">      .. seealso::</span>
</span><span data-line="390">
</span><span data-line="391"><span class="sd">            :meth:`_reflection.Inspector.get_indexes`</span>
</span><span data-line="392">
</span><span data-line="393"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="394">
</span><span data-line="395">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="396">
</span><span data-line="397">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="398">        <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span> <span class="o">...</span>
</span><span data-line="399">
</span><span data-line="400">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="401">        <span class="k">def</span> <span class="nf">exported_columns</span><span class="p">(</span>
</span><span data-line="402">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="403">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span> <span class="o">...</span>
</span><span data-line="404">
</span><span data-line="405">        <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="406">        <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span> <span class="o">...</span>
</span><span data-line="407">
</span><span data-line="408">    <span class="k">def</span> <span class="nf">_gen_cache_key</span><span class="p">(</span>
</span><span data-line="409">        <span class="bp">self</span><span class="p">,</span> <span class="n">anon_map</span><span class="p">:</span> <span class="n">anon_map</span><span class="p">,</span> <span class="n">bindparams</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BindParameter</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="410">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span data-line="411">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotations</span><span class="p">:</span>
</span><span data-line="412">            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotations_cache_key</span>
</span><span data-line="413">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="414">            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,)</span>
</span><span data-line="415">
</span><span data-line="416">    <span class="k">if</span> <span class="ow">not</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="417">        <span class="c1"># typing tools seem to be inconsistent in how they handle</span>
</span><span data-line="418">        <span class="c1"># __new__, so suggest this pattern for classes that use</span>
</span><span data-line="419">        <span class="c1"># __new__.  apply typing to the __init__ method normally</span>
</span><span data-line="420">        <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated_params</span><span class="p">(</span>
</span><span data-line="421">            <span class="n">mustexist</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="422">                <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="423">                <span class="s2">&quot;Deprecated alias of :paramref:`_schema.Table.must_exist`&quot;</span><span class="p">,</span>
</span><span data-line="424">            <span class="p">),</span>
</span><span data-line="425">        <span class="p">)</span>
</span><span data-line="426">        <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="427">            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="428">
</span><span data-line="429">    <span class="nd">@classmethod</span>
</span><span data-line="430">    <span class="k">def</span> <span class="nf">_new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="431">        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kw</span><span class="p">:</span>
</span><span data-line="432">            <span class="c1"># python3k pickle seems to call this</span>
</span><span data-line="433">            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span data-line="434">
</span><span data-line="435">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="436">            <span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</span><span data-line="437">        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span data-line="438">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span data-line="439">                <span class="s2">&quot;Table() takes at least two positional-only &quot;</span>
</span><span data-line="440">                <span class="s2">&quot;arguments &#39;name&#39; and &#39;metadata&#39;&quot;</span>
</span><span data-line="441">            <span class="p">)</span>
</span><span data-line="442">
</span><span data-line="443">        <span class="n">schema</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="444">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="445">            <span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="446">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span data-line="447">            <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="448">        <span class="n">keep_existing</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keep_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span data-line="449">        <span class="n">extend_existing</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extend_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span data-line="450">
</span><span data-line="451">        <span class="k">if</span> <span class="n">keep_existing</span> <span class="ow">and</span> <span class="n">extend_existing</span><span class="p">:</span>
</span><span data-line="452">            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;keep_existing and extend_existing are mutually exclusive.&quot;</span>
</span><span data-line="453">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span data-line="454">
</span><span data-line="455">        <span class="n">must_exist</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;must_exist&quot;</span><span class="p">,</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mustexist&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span data-line="456">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="457">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span data-line="458">            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_existing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend_existing</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span data-line="459">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="460">                    <span class="sa">f</span><span class="s2">&quot;Table &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; is already defined for this MetaData &quot;</span>
</span><span data-line="461">                    <span class="s2">&quot;instance.  Specify &#39;extend_existing=True&#39; &quot;</span>
</span><span data-line="462">                    <span class="s2">&quot;to redefine &quot;</span>
</span><span data-line="463">                    <span class="s2">&quot;options and columns on an &quot;</span>
</span><span data-line="464">                    <span class="s2">&quot;existing Table object.&quot;</span>
</span><span data-line="465">                <span class="p">)</span>
</span><span data-line="466">            <span class="n">table</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="467">            <span class="k">if</span> <span class="n">extend_existing</span><span class="p">:</span>
</span><span data-line="468">                <span class="n">table</span><span class="o">.</span><span class="n">_init_existing</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="469">            <span class="k">return</span> <span class="n">table</span>
</span><span data-line="470">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="471">            <span class="k">if</span> <span class="n">must_exist</span><span class="p">:</span>
</span><span data-line="472">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; not defined&quot;</span><span class="p">)</span>
</span><span data-line="473">            <span class="n">table</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span data-line="474">            <span class="n">table</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">before_parent_attach</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span data-line="475">            <span class="n">metadata</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="476">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="477">                <span class="n">table</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">_no_init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="478">                <span class="n">table</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">after_parent_attach</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span data-line="479">                <span class="k">return</span> <span class="n">table</span>
</span><span data-line="480">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="481">                <span class="k">with</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_reraise</span><span class="p">():</span>
</span><span data-line="482">                    <span class="n">metadata</span><span class="o">.</span><span class="n">_remove_table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="483">
</span><span data-line="484">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="485">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="486">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="487">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span data-line="488">        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaItem</span><span class="p">,</span>
</span><span data-line="489">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="490">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="491">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="492">        <span class="n">autoload_with</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="493">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="494">        <span class="n">keep_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="495">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="496">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="497">        <span class="n">include_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="498">        <span class="n">implicit_returning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="499">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="500">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="501">        <span class="n">listeners</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="502">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span>
</span><span data-line="503">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="504">        <span class="n">prefixes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="505">        <span class="c1"># used internally in the metadata.reflect() process</span>
</span><span data-line="506">        <span class="n">_extend_on</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="507">        <span class="c1"># used by __new__ to bypass __init__</span>
</span><span data-line="508">        <span class="n">_no_init</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="509">        <span class="c1"># dialect-specific keyword args</span>
</span><span data-line="510">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="511">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="512"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for :class:`_schema.Table`.</span>
</span><span data-line="513">
</span><span data-line="514">
</span><span data-line="515"><span class="sd">        :param name: The name of this table as represented in the database.</span>
</span><span data-line="516">
</span><span data-line="517"><span class="sd">            The table name, along with the value of the ``schema`` parameter,</span>
</span><span data-line="518"><span class="sd">            forms a key which uniquely identifies this :class:`_schema.Table`</span>
</span><span data-line="519"><span class="sd">            within</span>
</span><span data-line="520"><span class="sd">            the owning :class:`_schema.MetaData` collection.</span>
</span><span data-line="521"><span class="sd">            Additional calls to :class:`_schema.Table` with the same name,</span>
</span><span data-line="522"><span class="sd">            metadata,</span>
</span><span data-line="523"><span class="sd">            and schema name will return the same :class:`_schema.Table` object.</span>
</span><span data-line="524">
</span><span data-line="525"><span class="sd">            Names which contain no upper case characters</span>
</span><span data-line="526"><span class="sd">            will be treated as case insensitive names, and will not be quoted</span>
</span><span data-line="527"><span class="sd">            unless they are a reserved word or contain special characters.</span>
</span><span data-line="528"><span class="sd">            A name with any number of upper case characters is considered</span>
</span><span data-line="529"><span class="sd">            to be case sensitive, and will be sent as quoted.</span>
</span><span data-line="530">
</span><span data-line="531"><span class="sd">            To enable unconditional quoting for the table name, specify the flag</span>
</span><span data-line="532"><span class="sd">            ``quote=True`` to the constructor, or use the :class:`.quoted_name`</span>
</span><span data-line="533"><span class="sd">            construct to specify the name.</span>
</span><span data-line="534">
</span><span data-line="535"><span class="sd">        :param metadata: a :class:`_schema.MetaData`</span>
</span><span data-line="536"><span class="sd">            object which will contain this</span>
</span><span data-line="537"><span class="sd">            table.  The metadata is used as a point of association of this table</span>
</span><span data-line="538"><span class="sd">            with other tables which are referenced via foreign key.  It also</span>
</span><span data-line="539"><span class="sd">            may be used to associate this table with a particular</span>
</span><span data-line="540"><span class="sd">            :class:`.Connection` or :class:`.Engine`.</span>
</span><span data-line="541">
</span><span data-line="542"><span class="sd">        :param \*args: Additional positional arguments are used primarily</span>
</span><span data-line="543"><span class="sd">            to add the list of :class:`_schema.Column`</span>
</span><span data-line="544"><span class="sd">            objects contained within this</span>
</span><span data-line="545"><span class="sd">            table. Similar to the style of a CREATE TABLE statement, other</span>
</span><span data-line="546"><span class="sd">            :class:`.SchemaItem` constructs may be added here, including</span>
</span><span data-line="547"><span class="sd">            :class:`.PrimaryKeyConstraint`, and</span>
</span><span data-line="548"><span class="sd">            :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="549">
</span><span data-line="550"><span class="sd">        :param autoload_replace: Defaults to ``True``; when using</span>
</span><span data-line="551"><span class="sd">            :paramref:`_schema.Table.autoload_with`</span>
</span><span data-line="552"><span class="sd">            in conjunction with :paramref:`_schema.Table.extend_existing`,</span>
</span><span data-line="553"><span class="sd">            indicates</span>
</span><span data-line="554"><span class="sd">            that :class:`_schema.Column` objects present in the already-existing</span>
</span><span data-line="555"><span class="sd">            :class:`_schema.Table`</span>
</span><span data-line="556"><span class="sd">            object should be replaced with columns of the same</span>
</span><span data-line="557"><span class="sd">            name retrieved from the autoload process.   When ``False``, columns</span>
</span><span data-line="558"><span class="sd">            already present under existing names will be omitted from the</span>
</span><span data-line="559"><span class="sd">            reflection process.</span>
</span><span data-line="560">
</span><span data-line="561"><span class="sd">            Note that this setting does not impact :class:`_schema.Column` objects</span>
</span><span data-line="562"><span class="sd">            specified programmatically within the call to :class:`_schema.Table`</span>
</span><span data-line="563"><span class="sd">            that</span>
</span><span data-line="564"><span class="sd">            also is autoloading; those :class:`_schema.Column` objects will always</span>
</span><span data-line="565"><span class="sd">            replace existing columns of the same name when</span>
</span><span data-line="566"><span class="sd">            :paramref:`_schema.Table.extend_existing` is ``True``.</span>
</span><span data-line="567">
</span><span data-line="568"><span class="sd">            .. seealso::</span>
</span><span data-line="569">
</span><span data-line="570"><span class="sd">                :paramref:`_schema.Table.autoload_with`</span>
</span><span data-line="571">
</span><span data-line="572"><span class="sd">                :paramref:`_schema.Table.extend_existing`</span>
</span><span data-line="573">
</span><span data-line="574"><span class="sd">        :param autoload_with: An :class:`_engine.Engine` or</span>
</span><span data-line="575"><span class="sd">            :class:`_engine.Connection` object,</span>
</span><span data-line="576"><span class="sd">            or a :class:`_reflection.Inspector` object as returned by</span>
</span><span data-line="577"><span class="sd">            :func:`_sa.inspect`</span>
</span><span data-line="578"><span class="sd">            against one, with which this :class:`_schema.Table`</span>
</span><span data-line="579"><span class="sd">            object will be reflected.</span>
</span><span data-line="580"><span class="sd">            When set to a non-None value, the autoload process will take place</span>
</span><span data-line="581"><span class="sd">            for this table against the given engine or connection.</span>
</span><span data-line="582">
</span><span data-line="583"><span class="sd">            .. seealso::</span>
</span><span data-line="584">
</span><span data-line="585"><span class="sd">                :ref:`metadata_reflection_toplevel`</span>
</span><span data-line="586">
</span><span data-line="587"><span class="sd">                :meth:`_events.DDLEvents.column_reflect`</span>
</span><span data-line="588">
</span><span data-line="589"><span class="sd">                :ref:`metadata_reflection_dbagnostic_types`</span>
</span><span data-line="590">
</span><span data-line="591"><span class="sd">        :param extend_existing: When ``True``, indicates that if this</span>
</span><span data-line="592"><span class="sd">            :class:`_schema.Table` is already present in the given</span>
</span><span data-line="593"><span class="sd">            :class:`_schema.MetaData`,</span>
</span><span data-line="594"><span class="sd">            apply further arguments within the constructor to the existing</span>
</span><span data-line="595"><span class="sd">            :class:`_schema.Table`.</span>
</span><span data-line="596">
</span><span data-line="597"><span class="sd">            If :paramref:`_schema.Table.extend_existing` or</span>
</span><span data-line="598"><span class="sd">            :paramref:`_schema.Table.keep_existing` are not set,</span>
</span><span data-line="599"><span class="sd">            and the given name</span>
</span><span data-line="600"><span class="sd">            of the new :class:`_schema.Table` refers to a :class:`_schema.Table`</span>
</span><span data-line="601"><span class="sd">            that is</span>
</span><span data-line="602"><span class="sd">            already present in the target :class:`_schema.MetaData` collection,</span>
</span><span data-line="603"><span class="sd">            and</span>
</span><span data-line="604"><span class="sd">            this :class:`_schema.Table`</span>
</span><span data-line="605"><span class="sd">            specifies additional columns or other constructs</span>
</span><span data-line="606"><span class="sd">            or flags that modify the table&#39;s state, an</span>
</span><span data-line="607"><span class="sd">            error is raised.  The purpose of these two mutually-exclusive flags</span>
</span><span data-line="608"><span class="sd">            is to specify what action should be taken when a</span>
</span><span data-line="609"><span class="sd">            :class:`_schema.Table`</span>
</span><span data-line="610"><span class="sd">            is specified that matches an existing :class:`_schema.Table`,</span>
</span><span data-line="611"><span class="sd">            yet specifies</span>
</span><span data-line="612"><span class="sd">            additional constructs.</span>
</span><span data-line="613">
</span><span data-line="614"><span class="sd">            :paramref:`_schema.Table.extend_existing`</span>
</span><span data-line="615"><span class="sd">            will also work in conjunction</span>
</span><span data-line="616"><span class="sd">            with :paramref:`_schema.Table.autoload_with` to run a new reflection</span>
</span><span data-line="617"><span class="sd">            operation against the database, even if a :class:`_schema.Table`</span>
</span><span data-line="618"><span class="sd">            of the same name is already present in the target</span>
</span><span data-line="619"><span class="sd">            :class:`_schema.MetaData`; newly reflected :class:`_schema.Column`</span>
</span><span data-line="620"><span class="sd">            objects</span>
</span><span data-line="621"><span class="sd">            and other options will be added into the state of the</span>
</span><span data-line="622"><span class="sd">            :class:`_schema.Table`, potentially overwriting existing columns</span>
</span><span data-line="623"><span class="sd">            and options of the same name.</span>
</span><span data-line="624">
</span><span data-line="625"><span class="sd">            As is always the case with :paramref:`_schema.Table.autoload_with`,</span>
</span><span data-line="626"><span class="sd">            :class:`_schema.Column` objects can be specified in the same</span>
</span><span data-line="627"><span class="sd">            :class:`_schema.Table`</span>
</span><span data-line="628"><span class="sd">            constructor, which will take precedence.  Below, the existing</span>
</span><span data-line="629"><span class="sd">            table ``mytable`` will be augmented with :class:`_schema.Column`</span>
</span><span data-line="630"><span class="sd">            objects</span>
</span><span data-line="631"><span class="sd">            both reflected from the database, as well as the given</span>
</span><span data-line="632"><span class="sd">            :class:`_schema.Column`</span>
</span><span data-line="633"><span class="sd">            named &quot;y&quot;::</span>
</span><span data-line="634">
</span><span data-line="635"><span class="sd">                Table(&quot;mytable&quot;, metadata,</span>
</span><span data-line="636"><span class="sd">                            Column(&#39;y&#39;, Integer),</span>
</span><span data-line="637"><span class="sd">                            extend_existing=True,</span>
</span><span data-line="638"><span class="sd">                            autoload_with=engine</span>
</span><span data-line="639"><span class="sd">                        )</span>
</span><span data-line="640">
</span><span data-line="641"><span class="sd">            .. seealso::</span>
</span><span data-line="642">
</span><span data-line="643"><span class="sd">                :paramref:`_schema.Table.autoload_with`</span>
</span><span data-line="644">
</span><span data-line="645"><span class="sd">                :paramref:`_schema.Table.autoload_replace`</span>
</span><span data-line="646">
</span><span data-line="647"><span class="sd">                :paramref:`_schema.Table.keep_existing`</span>
</span><span data-line="648">
</span><span data-line="649">
</span><span data-line="650"><span class="sd">        :param implicit_returning: True by default - indicates that</span>
</span><span data-line="651"><span class="sd">            RETURNING can be used, typically by the ORM, in order to fetch</span>
</span><span data-line="652"><span class="sd">            server-generated values such as primary key values and</span>
</span><span data-line="653"><span class="sd">            server side defaults, on those backends which support RETURNING.</span>
</span><span data-line="654">
</span><span data-line="655"><span class="sd">            In modern SQLAlchemy there is generally no reason to alter this</span>
</span><span data-line="656"><span class="sd">            setting, except for some backend specific cases</span>
</span><span data-line="657"><span class="sd">            (see :ref:`mssql_triggers` in the SQL Server dialect documentation</span>
</span><span data-line="658"><span class="sd">            for one such example).</span>
</span><span data-line="659">
</span><span data-line="660"><span class="sd">        :param include_columns: A list of strings indicating a subset of</span>
</span><span data-line="661"><span class="sd">            columns to be loaded via the ``autoload`` operation; table columns who</span>
</span><span data-line="662"><span class="sd">            aren&#39;t present in this list will not be represented on the resulting</span>
</span><span data-line="663"><span class="sd">            ``Table`` object. Defaults to ``None`` which indicates all columns</span>
</span><span data-line="664"><span class="sd">            should be reflected.</span>
</span><span data-line="665">
</span><span data-line="666"><span class="sd">        :param resolve_fks: Whether or not to reflect :class:`_schema.Table`</span>
</span><span data-line="667"><span class="sd">            objects</span>
</span><span data-line="668"><span class="sd">            related to this one via :class:`_schema.ForeignKey` objects, when</span>
</span><span data-line="669"><span class="sd">            :paramref:`_schema.Table.autoload_with` is</span>
</span><span data-line="670"><span class="sd">            specified.   Defaults to True.  Set to False to disable reflection of</span>
</span><span data-line="671"><span class="sd">            related tables as :class:`_schema.ForeignKey`</span>
</span><span data-line="672"><span class="sd">            objects are encountered; may be</span>
</span><span data-line="673"><span class="sd">            used either to save on SQL calls or to avoid issues with related tables</span>
</span><span data-line="674"><span class="sd">            that can&#39;t be accessed. Note that if a related table is already present</span>
</span><span data-line="675"><span class="sd">            in the :class:`_schema.MetaData` collection, or becomes present later,</span>
</span><span data-line="676"><span class="sd">            a</span>
</span><span data-line="677"><span class="sd">            :class:`_schema.ForeignKey` object associated with this</span>
</span><span data-line="678"><span class="sd">            :class:`_schema.Table` will</span>
</span><span data-line="679"><span class="sd">            resolve to that table normally.</span>
</span><span data-line="680">
</span><span data-line="681"><span class="sd">            .. versionadded:: 1.3</span>
</span><span data-line="682">
</span><span data-line="683"><span class="sd">            .. seealso::</span>
</span><span data-line="684">
</span><span data-line="685"><span class="sd">                :paramref:`.MetaData.reflect.resolve_fks`</span>
</span><span data-line="686">
</span><span data-line="687">
</span><span data-line="688"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="689"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="690">
</span><span data-line="691"><span class="sd">        :param keep_existing: When ``True``, indicates that if this Table</span>
</span><span data-line="692"><span class="sd">            is already present in the given :class:`_schema.MetaData`, ignore</span>
</span><span data-line="693"><span class="sd">            further arguments within the constructor to the existing</span>
</span><span data-line="694"><span class="sd">            :class:`_schema.Table`, and return the :class:`_schema.Table`</span>
</span><span data-line="695"><span class="sd">            object as</span>
</span><span data-line="696"><span class="sd">            originally created. This is to allow a function that wishes</span>
</span><span data-line="697"><span class="sd">            to define a new :class:`_schema.Table` on first call, but on</span>
</span><span data-line="698"><span class="sd">            subsequent calls will return the same :class:`_schema.Table`,</span>
</span><span data-line="699"><span class="sd">            without any of the declarations (particularly constraints)</span>
</span><span data-line="700"><span class="sd">            being applied a second time.</span>
</span><span data-line="701">
</span><span data-line="702"><span class="sd">            If :paramref:`_schema.Table.extend_existing` or</span>
</span><span data-line="703"><span class="sd">            :paramref:`_schema.Table.keep_existing` are not set,</span>
</span><span data-line="704"><span class="sd">            and the given name</span>
</span><span data-line="705"><span class="sd">            of the new :class:`_schema.Table` refers to a :class:`_schema.Table`</span>
</span><span data-line="706"><span class="sd">            that is</span>
</span><span data-line="707"><span class="sd">            already present in the target :class:`_schema.MetaData` collection,</span>
</span><span data-line="708"><span class="sd">            and</span>
</span><span data-line="709"><span class="sd">            this :class:`_schema.Table`</span>
</span><span data-line="710"><span class="sd">            specifies additional columns or other constructs</span>
</span><span data-line="711"><span class="sd">            or flags that modify the table&#39;s state, an</span>
</span><span data-line="712"><span class="sd">            error is raised.  The purpose of these two mutually-exclusive flags</span>
</span><span data-line="713"><span class="sd">            is to specify what action should be taken when a</span>
</span><span data-line="714"><span class="sd">            :class:`_schema.Table`</span>
</span><span data-line="715"><span class="sd">            is specified that matches an existing :class:`_schema.Table`,</span>
</span><span data-line="716"><span class="sd">            yet specifies</span>
</span><span data-line="717"><span class="sd">            additional constructs.</span>
</span><span data-line="718">
</span><span data-line="719"><span class="sd">            .. seealso::</span>
</span><span data-line="720">
</span><span data-line="721"><span class="sd">                :paramref:`_schema.Table.extend_existing`</span>
</span><span data-line="722">
</span><span data-line="723"><span class="sd">        :param listeners: A list of tuples of the form ``(&lt;eventname&gt;, &lt;fn&gt;)``</span>
</span><span data-line="724"><span class="sd">            which will be passed to :func:`.event.listen` upon construction.</span>
</span><span data-line="725"><span class="sd">            This alternate hook to :func:`.event.listen` allows the establishment</span>
</span><span data-line="726"><span class="sd">            of a listener function specific to this :class:`_schema.Table` before</span>
</span><span data-line="727"><span class="sd">            the &quot;autoload&quot; process begins.  Historically this has been intended</span>
</span><span data-line="728"><span class="sd">            for use with the :meth:`.DDLEvents.column_reflect` event, however</span>
</span><span data-line="729"><span class="sd">            note that this event hook may now be associated with the</span>
</span><span data-line="730"><span class="sd">            :class:`_schema.MetaData` object directly::</span>
</span><span data-line="731">
</span><span data-line="732"><span class="sd">                def listen_for_reflect(table, column_info):</span>
</span><span data-line="733"><span class="sd">                    &quot;handle the column reflection event&quot;</span>
</span><span data-line="734"><span class="sd">                    # ...</span>
</span><span data-line="735">
</span><span data-line="736"><span class="sd">                t = Table(</span>
</span><span data-line="737"><span class="sd">                    &#39;sometable&#39;,</span>
</span><span data-line="738"><span class="sd">                    autoload_with=engine,</span>
</span><span data-line="739"><span class="sd">                    listeners=[</span>
</span><span data-line="740"><span class="sd">                        (&#39;column_reflect&#39;, listen_for_reflect)</span>
</span><span data-line="741"><span class="sd">                    ])</span>
</span><span data-line="742">
</span><span data-line="743"><span class="sd">            .. seealso::</span>
</span><span data-line="744">
</span><span data-line="745"><span class="sd">                :meth:`_events.DDLEvents.column_reflect`</span>
</span><span data-line="746">
</span><span data-line="747"><span class="sd">        :param must_exist: When ``True``, indicates that this Table must already</span>
</span><span data-line="748"><span class="sd">            be present in the given :class:`_schema.MetaData` collection, else</span>
</span><span data-line="749"><span class="sd">            an exception is raised.</span>
</span><span data-line="750">
</span><span data-line="751"><span class="sd">        :param prefixes:</span>
</span><span data-line="752"><span class="sd">            A list of strings to insert after CREATE in the CREATE TABLE</span>
</span><span data-line="753"><span class="sd">            statement.  They will be separated by spaces.</span>
</span><span data-line="754">
</span><span data-line="755"><span class="sd">        :param quote: Force quoting of this table&#39;s name on or off, corresponding</span>
</span><span data-line="756"><span class="sd">            to ``True`` or ``False``.  When left at its default of ``None``,</span>
</span><span data-line="757"><span class="sd">            the column identifier will be quoted according to whether the name is</span>
</span><span data-line="758"><span class="sd">            case sensitive (identifiers with at least one upper case character are</span>
</span><span data-line="759"><span class="sd">            treated as case sensitive), or if it&#39;s a reserved word.  This flag</span>
</span><span data-line="760"><span class="sd">            is only needed to force quoting of a reserved word which is not known</span>
</span><span data-line="761"><span class="sd">            by the SQLAlchemy dialect.</span>
</span><span data-line="762">
</span><span data-line="763"><span class="sd">            .. note:: setting this flag to ``False`` will not provide</span>
</span><span data-line="764"><span class="sd">              case-insensitive behavior for table reflection; table reflection</span>
</span><span data-line="765"><span class="sd">              will always search for a mixed-case name in a case sensitive</span>
</span><span data-line="766"><span class="sd">              fashion.  Case insensitive names are specified in SQLAlchemy only</span>
</span><span data-line="767"><span class="sd">              by stating the name with all lower case characters.</span>
</span><span data-line="768">
</span><span data-line="769"><span class="sd">        :param quote_schema: same as &#39;quote&#39; but applies to the schema identifier.</span>
</span><span data-line="770">
</span><span data-line="771"><span class="sd">        :param schema: The schema name for this table, which is required if</span>
</span><span data-line="772"><span class="sd">            the table resides in a schema other than the default selected schema</span>
</span><span data-line="773"><span class="sd">            for the engine&#39;s database connection.  Defaults to ``None``.</span>
</span><span data-line="774">
</span><span data-line="775"><span class="sd">            If the owning :class:`_schema.MetaData` of this :class:`_schema.Table`</span>
</span><span data-line="776"><span class="sd">            specifies its</span>
</span><span data-line="777"><span class="sd">            own :paramref:`_schema.MetaData.schema` parameter,</span>
</span><span data-line="778"><span class="sd">            then that schema name will</span>
</span><span data-line="779"><span class="sd">            be applied to this :class:`_schema.Table`</span>
</span><span data-line="780"><span class="sd">            if the schema parameter here is set</span>
</span><span data-line="781"><span class="sd">            to ``None``.  To set a blank schema name on a :class:`_schema.Table`</span>
</span><span data-line="782"><span class="sd">            that</span>
</span><span data-line="783"><span class="sd">            would otherwise use the schema set on the owning</span>
</span><span data-line="784"><span class="sd">            :class:`_schema.MetaData`,</span>
</span><span data-line="785"><span class="sd">            specify the special symbol :attr:`.BLANK_SCHEMA`.</span>
</span><span data-line="786">
</span><span data-line="787"><span class="sd">            The quoting rules for the schema name are the same as those for the</span>
</span><span data-line="788"><span class="sd">            ``name`` parameter, in that quoting is applied for reserved words or</span>
</span><span data-line="789"><span class="sd">            case-sensitive names; to enable unconditional quoting for the schema</span>
</span><span data-line="790"><span class="sd">            name, specify the flag ``quote_schema=True`` to the constructor, or use</span>
</span><span data-line="791"><span class="sd">            the :class:`.quoted_name` construct to specify the name.</span>
</span><span data-line="792">
</span><span data-line="793"><span class="sd">        :param comment: Optional string that will render an SQL comment on table</span>
</span><span data-line="794"><span class="sd">            creation.</span>
</span><span data-line="795">
</span><span data-line="796"><span class="sd">            .. versionadded:: 1.2 Added the :paramref:`_schema.Table.comment`</span>
</span><span data-line="797"><span class="sd">                parameter</span>
</span><span data-line="798"><span class="sd">                to :class:`_schema.Table`.</span>
</span><span data-line="799">
</span><span data-line="800"><span class="sd">        :param \**kw: Additional keyword arguments not mentioned above are</span>
</span><span data-line="801"><span class="sd">            dialect specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.</span>
</span><span data-line="802"><span class="sd">            See the documentation regarding an individual dialect at</span>
</span><span data-line="803"><span class="sd">            :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span data-line="804">
</span><span data-line="805"><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
</span><span data-line="806">        <span class="k">if</span> <span class="n">_no_init</span><span class="p">:</span>
</span><span data-line="807">            <span class="c1"># don&#39;t run __init__ from __new__ by default;</span>
</span><span data-line="808">            <span class="c1"># __new__ has a specific place that __init__ is called</span>
</span><span data-line="809">            <span class="k">return</span>
</span><span data-line="810">
</span><span data-line="811">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">))</span>
</span><span data-line="812">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span data-line="813">
</span><span data-line="814">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="815">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="816">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span data-line="817">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="818">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="819">            <span class="n">quote_schema</span> <span class="o">=</span> <span class="n">quote_schema</span>
</span><span data-line="820">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span data-line="821">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span data-line="822">
</span><span data-line="823">        <span class="bp">self</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="824">
</span><span data-line="825">        <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="826">        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="827">        <span class="n">PrimaryKeyConstraint</span><span class="p">(</span>
</span><span data-line="828">            <span class="n">_implicit_generated</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="829">        <span class="p">)</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="830">        <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span data-line="831">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_dependencies</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="832">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="833">            <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="834">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="835">            <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="836">
</span><span data-line="837">        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span> <span class="o">=</span> <span class="n">implicit_returning</span>
</span><span data-line="838">        <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="839">
</span><span data-line="840">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span data-line="841">
</span><span data-line="842">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="843">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="844">
</span><span data-line="845">        <span class="k">if</span> <span class="n">listeners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="846">            <span class="k">for</span> <span class="n">evt</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
</span><span data-line="847">                <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span><span data-line="848">
</span><span data-line="849">        <span class="bp">self</span><span class="o">.</span><span class="n">_prefixes</span> <span class="o">=</span> <span class="n">prefixes</span> <span class="k">if</span> <span class="n">prefixes</span> <span class="k">else</span> <span class="p">[]</span>
</span><span data-line="850">
</span><span data-line="851">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="852">
</span><span data-line="853">        <span class="c1"># load column definitions from the database if &#39;autoload&#39; is defined</span>
</span><span data-line="854">        <span class="c1"># we do it after the table is in the singleton dictionary to support</span>
</span><span data-line="855">        <span class="c1"># circular foreign keys</span>
</span><span data-line="856">        <span class="k">if</span> <span class="n">autoload_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="857">            <span class="bp">self</span><span class="o">.</span><span class="n">_autoload</span><span class="p">(</span>
</span><span data-line="858">                <span class="n">metadata</span><span class="p">,</span>
</span><span data-line="859">                <span class="n">autoload_with</span><span class="p">,</span>
</span><span data-line="860">                <span class="n">include_columns</span><span class="p">,</span>
</span><span data-line="861">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span data-line="862">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span data-line="863">                <span class="n">resolve_fks</span><span class="o">=</span><span class="n">resolve_fks</span><span class="p">,</span>
</span><span data-line="864">            <span class="p">)</span>
</span><span data-line="865">
</span><span data-line="866">        <span class="c1"># initialize all the column, etc. objects.  done after reflection to</span>
</span><span data-line="867">        <span class="c1"># allow user-overrides</span>
</span><span data-line="868">
</span><span data-line="869">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span>
</span><span data-line="870">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span data-line="871">            <span class="n">allow_replacements</span><span class="o">=</span><span class="n">extend_existing</span>
</span><span data-line="872">            <span class="ow">or</span> <span class="n">keep_existing</span>
</span><span data-line="873">            <span class="ow">or</span> <span class="n">autoload_with</span><span class="p">,</span>
</span><span data-line="874">            <span class="n">all_names</span><span class="o">=</span><span class="p">{},</span>
</span><span data-line="875">        <span class="p">)</span>
</span><span data-line="876">
</span><span data-line="877">    <span class="k">def</span> <span class="nf">_autoload</span><span class="p">(</span>
</span><span data-line="878">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="879">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span data-line="880">        <span class="n">autoload_with</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">],</span>
</span><span data-line="881">        <span class="n">include_columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span data-line="882">        <span class="n">exclude_columns</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
</span><span data-line="883">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="884">        <span class="n">_extend_on</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="885">        <span class="n">_reflect_info</span><span class="p">:</span> <span class="n">_ReflectionInfo</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="886">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="887">        <span class="n">insp</span> <span class="o">=</span> <span class="n">inspection</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">autoload_with</span><span class="p">)</span>
</span><span data-line="888">        <span class="k">with</span> <span class="n">insp</span><span class="o">.</span><span class="n">_inspection_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn_insp</span><span class="p">:</span>
</span><span data-line="889">            <span class="n">conn_insp</span><span class="o">.</span><span class="n">reflect_table</span><span class="p">(</span>
</span><span data-line="890">                <span class="bp">self</span><span class="p">,</span>
</span><span data-line="891">                <span class="n">include_columns</span><span class="p">,</span>
</span><span data-line="892">                <span class="n">exclude_columns</span><span class="p">,</span>
</span><span data-line="893">                <span class="n">resolve_fks</span><span class="p">,</span>
</span><span data-line="894">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span data-line="895">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span data-line="896">            <span class="p">)</span>
</span><span data-line="897">
</span><span data-line="898">    <span class="nd">@property</span>
</span><span data-line="899">    <span class="k">def</span> <span class="nf">_sorted_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]:</span>
</span><span data-line="900"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the set of constraints as a list, sorted by creation</span>
</span><span data-line="901"><span class="sd">        order.</span>
</span><span data-line="902">
</span><span data-line="903"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="904">
</span><span data-line="905">        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">_creation_order</span><span class="p">)</span>
</span><span data-line="906">
</span><span data-line="907">    <span class="nd">@property</span>
</span><span data-line="908">    <span class="k">def</span> <span class="nf">foreign_key_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKeyConstraint</span><span class="p">]:</span>
</span><span data-line="909"><span class="w">        </span><span class="sd">&quot;&quot;&quot;:class:`_schema.ForeignKeyConstraint` objects referred to by this</span>
</span><span data-line="910"><span class="sd">        :class:`_schema.Table`.</span>
</span><span data-line="911">
</span><span data-line="912"><span class="sd">        This list is produced from the collection of</span>
</span><span data-line="913"><span class="sd">        :class:`_schema.ForeignKey`</span>
</span><span data-line="914"><span class="sd">        objects currently associated.</span>
</span><span data-line="915">
</span><span data-line="916">
</span><span data-line="917"><span class="sd">        .. seealso::</span>
</span><span data-line="918">
</span><span data-line="919"><span class="sd">            :attr:`_schema.Table.constraints`</span>
</span><span data-line="920">
</span><span data-line="921"><span class="sd">            :attr:`_schema.Table.foreign_keys`</span>
</span><span data-line="922">
</span><span data-line="923"><span class="sd">            :attr:`_schema.Table.indexes`</span>
</span><span data-line="924">
</span><span data-line="925"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="926">        <span class="k">return</span> <span class="p">{</span>
</span><span data-line="927">            <span class="n">fkc</span><span class="o">.</span><span class="n">constraint</span>
</span><span data-line="928">            <span class="k">for</span> <span class="n">fkc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span>
</span><span data-line="929">            <span class="k">if</span> <span class="n">fkc</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="930">        <span class="p">}</span>
</span><span data-line="931">
</span><span data-line="932">    <span class="k">def</span> <span class="nf">_init_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="933">        <span class="n">autoload_with</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload_with&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="934">        <span class="n">autoload</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload&quot;</span><span class="p">,</span> <span class="n">autoload_with</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="935">        <span class="n">autoload_replace</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;autoload_replace&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span data-line="936">        <span class="n">schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="937">        <span class="n">_extend_on</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_extend_on&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="938">        <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="939">
</span><span data-line="940">        <span class="c1"># these arguments are only used with _init()</span>
</span><span data-line="941">        <span class="n">extend_existing</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extend_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span data-line="942">        <span class="n">keep_existing</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;keep_existing&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span data-line="943">
</span><span data-line="944">        <span class="k">assert</span> <span class="n">extend_existing</span>
</span><span data-line="945">        <span class="k">assert</span> <span class="ow">not</span> <span class="n">keep_existing</span>
</span><span data-line="946">
</span><span data-line="947">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">and</span> <span class="n">schema</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
</span><span data-line="948">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="949">                <span class="sa">f</span><span class="s2">&quot;Can&#39;t change schema of existing table &quot;</span>
</span><span data-line="950">                <span class="sa">f</span><span class="s2">&quot;from &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span data-line="951">            <span class="p">)</span>
</span><span data-line="952">
</span><span data-line="953">        <span class="n">include_columns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;include_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="954">        <span class="k">if</span> <span class="n">include_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="955">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
</span><span data-line="956">                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_columns</span><span class="p">:</span>
</span><span data-line="957">                    <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span data-line="958">
</span><span data-line="959">        <span class="n">resolve_fks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;resolve_fks&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span data-line="960">
</span><span data-line="961">        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="s2">&quot;quote_schema&quot;</span><span class="p">):</span>
</span><span data-line="962">            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span data-line="963">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="964">                    <span class="s2">&quot;Can&#39;t redefine &#39;quote&#39; or &#39;quote_schema&#39; arguments&quot;</span>
</span><span data-line="965">                <span class="p">)</span>
</span><span data-line="966">
</span><span data-line="967">        <span class="c1"># update `self` with these kwargs, if provided</span>
</span><span data-line="968">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
</span><span data-line="969">        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
</span><span data-line="970">            <span class="s2">&quot;implicit_returning&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">implicit_returning</span>
</span><span data-line="971">        <span class="p">)</span>
</span><span data-line="972">        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span data-line="973">
</span><span data-line="974">        <span class="n">exclude_columns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="975">
</span><span data-line="976">        <span class="k">if</span> <span class="n">autoload</span><span class="p">:</span>
</span><span data-line="977">            <span class="k">if</span> <span class="ow">not</span> <span class="n">autoload_replace</span><span class="p">:</span>
</span><span data-line="978">                <span class="c1"># don&#39;t replace columns already present.</span>
</span><span data-line="979">                <span class="c1"># we&#39;d like to do this for constraints also however we don&#39;t</span>
</span><span data-line="980">                <span class="c1"># have simple de-duping for unnamed constraints.</span>
</span><span data-line="981">                <span class="n">exclude_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">]</span>
</span><span data-line="982">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="983">                <span class="n">exclude_columns</span> <span class="o">=</span> <span class="p">()</span>
</span><span data-line="984">            <span class="bp">self</span><span class="o">.</span><span class="n">_autoload</span><span class="p">(</span>
</span><span data-line="985">                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span data-line="986">                <span class="n">autoload_with</span><span class="p">,</span>
</span><span data-line="987">                <span class="n">include_columns</span><span class="p">,</span>
</span><span data-line="988">                <span class="n">exclude_columns</span><span class="p">,</span>
</span><span data-line="989">                <span class="n">resolve_fks</span><span class="p">,</span>
</span><span data-line="990">                <span class="n">_extend_on</span><span class="o">=</span><span class="n">_extend_on</span><span class="p">,</span>
</span><span data-line="991">                <span class="n">_reflect_info</span><span class="o">=</span><span class="n">_reflect_info</span><span class="p">,</span>
</span><span data-line="992">            <span class="p">)</span>
</span><span data-line="993">
</span><span data-line="994">        <span class="n">all_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">}</span>
</span><span data-line="995">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="996">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">allow_replacements</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">all_names</span><span class="o">=</span><span class="n">all_names</span><span class="p">)</span>
</span><span data-line="997">
</span><span data-line="998">    <span class="k">def</span> <span class="nf">_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="999">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="1000">
</span><span data-line="1001">    <span class="k">def</span> <span class="nf">_init_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1002">        <span class="k">pass</span>
</span><span data-line="1003">
</span><span data-line="1004">    <span class="k">def</span> <span class="nf">_reset_exported</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1005">        <span class="k">pass</span>
</span><span data-line="1006">
</span><span data-line="1007">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_non_memoized_property</span>
</span><span data-line="1008">    <span class="k">def</span> <span class="nf">_autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span data-line="1009">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span data-line="1010">
</span><span data-line="1011">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span data-line="1012">    <span class="k">def</span> <span class="nf">_sentinel_column_characteristics</span><span class="p">(</span>
</span><span data-line="1013">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1014">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_SentinelColumnCharacterization</span><span class="p">:</span>
</span><span data-line="1015"><span class="w">        </span><span class="sd">&quot;&quot;&quot;determine a candidate column (or columns, in case of a client</span>
</span><span data-line="1016"><span class="sd">        generated composite primary key) which can be used as an</span>
</span><span data-line="1017"><span class="sd">        &quot;insert sentinel&quot; for an INSERT statement.</span>
</span><span data-line="1018">
</span><span data-line="1019"><span class="sd">        The returned structure, :class:`_SentinelColumnCharacterization`,</span>
</span><span data-line="1020"><span class="sd">        includes all the details needed by :class:`.Dialect` and</span>
</span><span data-line="1021"><span class="sd">        :class:`.SQLCompiler` to determine if these column(s) can be used</span>
</span><span data-line="1022"><span class="sd">        as an INSERT..RETURNING sentinel for a particular database</span>
</span><span data-line="1023"><span class="sd">        dialect.</span>
</span><span data-line="1024">
</span><span data-line="1025"><span class="sd">        .. versionadded:: 2.0.10</span>
</span><span data-line="1026">
</span><span data-line="1027"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1028">
</span><span data-line="1029">        <span class="n">sentinel_is_explicit</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1030">        <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1031">        <span class="n">the_sentinel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1032">
</span><span data-line="1033">        <span class="c1"># see if a column was explicitly marked &quot;insert_sentinel=True&quot;.</span>
</span><span data-line="1034">        <span class="n">explicit_sentinel_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sentinel_column</span>
</span><span data-line="1035">
</span><span data-line="1036">        <span class="k">if</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1037">            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="p">(</span><span class="n">explicit_sentinel_col</span><span class="p">,)</span>
</span><span data-line="1038">            <span class="n">sentinel_is_explicit</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="1039">
</span><span data-line="1040">        <span class="n">autoinc_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span data-line="1041">        <span class="k">if</span> <span class="n">sentinel_is_explicit</span> <span class="ow">and</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="n">autoinc_col</span><span class="p">:</span>
</span><span data-line="1042">            <span class="k">assert</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="1043">            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="1044">        <span class="k">elif</span> <span class="n">explicit_sentinel_col</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1045">            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="p">(</span><span class="n">autoinc_col</span><span class="p">,)</span>
</span><span data-line="1046">            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="1047">
</span><span data-line="1048">        <span class="n">default_characterization</span> <span class="o">=</span> <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">UNKNOWN</span>
</span><span data-line="1049">
</span><span data-line="1050">        <span class="k">if</span> <span class="n">the_sentinel</span><span class="p">:</span>
</span><span data-line="1051">            <span class="n">the_sentinel_zero</span> <span class="o">=</span> <span class="n">the_sentinel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="1052">            <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">identity</span><span class="p">:</span>
</span><span data-line="1053">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">identity</span><span class="o">.</span><span class="n">_increment_is_negative</span><span class="p">:</span>
</span><span data-line="1054">                    <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span data-line="1055">                        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="1056">                            <span class="s2">&quot;Can&#39;t use IDENTITY default with negative &quot;</span>
</span><span data-line="1057">                            <span class="s2">&quot;increment as an explicit sentinel column&quot;</span>
</span><span data-line="1058">                        <span class="p">)</span>
</span><span data-line="1059">                    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1060">                        <span class="k">if</span> <span class="n">sentinel_is_autoinc</span><span class="p">:</span>
</span><span data-line="1061">                            <span class="n">autoinc_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1062">                            <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1063">                        <span class="n">the_sentinel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1064">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="1065">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1066">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">IDENTITY</span>
</span><span data-line="1067">                    <span class="p">)</span>
</span><span data-line="1068">            <span class="k">elif</span> <span class="p">(</span>
</span><span data-line="1069">                <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span data-line="1070">                <span class="ow">and</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span data-line="1071">            <span class="p">):</span>
</span><span data-line="1072">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span data-line="1073">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="1074">                        <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">the_sentinel_zero</span><span class="si">}</span><span class="s2"> has been marked as a &quot;</span>
</span><span data-line="1075">                        <span class="s2">&quot;sentinel &quot;</span>
</span><span data-line="1076">                        <span class="s2">&quot;column with no default generation function; it &quot;</span>
</span><span data-line="1077">                        <span class="s2">&quot;at least needs to be marked nullable=False assuming &quot;</span>
</span><span data-line="1078">                        <span class="s2">&quot;user-populated sentinel values will be used.&quot;</span>
</span><span data-line="1079">                    <span class="p">)</span>
</span><span data-line="1080">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1081">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">NONE</span>
</span><span data-line="1082">                <span class="p">)</span>
</span><span data-line="1083">            <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1084">                <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_sentinel</span><span class="p">:</span>
</span><span data-line="1085">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1086">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SENTINEL_DEFAULT</span>
</span><span data-line="1087">                    <span class="p">)</span>
</span><span data-line="1088">                <span class="k">elif</span> <span class="n">default_is_sequence</span><span class="p">(</span><span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
</span><span data-line="1089">                    <span class="k">if</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">_increment_is_negative</span><span class="p">:</span>
</span><span data-line="1090">                        <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span data-line="1091">                            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="1092">                                <span class="s2">&quot;Can&#39;t use SEQUENCE default with negative &quot;</span>
</span><span data-line="1093">                                <span class="s2">&quot;increment as an explicit sentinel column&quot;</span>
</span><span data-line="1094">                            <span class="p">)</span>
</span><span data-line="1095">                        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1096">                            <span class="k">if</span> <span class="n">sentinel_is_autoinc</span><span class="p">:</span>
</span><span data-line="1097">                                <span class="n">autoinc_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1098">                                <span class="n">sentinel_is_autoinc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1099">                            <span class="n">the_sentinel</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1100">
</span><span data-line="1101">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1102">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SEQUENCE</span>
</span><span data-line="1103">                    <span class="p">)</span>
</span><span data-line="1104">                <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_callable</span><span class="p">:</span>
</span><span data-line="1105">                    <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1106">                        <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">CLIENTSIDE</span>
</span><span data-line="1107">                    <span class="p">)</span>
</span><span data-line="1108">            <span class="k">elif</span> <span class="n">the_sentinel_zero</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1109">                <span class="k">if</span> <span class="n">sentinel_is_explicit</span><span class="p">:</span>
</span><span data-line="1110">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="1111">                        <span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">the_sentinel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> can&#39;t be a sentinel column &quot;</span>
</span><span data-line="1112">                        <span class="s2">&quot;because it uses an explicit server side default &quot;</span>
</span><span data-line="1113">                        <span class="s2">&quot;that&#39;s not the Identity() default.&quot;</span>
</span><span data-line="1114">                    <span class="p">)</span>
</span><span data-line="1115">
</span><span data-line="1116">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1117">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">SERVERSIDE</span>
</span><span data-line="1118">                <span class="p">)</span>
</span><span data-line="1119">
</span><span data-line="1120">        <span class="k">if</span> <span class="n">the_sentinel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="1121">            <span class="k">assert</span> <span class="n">autoinc_col</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span data-line="1122">
</span><span data-line="1123">            <span class="c1"># determine for non-autoincrement pk if all elements are</span>
</span><span data-line="1124">            <span class="c1"># client side</span>
</span><span data-line="1125">            <span class="k">for</span> <span class="n">_pkc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="1126">                <span class="k">if</span> <span class="n">_pkc</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
</span><span data-line="1127">                    <span class="n">_pkc</span><span class="o">.</span><span class="n">default</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_pkc</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">is_callable</span>
</span><span data-line="1128">                <span class="p">):</span>
</span><span data-line="1129">                    <span class="k">break</span>
</span><span data-line="1130">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1131">                <span class="n">the_sentinel</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
</span><span data-line="1132">                <span class="n">default_characterization</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1133">                    <span class="n">_SentinelDefaultCharacterization</span><span class="o">.</span><span class="n">CLIENTSIDE</span>
</span><span data-line="1134">                <span class="p">)</span>
</span><span data-line="1135">
</span><span data-line="1136">        <span class="k">return</span> <span class="n">_SentinelColumnCharacterization</span><span class="p">(</span>
</span><span data-line="1137">            <span class="n">the_sentinel</span><span class="p">,</span>
</span><span data-line="1138">            <span class="n">sentinel_is_explicit</span><span class="p">,</span>
</span><span data-line="1139">            <span class="n">sentinel_is_autoinc</span><span class="p">,</span>
</span><span data-line="1140">            <span class="n">default_characterization</span><span class="p">,</span>
</span><span data-line="1141">        <span class="p">)</span>
</span><span data-line="1142">
</span><span data-line="1143">    <span class="nd">@property</span>
</span><span data-line="1144">    <span class="k">def</span> <span class="nf">autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span data-line="1145"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the :class:`.Column` object which currently represents</span>
</span><span data-line="1146"><span class="sd">        the &quot;auto increment&quot; column, if any, else returns None.</span>
</span><span data-line="1147">
</span><span data-line="1148"><span class="sd">        This is based on the rules for :class:`.Column` as defined by the</span>
</span><span data-line="1149"><span class="sd">        :paramref:`.Column.autoincrement` parameter, which generally means the</span>
</span><span data-line="1150"><span class="sd">        column within a single integer column primary key constraint that is</span>
</span><span data-line="1151"><span class="sd">        not constrained by a foreign key.   If the table does not have such</span>
</span><span data-line="1152"><span class="sd">        a primary key constraint, then there&#39;s no &quot;autoincrement&quot; column.</span>
</span><span data-line="1153"><span class="sd">        A :class:`.Table` may have only one column defined as the</span>
</span><span data-line="1154"><span class="sd">        &quot;autoincrement&quot; column.</span>
</span><span data-line="1155">
</span><span data-line="1156"><span class="sd">        .. versionadded:: 2.0.4</span>
</span><span data-line="1157">
</span><span data-line="1158"><span class="sd">        .. seealso::</span>
</span><span data-line="1159">
</span><span data-line="1160"><span class="sd">            :paramref:`.Column.autoincrement`</span>
</span><span data-line="1161">
</span><span data-line="1162"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1163">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span data-line="1164">
</span><span data-line="1165">    <span class="nd">@property</span>
</span><span data-line="1166">    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="1167"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the &#39;key&#39; for this :class:`_schema.Table`.</span>
</span><span data-line="1168">
</span><span data-line="1169"><span class="sd">        This value is used as the dictionary key within the</span>
</span><span data-line="1170"><span class="sd">        :attr:`_schema.MetaData.tables` collection.   It is typically the same</span>
</span><span data-line="1171"><span class="sd">        as that of :attr:`_schema.Table.name` for a table with no</span>
</span><span data-line="1172"><span class="sd">        :attr:`_schema.Table.schema`</span>
</span><span data-line="1173"><span class="sd">        set; otherwise it is typically of the form</span>
</span><span data-line="1174"><span class="sd">        ``schemaname.tablename``.</span>
</span><span data-line="1175">
</span><span data-line="1176"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1177">        <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span data-line="1178">
</span><span data-line="1179">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="1180">        <span class="k">return</span> <span class="s2">&quot;Table(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span data-line="1181">            <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span data-line="1182">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)]</span>
</span><span data-line="1183">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span data-line="1184">            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]]</span>
</span><span data-line="1185">        <span class="p">)</span>
</span><span data-line="1186">
</span><span data-line="1187">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="1188">        <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span data-line="1189">
</span><span data-line="1190">    <span class="k">def</span> <span class="nf">add_is_dependent_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1191"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a &#39;dependency&#39; for this Table.</span>
</span><span data-line="1192">
</span><span data-line="1193"><span class="sd">        This is another Table object which must be created</span>
</span><span data-line="1194"><span class="sd">        first before this one can, or dropped after this one.</span>
</span><span data-line="1195">
</span><span data-line="1196"><span class="sd">        Usually, dependencies between tables are determined via</span>
</span><span data-line="1197"><span class="sd">        ForeignKey objects.   However, for other situations that</span>
</span><span data-line="1198"><span class="sd">        create dependencies outside of foreign keys (rules, inheriting),</span>
</span><span data-line="1199"><span class="sd">        this method can manually establish such a link.</span>
</span><span data-line="1200">
</span><span data-line="1201"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1202">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_dependencies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="1203">
</span><span data-line="1204">    <span class="k">def</span> <span class="nf">append_column</span><span class="p">(</span>
</span><span data-line="1205">        <span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">replace_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="1206">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1207"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append a :class:`_schema.Column` to this :class:`_schema.Table`.</span>
</span><span data-line="1208">
</span><span data-line="1209"><span class="sd">        The &quot;key&quot; of the newly added :class:`_schema.Column`, i.e. the</span>
</span><span data-line="1210"><span class="sd">        value of its ``.key`` attribute, will then be available</span>
</span><span data-line="1211"><span class="sd">        in the ``.c`` collection of this :class:`_schema.Table`, and the</span>
</span><span data-line="1212"><span class="sd">        column definition will be included in any CREATE TABLE, SELECT,</span>
</span><span data-line="1213"><span class="sd">        UPDATE, etc. statements generated from this :class:`_schema.Table`</span>
</span><span data-line="1214"><span class="sd">        construct.</span>
</span><span data-line="1215">
</span><span data-line="1216"><span class="sd">        Note that this does **not** change the definition of the table</span>
</span><span data-line="1217"><span class="sd">        as it exists within any underlying database, assuming that</span>
</span><span data-line="1218"><span class="sd">        table has already been created in the database.   Relational</span>
</span><span data-line="1219"><span class="sd">        databases support the addition of columns to existing tables</span>
</span><span data-line="1220"><span class="sd">        using the SQL ALTER command, which would need to be</span>
</span><span data-line="1221"><span class="sd">        emitted for an already-existing table that doesn&#39;t contain</span>
</span><span data-line="1222"><span class="sd">        the newly added column.</span>
</span><span data-line="1223">
</span><span data-line="1224"><span class="sd">        :param replace_existing: When ``True``, allows replacing existing</span>
</span><span data-line="1225"><span class="sd">            columns. When ``False``, the default, an warning will be raised</span>
</span><span data-line="1226"><span class="sd">            if a column with the same ``.key`` already exists. A future</span>
</span><span data-line="1227"><span class="sd">            version of sqlalchemy will instead rise a warning.</span>
</span><span data-line="1228">
</span><span data-line="1229"><span class="sd">            .. versionadded:: 1.4.0</span>
</span><span data-line="1230"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1231">
</span><span data-line="1232">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1233">            <span class="n">column</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span>
</span><span data-line="1234">                <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1235">                <span class="n">allow_replacements</span><span class="o">=</span><span class="n">replace_existing</span><span class="p">,</span>
</span><span data-line="1236">                <span class="n">all_names</span><span class="o">=</span><span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">},</span>
</span><span data-line="1237">            <span class="p">)</span>
</span><span data-line="1238">        <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span> <span class="k">as</span> <span class="n">de</span><span class="p">:</span>
</span><span data-line="1239">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span><span class="p">(</span>
</span><span data-line="1240">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">de</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> Specify replace_existing=True to &quot;</span>
</span><span data-line="1241">                <span class="s2">&quot;Table.append_column() to replace an &quot;</span>
</span><span data-line="1242">                <span class="s2">&quot;existing column.&quot;</span>
</span><span data-line="1243">            <span class="p">)</span> <span class="kn">from</span> <span class="nn">de</span>
</span><span data-line="1244">
</span><span data-line="1245">    <span class="k">def</span> <span class="nf">append_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Index</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1246"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Append a :class:`_schema.Constraint` to this</span>
</span><span data-line="1247"><span class="sd">        :class:`_schema.Table`.</span>
</span><span data-line="1248">
</span><span data-line="1249"><span class="sd">        This has the effect of the constraint being included in any</span>
</span><span data-line="1250"><span class="sd">        future CREATE TABLE statement, assuming specific DDL creation</span>
</span><span data-line="1251"><span class="sd">        events have not been associated with the given</span>
</span><span data-line="1252"><span class="sd">        :class:`_schema.Constraint` object.</span>
</span><span data-line="1253">
</span><span data-line="1254"><span class="sd">        Note that this does **not** produce the constraint within the</span>
</span><span data-line="1255"><span class="sd">        relational database automatically, for a table that already exists</span>
</span><span data-line="1256"><span class="sd">        in the database.   To add a constraint to an</span>
</span><span data-line="1257"><span class="sd">        existing relational database table, the SQL ALTER command must</span>
</span><span data-line="1258"><span class="sd">        be used.  SQLAlchemy also provides the</span>
</span><span data-line="1259"><span class="sd">        :class:`.AddConstraint` construct which can produce this SQL when</span>
</span><span data-line="1260"><span class="sd">        invoked as an executable clause.</span>
</span><span data-line="1261">
</span><span data-line="1262"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1263">
</span><span data-line="1264">        <span class="n">constraint</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="1265">
</span><span data-line="1266">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1267">        <span class="n">metadata</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="1268">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">)</span>
</span><span data-line="1269">        <span class="n">metadata</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="1270">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span data-line="1271">
</span><span data-line="1272">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1273"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``CREATE`` statement for this</span>
</span><span data-line="1274"><span class="sd">        :class:`_schema.Table`, using the given</span>
</span><span data-line="1275"><span class="sd">        :class:`.Connection` or :class:`.Engine`</span>
</span><span data-line="1276"><span class="sd">        for connectivity.</span>
</span><span data-line="1277">
</span><span data-line="1278"><span class="sd">        .. seealso::</span>
</span><span data-line="1279">
</span><span data-line="1280"><span class="sd">            :meth:`_schema.MetaData.create_all`.</span>
</span><span data-line="1281">
</span><span data-line="1282"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1283">
</span><span data-line="1284">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="1285">
</span><span data-line="1286">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1287"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``DROP`` statement for this</span>
</span><span data-line="1288"><span class="sd">        :class:`_schema.Table`, using the given</span>
</span><span data-line="1289"><span class="sd">        :class:`.Connection` or :class:`.Engine` for connectivity.</span>
</span><span data-line="1290">
</span><span data-line="1291"><span class="sd">        .. seealso::</span>
</span><span data-line="1292">
</span><span data-line="1293"><span class="sd">            :meth:`_schema.MetaData.drop_all`.</span>
</span><span data-line="1294">
</span><span data-line="1295"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1296">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="1297">
</span><span data-line="1298">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="1299">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="1300">        <span class="s2">&quot;:meth:`_schema.Table.tometadata` is renamed to &quot;</span>
</span><span data-line="1301">        <span class="s2">&quot;:meth:`_schema.Table.to_metadata`&quot;</span><span class="p">,</span>
</span><span data-line="1302">    <span class="p">)</span>
</span><span data-line="1303">    <span class="k">def</span> <span class="nf">tometadata</span><span class="p">(</span>
</span><span data-line="1304">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1305">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span data-line="1306">        <span class="n">schema</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="n">RETAIN_SCHEMA</span><span class="p">,</span>
</span><span data-line="1307">        <span class="n">referred_schema_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="1308">            <span class="n">Callable</span><span class="p">[</span>
</span><span data-line="1309">                <span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ForeignKeyConstraint</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span data-line="1310">                <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span data-line="1311">            <span class="p">]</span>
</span><span data-line="1312">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1313">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1314">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span data-line="1315"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of this :class:`_schema.Table`</span>
</span><span data-line="1316"><span class="sd">        associated with a different</span>
</span><span data-line="1317"><span class="sd">        :class:`_schema.MetaData`.</span>
</span><span data-line="1318">
</span><span data-line="1319"><span class="sd">        See :meth:`_schema.Table.to_metadata` for a full description.</span>
</span><span data-line="1320">
</span><span data-line="1321"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1322">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_metadata</span><span class="p">(</span>
</span><span data-line="1323">            <span class="n">metadata</span><span class="p">,</span>
</span><span data-line="1324">            <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span data-line="1325">            <span class="n">referred_schema_fn</span><span class="o">=</span><span class="n">referred_schema_fn</span><span class="p">,</span>
</span><span data-line="1326">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="1327">        <span class="p">)</span>
</span><span data-line="1328">
</span><span data-line="1329">    <span class="k">def</span> <span class="nf">to_metadata</span><span class="p">(</span>
</span><span data-line="1330">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1331">        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
</span><span data-line="1332">        <span class="n">schema</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">]]</span> <span class="o">=</span> <span class="n">RETAIN_SCHEMA</span><span class="p">,</span>
</span><span data-line="1333">        <span class="n">referred_schema_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="1334">            <span class="n">Callable</span><span class="p">[</span>
</span><span data-line="1335">                <span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ForeignKeyConstraint</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
</span><span data-line="1336">                <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span data-line="1337">            <span class="p">]</span>
</span><span data-line="1338">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1339">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1340">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span data-line="1341"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a copy of this :class:`_schema.Table` associated with a</span>
</span><span data-line="1342"><span class="sd">        different :class:`_schema.MetaData`.</span>
</span><span data-line="1343">
</span><span data-line="1344"><span class="sd">        E.g.::</span>
</span><span data-line="1345">
</span><span data-line="1346"><span class="sd">            m1 = MetaData()</span>
</span><span data-line="1347">
</span><span data-line="1348"><span class="sd">            user = Table(&#39;user&#39;, m1, Column(&#39;id&#39;, Integer, primary_key=True))</span>
</span><span data-line="1349">
</span><span data-line="1350"><span class="sd">            m2 = MetaData()</span>
</span><span data-line="1351"><span class="sd">            user_copy = user.to_metadata(m2)</span>
</span><span data-line="1352">
</span><span data-line="1353"><span class="sd">        .. versionchanged:: 1.4  The :meth:`_schema.Table.to_metadata` function</span>
</span><span data-line="1354"><span class="sd">           was renamed from :meth:`_schema.Table.tometadata`.</span>
</span><span data-line="1355">
</span><span data-line="1356">
</span><span data-line="1357"><span class="sd">        :param metadata: Target :class:`_schema.MetaData` object,</span>
</span><span data-line="1358"><span class="sd">         into which the</span>
</span><span data-line="1359"><span class="sd">         new :class:`_schema.Table` object will be created.</span>
</span><span data-line="1360">
</span><span data-line="1361"><span class="sd">        :param schema: optional string name indicating the target schema.</span>
</span><span data-line="1362"><span class="sd">         Defaults to the special symbol :attr:`.RETAIN_SCHEMA` which indicates</span>
</span><span data-line="1363"><span class="sd">         that no change to the schema name should be made in the new</span>
</span><span data-line="1364"><span class="sd">         :class:`_schema.Table`.  If set to a string name, the new</span>
</span><span data-line="1365"><span class="sd">         :class:`_schema.Table`</span>
</span><span data-line="1366"><span class="sd">         will have this new name as the ``.schema``.  If set to ``None``, the</span>
</span><span data-line="1367"><span class="sd">         schema will be set to that of the schema set on the target</span>
</span><span data-line="1368"><span class="sd">         :class:`_schema.MetaData`, which is typically ``None`` as well,</span>
</span><span data-line="1369"><span class="sd">         unless</span>
</span><span data-line="1370"><span class="sd">         set explicitly::</span>
</span><span data-line="1371">
</span><span data-line="1372"><span class="sd">            m2 = MetaData(schema=&#39;newschema&#39;)</span>
</span><span data-line="1373">
</span><span data-line="1374"><span class="sd">            # user_copy_one will have &quot;newschema&quot; as the schema name</span>
</span><span data-line="1375"><span class="sd">            user_copy_one = user.to_metadata(m2, schema=None)</span>
</span><span data-line="1376">
</span><span data-line="1377"><span class="sd">            m3 = MetaData()  # schema defaults to None</span>
</span><span data-line="1378">
</span><span data-line="1379"><span class="sd">            # user_copy_two will have None as the schema name</span>
</span><span data-line="1380"><span class="sd">            user_copy_two = user.to_metadata(m3, schema=None)</span>
</span><span data-line="1381">
</span><span data-line="1382"><span class="sd">        :param referred_schema_fn: optional callable which can be supplied</span>
</span><span data-line="1383"><span class="sd">         in order to provide for the schema name that should be assigned</span>
</span><span data-line="1384"><span class="sd">         to the referenced table of a :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="1385"><span class="sd">         The callable accepts this parent :class:`_schema.Table`, the</span>
</span><span data-line="1386"><span class="sd">         target schema that we are changing to, the</span>
</span><span data-line="1387"><span class="sd">         :class:`_schema.ForeignKeyConstraint` object, and the existing</span>
</span><span data-line="1388"><span class="sd">         &quot;target schema&quot; of that constraint.  The function should return the</span>
</span><span data-line="1389"><span class="sd">         string schema name that should be applied.    To reset the schema</span>
</span><span data-line="1390"><span class="sd">         to &quot;none&quot;, return the symbol :data:`.BLANK_SCHEMA`.  To effect no</span>
</span><span data-line="1391"><span class="sd">         change, return ``None`` or :data:`.RETAIN_SCHEMA`.</span>
</span><span data-line="1392">
</span><span data-line="1393"><span class="sd">         .. versionchanged:: 1.4.33  The ``referred_schema_fn`` function</span>
</span><span data-line="1394"><span class="sd">            may return the :data:`.BLANK_SCHEMA` or :data:`.RETAIN_SCHEMA`</span>
</span><span data-line="1395"><span class="sd">            symbols.</span>
</span><span data-line="1396">
</span><span data-line="1397"><span class="sd">         E.g.::</span>
</span><span data-line="1398">
</span><span data-line="1399"><span class="sd">                def referred_schema_fn(table, to_schema,</span>
</span><span data-line="1400"><span class="sd">                                                constraint, referred_schema):</span>
</span><span data-line="1401"><span class="sd">                    if referred_schema == &#39;base_tables&#39;:</span>
</span><span data-line="1402"><span class="sd">                        return referred_schema</span>
</span><span data-line="1403"><span class="sd">                    else:</span>
</span><span data-line="1404"><span class="sd">                        return to_schema</span>
</span><span data-line="1405">
</span><span data-line="1406"><span class="sd">                new_table = table.to_metadata(m2, schema=&quot;alt_schema&quot;,</span>
</span><span data-line="1407"><span class="sd">                                        referred_schema_fn=referred_schema_fn)</span>
</span><span data-line="1408">
</span><span data-line="1409"><span class="sd">        :param name: optional string name indicating the target table name.</span>
</span><span data-line="1410"><span class="sd">         If not specified or None, the table name is retained.  This allows</span>
</span><span data-line="1411"><span class="sd">         a :class:`_schema.Table` to be copied to the same</span>
</span><span data-line="1412"><span class="sd">         :class:`_schema.MetaData` target</span>
</span><span data-line="1413"><span class="sd">         with a new name.</span>
</span><span data-line="1414">
</span><span data-line="1415"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1416">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1417">            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="1418">
</span><span data-line="1419">        <span class="n">actual_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="1420">
</span><span data-line="1421">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">RETAIN_SCHEMA</span><span class="p">:</span>
</span><span data-line="1422">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="1423">        <span class="k">elif</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1424">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="1425">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1426">            <span class="n">actual_schema</span> <span class="o">=</span> <span class="n">schema</span>
</span><span data-line="1427">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">actual_schema</span><span class="p">)</span>
</span><span data-line="1428">        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span data-line="1429">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="1430">                <span class="sa">f</span><span class="s2">&quot;Table &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39; already exists within the given &quot;</span>
</span><span data-line="1431">                <span class="s2">&quot;MetaData - not copying.&quot;</span>
</span><span data-line="1432">            <span class="p">)</span>
</span><span data-line="1433">            <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="1434">
</span><span data-line="1435">        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="1436">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span data-line="1437">            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">,</span> <span class="n">_to_metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">))</span>
</span><span data-line="1438">        <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
</span><span data-line="1439">            <span class="n">name</span><span class="p">,</span>
</span><span data-line="1440">            <span class="n">metadata</span><span class="p">,</span>
</span><span data-line="1441">            <span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">,</span>
</span><span data-line="1442">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="1443">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span data-line="1444">            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="1445">        <span class="p">)</span>
</span><span data-line="1446">        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span data-line="1447">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">ForeignKeyConstraint</span><span class="p">):</span>
</span><span data-line="1448">                <span class="n">referred_schema</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">_referred_schema</span>
</span><span data-line="1449">                <span class="k">if</span> <span class="n">referred_schema_fn</span><span class="p">:</span>
</span><span data-line="1450">                    <span class="n">fk_constraint_schema</span> <span class="o">=</span> <span class="n">referred_schema_fn</span><span class="p">(</span>
</span><span data-line="1451">                        <span class="bp">self</span><span class="p">,</span> <span class="n">actual_schema</span><span class="p">,</span> <span class="n">const</span><span class="p">,</span> <span class="n">referred_schema</span>
</span><span data-line="1452">                    <span class="p">)</span>
</span><span data-line="1453">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="1454">                    <span class="n">fk_constraint_schema</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1455">                        <span class="n">actual_schema</span>
</span><span data-line="1456">                        <span class="k">if</span> <span class="n">referred_schema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="1457">                        <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="1458">                    <span class="p">)</span>
</span><span data-line="1459">                <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span data-line="1460">                    <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span>
</span><span data-line="1461">                        <span class="n">schema</span><span class="o">=</span><span class="n">fk_constraint_schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">table</span>
</span><span data-line="1462">                    <span class="p">)</span>
</span><span data-line="1463">                <span class="p">)</span>
</span><span data-line="1464">            <span class="k">elif</span> <span class="ow">not</span> <span class="n">const</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">:</span>
</span><span data-line="1465">                <span class="c1"># skip unique constraints that would be generated</span>
</span><span data-line="1466">                <span class="c1"># by the &#39;unique&#39; flag on Column</span>
</span><span data-line="1467">                <span class="k">if</span> <span class="n">const</span><span class="o">.</span><span class="n">_column_flag</span><span class="p">:</span>
</span><span data-line="1468">                    <span class="k">continue</span>
</span><span data-line="1469">
</span><span data-line="1470">                <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span data-line="1471">                    <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">actual_schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="1472">                <span class="p">)</span>
</span><span data-line="1473">        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="p">:</span>
</span><span data-line="1474">            <span class="c1"># skip indexes that would be generated</span>
</span><span data-line="1475">            <span class="c1"># by the &#39;index&#39; flag on Column</span>
</span><span data-line="1476">            <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">_column_flag</span><span class="p">:</span>
</span><span data-line="1477">                <span class="k">continue</span>
</span><span data-line="1478">            <span class="n">Index</span><span class="p">(</span>
</span><span data-line="1479">                <span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="1480">                <span class="n">unique</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
</span><span data-line="1481">                <span class="o">*</span><span class="p">[</span>
</span><span data-line="1482">                    <span class="n">_copy_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="1483">                    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">index</span><span class="o">.</span><span class="n">_table_bound_expressions</span>
</span><span data-line="1484">                <span class="p">],</span>
</span><span data-line="1485">                <span class="n">_table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span>
</span><span data-line="1486">                <span class="o">**</span><span class="n">index</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span data-line="1487">            <span class="p">)</span>
</span><span data-line="1488">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="1489">
</span><span data-line="1490">
</span><span data-line="1491"><span class="k">class</span> <span class="nc">Column</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span data-line="1492"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a column in a database table.&quot;&quot;&quot;</span>
</span><span data-line="1493">
</span><span data-line="1494">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;column&quot;</span>
</span><span data-line="1495">
</span><span data-line="1496">    <span class="n">inherit_cache</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="1497">    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="1498">
</span><span data-line="1499">    <span class="n">server_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FetchedValue</span><span class="p">]</span>
</span><span data-line="1500">
</span><span data-line="1501">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="1502">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1503">        <span class="n">__name_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="1504">            <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">SchemaEventTarget</span><span class="p">]</span>
</span><span data-line="1505">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1506">        <span class="n">__type_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="1507">            <span class="n">Union</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">SchemaEventTarget</span><span class="p">]</span>
</span><span data-line="1508">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1509">        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span>
</span><span data-line="1510">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1511">        <span class="n">type_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1512">        <span class="n">autoincrement</span><span class="p">:</span> <span class="n">_AutoIncrementType</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span data-line="1513">        <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span data-line="1514">        <span class="n">insert_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">,</span>
</span><span data-line="1515">        <span class="n">doc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1516">        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1517">        <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1518">        <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1519">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1520">        <span class="n">nullable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="1521">            <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">]]</span>
</span><span data-line="1522">        <span class="p">]</span> <span class="o">=</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">NULL_UNSPECIFIED</span><span class="p">,</span>
</span><span data-line="1523">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1524">        <span class="n">primary_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="1525">        <span class="n">server_default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ServerDefaultArgument</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1526">        <span class="n">server_onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_ServerOnUpdateArgument</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1527">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1528">        <span class="n">system</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="1529">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1530">        <span class="n">insert_sentinel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="1531">        <span class="n">_omit_from_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="1532">        <span class="n">_proxies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1533">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="1534">    <span class="p">):</span>
</span><span data-line="1535"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1536"><span class="sd">        Construct a new ``Column`` object.</span>
</span><span data-line="1537">
</span><span data-line="1538"><span class="sd">        :param name: The name of this column as represented in the database.</span>
</span><span data-line="1539"><span class="sd">          This argument may be the first positional argument, or specified</span>
</span><span data-line="1540"><span class="sd">          via keyword.</span>
</span><span data-line="1541">
</span><span data-line="1542"><span class="sd">          Names which contain no upper case characters</span>
</span><span data-line="1543"><span class="sd">          will be treated as case insensitive names, and will not be quoted</span>
</span><span data-line="1544"><span class="sd">          unless they are a reserved word.  Names with any number of upper</span>
</span><span data-line="1545"><span class="sd">          case characters will be quoted and sent exactly.  Note that this</span>
</span><span data-line="1546"><span class="sd">          behavior applies even for databases which standardize upper</span>
</span><span data-line="1547"><span class="sd">          case names as case insensitive such as Oracle.</span>
</span><span data-line="1548">
</span><span data-line="1549"><span class="sd">          The name field may be omitted at construction time and applied</span>
</span><span data-line="1550"><span class="sd">          later, at any time before the Column is associated with a</span>
</span><span data-line="1551"><span class="sd">          :class:`_schema.Table`.  This is to support convenient</span>
</span><span data-line="1552"><span class="sd">          usage within the :mod:`~sqlalchemy.ext.declarative` extension.</span>
</span><span data-line="1553">
</span><span data-line="1554"><span class="sd">        :param type\_: The column&#39;s type, indicated using an instance which</span>
</span><span data-line="1555"><span class="sd">          subclasses :class:`~sqlalchemy.types.TypeEngine`.  If no arguments</span>
</span><span data-line="1556"><span class="sd">          are required for the type, the class of the type can be sent</span>
</span><span data-line="1557"><span class="sd">          as well, e.g.::</span>
</span><span data-line="1558">
</span><span data-line="1559"><span class="sd">            # use a type with arguments</span>
</span><span data-line="1560"><span class="sd">            Column(&#39;data&#39;, String(50))</span>
</span><span data-line="1561">
</span><span data-line="1562"><span class="sd">            # use no arguments</span>
</span><span data-line="1563"><span class="sd">            Column(&#39;level&#39;, Integer)</span>
</span><span data-line="1564">
</span><span data-line="1565"><span class="sd">          The ``type`` argument may be the second positional argument</span>
</span><span data-line="1566"><span class="sd">          or specified by keyword.</span>
</span><span data-line="1567">
</span><span data-line="1568"><span class="sd">          If the ``type`` is ``None`` or is omitted, it will first default to</span>
</span><span data-line="1569"><span class="sd">          the special type :class:`.NullType`.  If and when this</span>
</span><span data-line="1570"><span class="sd">          :class:`_schema.Column` is made to refer to another column using</span>
</span><span data-line="1571"><span class="sd">          :class:`_schema.ForeignKey` and/or</span>
</span><span data-line="1572"><span class="sd">          :class:`_schema.ForeignKeyConstraint`, the type</span>
</span><span data-line="1573"><span class="sd">          of the remote-referenced column will be copied to this column as</span>
</span><span data-line="1574"><span class="sd">          well, at the moment that the foreign key is resolved against that</span>
</span><span data-line="1575"><span class="sd">          remote :class:`_schema.Column` object.</span>
</span><span data-line="1576">
</span><span data-line="1577"><span class="sd">        :param \*args: Additional positional arguments include various</span>
</span><span data-line="1578"><span class="sd">          :class:`.SchemaItem` derived constructs which will be applied</span>
</span><span data-line="1579"><span class="sd">          as options to the column.  These include instances of</span>
</span><span data-line="1580"><span class="sd">          :class:`.Constraint`, :class:`_schema.ForeignKey`,</span>
</span><span data-line="1581"><span class="sd">          :class:`.ColumnDefault`, :class:`.Sequence`, :class:`.Computed`</span>
</span><span data-line="1582"><span class="sd">          :class:`.Identity`.  In some cases an</span>
</span><span data-line="1583"><span class="sd">          equivalent keyword argument is available such as ``server_default``,</span>
</span><span data-line="1584"><span class="sd">          ``default`` and ``unique``.</span>
</span><span data-line="1585">
</span><span data-line="1586"><span class="sd">        :param autoincrement: Set up &quot;auto increment&quot; semantics for an</span>
</span><span data-line="1587"><span class="sd">          **integer primary key column with no foreign key dependencies**</span>
</span><span data-line="1588"><span class="sd">          (see later in this docstring for a more specific definition).</span>
</span><span data-line="1589"><span class="sd">          This may influence the :term:`DDL` that will be emitted for</span>
</span><span data-line="1590"><span class="sd">          this column during a table create, as well as how the column</span>
</span><span data-line="1591"><span class="sd">          will be considered when INSERT statements are compiled and</span>
</span><span data-line="1592"><span class="sd">          executed.</span>
</span><span data-line="1593">
</span><span data-line="1594"><span class="sd">          The default value is the string ``&quot;auto&quot;``,</span>
</span><span data-line="1595"><span class="sd">          which indicates that a single-column (i.e. non-composite) primary key</span>
</span><span data-line="1596"><span class="sd">          that is of an INTEGER type with no other client-side or server-side</span>
</span><span data-line="1597"><span class="sd">          default constructs indicated should receive auto increment semantics</span>
</span><span data-line="1598"><span class="sd">          automatically. Other values include ``True`` (force this column to</span>
</span><span data-line="1599"><span class="sd">          have auto-increment semantics for a :term:`composite primary key` as</span>
</span><span data-line="1600"><span class="sd">          well), ``False`` (this column should never have auto-increment</span>
</span><span data-line="1601"><span class="sd">          semantics), and the string ``&quot;ignore_fk&quot;`` (special-case for foreign</span>
</span><span data-line="1602"><span class="sd">          key columns, see below).</span>
</span><span data-line="1603">
</span><span data-line="1604"><span class="sd">          The term &quot;auto increment semantics&quot; refers both to the kind of DDL</span>
</span><span data-line="1605"><span class="sd">          that will be emitted for the column within a CREATE TABLE statement,</span>
</span><span data-line="1606"><span class="sd">          when methods such as :meth:`.MetaData.create_all` and</span>
</span><span data-line="1607"><span class="sd">          :meth:`.Table.create` are invoked, as well as how the column will be</span>
</span><span data-line="1608"><span class="sd">          considered when an INSERT statement is compiled and emitted to the</span>
</span><span data-line="1609"><span class="sd">          database:</span>
</span><span data-line="1610">
</span><span data-line="1611"><span class="sd">          * **DDL rendering** (i.e. :meth:`.MetaData.create_all`,</span>
</span><span data-line="1612"><span class="sd">            :meth:`.Table.create`): When used on a :class:`.Column` that has</span>
</span><span data-line="1613"><span class="sd">            no other</span>
</span><span data-line="1614"><span class="sd">            default-generating construct associated with it (such as a</span>
</span><span data-line="1615"><span class="sd">            :class:`.Sequence` or :class:`.Identity` construct), the parameter</span>
</span><span data-line="1616"><span class="sd">            will imply that database-specific keywords such as PostgreSQL</span>
</span><span data-line="1617"><span class="sd">            ``SERIAL``, MySQL ``AUTO_INCREMENT``, or ``IDENTITY`` on SQL Server</span>
</span><span data-line="1618"><span class="sd">            should also be rendered.  Not every database backend has an</span>
</span><span data-line="1619"><span class="sd">            &quot;implied&quot; default generator available; for example the Oracle</span>
</span><span data-line="1620"><span class="sd">            backend always needs an explicit construct such as</span>
</span><span data-line="1621"><span class="sd">            :class:`.Identity` to be included with a :class:`.Column` in order</span>
</span><span data-line="1622"><span class="sd">            for the DDL rendered to include auto-generating constructs to also</span>
</span><span data-line="1623"><span class="sd">            be produced in the database.</span>
</span><span data-line="1624">
</span><span data-line="1625"><span class="sd">          * **INSERT semantics** (i.e. when a :func:`_sql.insert` construct is</span>
</span><span data-line="1626"><span class="sd">            compiled into a SQL string and is then executed on a database using</span>
</span><span data-line="1627"><span class="sd">            :meth:`_engine.Connection.execute` or equivalent): A single-row</span>
</span><span data-line="1628"><span class="sd">            INSERT statement will be known to produce a new integer primary key</span>
</span><span data-line="1629"><span class="sd">            value automatically for this column, which will be accessible</span>
</span><span data-line="1630"><span class="sd">            after the statement is invoked via the</span>
</span><span data-line="1631"><span class="sd">            :attr:`.CursorResult.inserted_primary_key` attribute upon the</span>
</span><span data-line="1632"><span class="sd">            :class:`_result.Result` object.   This also applies towards use of the</span>
</span><span data-line="1633"><span class="sd">            ORM when ORM-mapped objects are persisted to the database,</span>
</span><span data-line="1634"><span class="sd">            indicating that a new integer primary key will be available to</span>
</span><span data-line="1635"><span class="sd">            become part of the :term:`identity key` for that object.  This</span>
</span><span data-line="1636"><span class="sd">            behavior takes place regardless of what DDL constructs are</span>
</span><span data-line="1637"><span class="sd">            associated with the :class:`_schema.Column` and is independent</span>
</span><span data-line="1638"><span class="sd">            of the &quot;DDL Rendering&quot; behavior discussed in the previous note</span>
</span><span data-line="1639"><span class="sd">            above.</span>
</span><span data-line="1640">
</span><span data-line="1641"><span class="sd">          The parameter may be set to ``True`` to indicate that a column which</span>
</span><span data-line="1642"><span class="sd">          is part of a composite (i.e. multi-column) primary key should</span>
</span><span data-line="1643"><span class="sd">          have autoincrement semantics, though note that only one column</span>
</span><span data-line="1644"><span class="sd">          within a primary key may have this setting.    It can also</span>
</span><span data-line="1645"><span class="sd">          be set to ``True`` to indicate autoincrement semantics on a</span>
</span><span data-line="1646"><span class="sd">          column that has a client-side or server-side default configured,</span>
</span><span data-line="1647"><span class="sd">          however note that not all dialects can accommodate all styles</span>
</span><span data-line="1648"><span class="sd">          of default as an &quot;autoincrement&quot;.  It can also be</span>
</span><span data-line="1649"><span class="sd">          set to ``False`` on a single-column primary key that has a</span>
</span><span data-line="1650"><span class="sd">          datatype of INTEGER in order to disable auto increment semantics</span>
</span><span data-line="1651"><span class="sd">          for that column.</span>
</span><span data-line="1652">
</span><span data-line="1653"><span class="sd">          The setting *only* has an effect for columns which are:</span>
</span><span data-line="1654">
</span><span data-line="1655"><span class="sd">          * Integer derived (i.e. INT, SMALLINT, BIGINT).</span>
</span><span data-line="1656">
</span><span data-line="1657"><span class="sd">          * Part of the primary key</span>
</span><span data-line="1658">
</span><span data-line="1659"><span class="sd">          * Not referring to another column via :class:`_schema.ForeignKey`,</span>
</span><span data-line="1660"><span class="sd">            unless</span>
</span><span data-line="1661"><span class="sd">            the value is specified as ``&#39;ignore_fk&#39;``::</span>
</span><span data-line="1662">
</span><span data-line="1663"><span class="sd">                # turn on autoincrement for this column despite</span>
</span><span data-line="1664"><span class="sd">                # the ForeignKey()</span>
</span><span data-line="1665"><span class="sd">                Column(&#39;id&#39;, ForeignKey(&#39;other.id&#39;),</span>
</span><span data-line="1666"><span class="sd">                            primary_key=True, autoincrement=&#39;ignore_fk&#39;)</span>
</span><span data-line="1667">
</span><span data-line="1668"><span class="sd">          It is typically not desirable to have &quot;autoincrement&quot; enabled on a</span>
</span><span data-line="1669"><span class="sd">          column that refers to another via foreign key, as such a column is</span>
</span><span data-line="1670"><span class="sd">          required to refer to a value that originates from elsewhere.</span>
</span><span data-line="1671">
</span><span data-line="1672"><span class="sd">          The setting has these effects on columns that meet the</span>
</span><span data-line="1673"><span class="sd">          above criteria:</span>
</span><span data-line="1674">
</span><span data-line="1675"><span class="sd">          * DDL issued for the column, if the column does not already include</span>
</span><span data-line="1676"><span class="sd">            a default generating construct supported by the backend such as</span>
</span><span data-line="1677"><span class="sd">            :class:`.Identity`, will include database-specific</span>
</span><span data-line="1678"><span class="sd">            keywords intended to signify this column as an</span>
</span><span data-line="1679"><span class="sd">            &quot;autoincrement&quot; column for specific backends.   Behavior for</span>
</span><span data-line="1680"><span class="sd">            primary SQLAlchemy dialects includes:</span>
</span><span data-line="1681">
</span><span data-line="1682"><span class="sd">            * AUTO INCREMENT on MySQL and MariaDB</span>
</span><span data-line="1683"><span class="sd">            * SERIAL on PostgreSQL</span>
</span><span data-line="1684"><span class="sd">            * IDENTITY on MS-SQL - this occurs even without the</span>
</span><span data-line="1685"><span class="sd">              :class:`.Identity` construct as the</span>
</span><span data-line="1686"><span class="sd">              :paramref:`.Column.autoincrement` parameter pre-dates this</span>
</span><span data-line="1687"><span class="sd">              construct.</span>
</span><span data-line="1688"><span class="sd">            * SQLite - SQLite integer primary key columns are implicitly</span>
</span><span data-line="1689"><span class="sd">              &quot;auto incrementing&quot; and no additional keywords are rendered;</span>
</span><span data-line="1690"><span class="sd">              to render the special SQLite keyword ``AUTOINCREMENT``</span>
</span><span data-line="1691"><span class="sd">              is not included as this is unnecessary and not recommended</span>
</span><span data-line="1692"><span class="sd">              by the database vendor.  See the section</span>
</span><span data-line="1693"><span class="sd">              :ref:`sqlite_autoincrement` for more background.</span>
</span><span data-line="1694"><span class="sd">            * Oracle - The Oracle dialect has no default &quot;autoincrement&quot;</span>
</span><span data-line="1695"><span class="sd">              feature available at this time, instead the :class:`.Identity`</span>
</span><span data-line="1696"><span class="sd">              construct is recommended to achieve this (the :class:`.Sequence`</span>
</span><span data-line="1697"><span class="sd">              construct may also be used).</span>
</span><span data-line="1698"><span class="sd">            * Third-party dialects - consult those dialects&#39; documentation</span>
</span><span data-line="1699"><span class="sd">              for details on their specific behaviors.</span>
</span><span data-line="1700">
</span><span data-line="1701"><span class="sd">          * When a single-row :func:`_sql.insert` construct is compiled and</span>
</span><span data-line="1702"><span class="sd">            executed, which does not set the :meth:`_sql.Insert.inline`</span>
</span><span data-line="1703"><span class="sd">            modifier, newly generated primary key values for this column</span>
</span><span data-line="1704"><span class="sd">            will be automatically retrieved upon statement execution</span>
</span><span data-line="1705"><span class="sd">            using a method specific to the database driver in use:</span>
</span><span data-line="1706">
</span><span data-line="1707"><span class="sd">            * MySQL, SQLite - calling upon ``cursor.lastrowid()``</span>
</span><span data-line="1708"><span class="sd">              (see</span>
</span><span data-line="1709"><span class="sd">              `https://www.python.org/dev/peps/pep-0249/#lastrowid</span>
</span><span data-line="1710"><span class="sd">              &lt;https://www.python.org/dev/peps/pep-0249/#lastrowid&gt;`_)</span>
</span><span data-line="1711"><span class="sd">            * PostgreSQL, SQL Server, Oracle - use RETURNING or an equivalent</span>
</span><span data-line="1712"><span class="sd">              construct when rendering an INSERT statement, and then retrieving</span>
</span><span data-line="1713"><span class="sd">              the newly generated primary key values after execution</span>
</span><span data-line="1714"><span class="sd">            * PostgreSQL, Oracle for :class:`_schema.Table` objects that</span>
</span><span data-line="1715"><span class="sd">              set :paramref:`_schema.Table.implicit_returning` to False -</span>
</span><span data-line="1716"><span class="sd">              for a :class:`.Sequence` only, the :class:`.Sequence` is invoked</span>
</span><span data-line="1717"><span class="sd">              explicitly before the INSERT statement takes place so that the</span>
</span><span data-line="1718"><span class="sd">              newly generated primary key value is available to the client</span>
</span><span data-line="1719"><span class="sd">            * SQL Server for :class:`_schema.Table` objects that</span>
</span><span data-line="1720"><span class="sd">              set :paramref:`_schema.Table.implicit_returning` to False -</span>
</span><span data-line="1721"><span class="sd">              the ``SELECT scope_identity()`` construct is used after the</span>
</span><span data-line="1722"><span class="sd">              INSERT statement is invoked to retrieve the newly generated</span>
</span><span data-line="1723"><span class="sd">              primary key value.</span>
</span><span data-line="1724"><span class="sd">            * Third-party dialects - consult those dialects&#39; documentation</span>
</span><span data-line="1725"><span class="sd">              for details on their specific behaviors.</span>
</span><span data-line="1726">
</span><span data-line="1727"><span class="sd">          * For multiple-row :func:`_sql.insert` constructs invoked with</span>
</span><span data-line="1728"><span class="sd">            a list of parameters (i.e. &quot;executemany&quot; semantics), primary-key</span>
</span><span data-line="1729"><span class="sd">            retrieving behaviors are generally disabled, however there may</span>
</span><span data-line="1730"><span class="sd">            be special APIs that may be used to retrieve lists of new</span>
</span><span data-line="1731"><span class="sd">            primary key values for an &quot;executemany&quot;, such as the psycopg2</span>
</span><span data-line="1732"><span class="sd">            &quot;fast insertmany&quot; feature.  Such features are very new and</span>
</span><span data-line="1733"><span class="sd">            may not yet be well covered in documentation.</span>
</span><span data-line="1734">
</span><span data-line="1735"><span class="sd">        :param default: A scalar, Python callable, or</span>
</span><span data-line="1736"><span class="sd">            :class:`_expression.ColumnElement` expression representing the</span>
</span><span data-line="1737"><span class="sd">            *default value* for this column, which will be invoked upon insert</span>
</span><span data-line="1738"><span class="sd">            if this column is otherwise not specified in the VALUES clause of</span>
</span><span data-line="1739"><span class="sd">            the insert. This is a shortcut to using :class:`.ColumnDefault` as</span>
</span><span data-line="1740"><span class="sd">            a positional argument; see that class for full detail on the</span>
</span><span data-line="1741"><span class="sd">            structure of the argument.</span>
</span><span data-line="1742">
</span><span data-line="1743"><span class="sd">            Contrast this argument to</span>
</span><span data-line="1744"><span class="sd">            :paramref:`_schema.Column.server_default`</span>
</span><span data-line="1745"><span class="sd">            which creates a default generator on the database side.</span>
</span><span data-line="1746">
</span><span data-line="1747"><span class="sd">            .. seealso::</span>
</span><span data-line="1748">
</span><span data-line="1749"><span class="sd">                :ref:`metadata_defaults_toplevel`</span>
</span><span data-line="1750">
</span><span data-line="1751"><span class="sd">        :param insert_default: An alias of :paramref:`.Column.default`</span>
</span><span data-line="1752"><span class="sd">            for compatibility with :func:`_orm.mapped_column`.</span>
</span><span data-line="1753">
</span><span data-line="1754"><span class="sd">            .. versionadded: 2.0.31</span>
</span><span data-line="1755">
</span><span data-line="1756"><span class="sd">        :param doc: optional String that can be used by the ORM or similar</span>
</span><span data-line="1757"><span class="sd">            to document attributes on the Python side.   This attribute does</span>
</span><span data-line="1758"><span class="sd">            **not** render SQL comments; use the</span>
</span><span data-line="1759"><span class="sd">            :paramref:`_schema.Column.comment`</span>
</span><span data-line="1760"><span class="sd">            parameter for this purpose.</span>
</span><span data-line="1761">
</span><span data-line="1762"><span class="sd">        :param key: An optional string identifier which will identify this</span>
</span><span data-line="1763"><span class="sd">            ``Column`` object on the :class:`_schema.Table`.</span>
</span><span data-line="1764"><span class="sd">            When a key is provided,</span>
</span><span data-line="1765"><span class="sd">            this is the only identifier referencing the ``Column`` within the</span>
</span><span data-line="1766"><span class="sd">            application, including ORM attribute mapping; the ``name`` field</span>
</span><span data-line="1767"><span class="sd">            is used only when rendering SQL.</span>
</span><span data-line="1768">
</span><span data-line="1769"><span class="sd">        :param index: When ``True``, indicates that a :class:`_schema.Index`</span>
</span><span data-line="1770"><span class="sd">            construct will be automatically generated for this</span>
</span><span data-line="1771"><span class="sd">            :class:`_schema.Column`, which will result in a &quot;CREATE INDEX&quot;</span>
</span><span data-line="1772"><span class="sd">            statement being emitted for the :class:`_schema.Table` when the DDL</span>
</span><span data-line="1773"><span class="sd">            create operation is invoked.</span>
</span><span data-line="1774">
</span><span data-line="1775"><span class="sd">            Using this flag is equivalent to making use of the</span>
</span><span data-line="1776"><span class="sd">            :class:`_schema.Index` construct explicitly at the level of the</span>
</span><span data-line="1777"><span class="sd">            :class:`_schema.Table` construct itself::</span>
</span><span data-line="1778">
</span><span data-line="1779"><span class="sd">                Table(</span>
</span><span data-line="1780"><span class="sd">                    &quot;some_table&quot;,</span>
</span><span data-line="1781"><span class="sd">                    metadata,</span>
</span><span data-line="1782"><span class="sd">                    Column(&quot;x&quot;, Integer),</span>
</span><span data-line="1783"><span class="sd">                    Index(&quot;ix_some_table_x&quot;, &quot;x&quot;)</span>
</span><span data-line="1784"><span class="sd">                )</span>
</span><span data-line="1785">
</span><span data-line="1786"><span class="sd">            To add the :paramref:`_schema.Index.unique` flag to the</span>
</span><span data-line="1787"><span class="sd">            :class:`_schema.Index`, set both the</span>
</span><span data-line="1788"><span class="sd">            :paramref:`_schema.Column.unique` and</span>
</span><span data-line="1789"><span class="sd">            :paramref:`_schema.Column.index` flags to True simultaneously,</span>
</span><span data-line="1790"><span class="sd">            which will have the effect of rendering the &quot;CREATE UNIQUE INDEX&quot;</span>
</span><span data-line="1791"><span class="sd">            DDL instruction instead of &quot;CREATE INDEX&quot;.</span>
</span><span data-line="1792">
</span><span data-line="1793"><span class="sd">            The name of the index is generated using the</span>
</span><span data-line="1794"><span class="sd">            :ref:`default naming convention &lt;constraint_default_naming_convention&gt;`</span>
</span><span data-line="1795"><span class="sd">            which for the :class:`_schema.Index` construct is of the form</span>
</span><span data-line="1796"><span class="sd">            ``ix_&lt;tablename&gt;_&lt;columnname&gt;``.</span>
</span><span data-line="1797">
</span><span data-line="1798"><span class="sd">            As this flag is intended only as a convenience for the common case</span>
</span><span data-line="1799"><span class="sd">            of adding a single-column, default configured index to a table</span>
</span><span data-line="1800"><span class="sd">            definition, explicit use of the :class:`_schema.Index` construct</span>
</span><span data-line="1801"><span class="sd">            should be preferred for most use cases, including composite indexes</span>
</span><span data-line="1802"><span class="sd">            that encompass more than one column, indexes with SQL expressions</span>
</span><span data-line="1803"><span class="sd">            or ordering, backend-specific index configuration options, and</span>
</span><span data-line="1804"><span class="sd">            indexes that use a specific name.</span>
</span><span data-line="1805">
</span><span data-line="1806"><span class="sd">            .. note:: the :attr:`_schema.Column.index` attribute on</span>
</span><span data-line="1807"><span class="sd">               :class:`_schema.Column`</span>
</span><span data-line="1808"><span class="sd">               **does not indicate** if this column is indexed or not, only</span>
</span><span data-line="1809"><span class="sd">               if this flag was explicitly set here.  To view indexes on</span>
</span><span data-line="1810"><span class="sd">               a column, view the :attr:`_schema.Table.indexes` collection</span>
</span><span data-line="1811"><span class="sd">               or use :meth:`_reflection.Inspector.get_indexes`.</span>
</span><span data-line="1812">
</span><span data-line="1813"><span class="sd">            .. seealso::</span>
</span><span data-line="1814">
</span><span data-line="1815"><span class="sd">                :ref:`schema_indexes`</span>
</span><span data-line="1816">
</span><span data-line="1817"><span class="sd">                :ref:`constraint_naming_conventions`</span>
</span><span data-line="1818">
</span><span data-line="1819"><span class="sd">                :paramref:`_schema.Column.unique`</span>
</span><span data-line="1820">
</span><span data-line="1821"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="1822"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="1823">
</span><span data-line="1824"><span class="sd">        :param nullable: When set to ``False``, will cause the &quot;NOT NULL&quot;</span>
</span><span data-line="1825"><span class="sd">            phrase to be added when generating DDL for the column.   When</span>
</span><span data-line="1826"><span class="sd">            ``True``, will normally generate nothing (in SQL this defaults to</span>
</span><span data-line="1827"><span class="sd">            &quot;NULL&quot;), except in some very specific backend-specific edge cases</span>
</span><span data-line="1828"><span class="sd">            where &quot;NULL&quot; may render explicitly.</span>
</span><span data-line="1829"><span class="sd">            Defaults to ``True`` unless :paramref:`_schema.Column.primary_key`</span>
</span><span data-line="1830"><span class="sd">            is also ``True`` or the column specifies a :class:`_sql.Identity`,</span>
</span><span data-line="1831"><span class="sd">            in which case it defaults to ``False``.</span>
</span><span data-line="1832"><span class="sd">            This parameter is only used when issuing CREATE TABLE statements.</span>
</span><span data-line="1833">
</span><span data-line="1834"><span class="sd">            .. note::</span>
</span><span data-line="1835">
</span><span data-line="1836"><span class="sd">                When the column specifies a :class:`_sql.Identity` this</span>
</span><span data-line="1837"><span class="sd">                parameter is in general ignored by the DDL compiler. The</span>
</span><span data-line="1838"><span class="sd">                PostgreSQL database allows nullable identity column by</span>
</span><span data-line="1839"><span class="sd">                setting this parameter to ``True`` explicitly.</span>
</span><span data-line="1840">
</span><span data-line="1841"><span class="sd">        :param onupdate: A scalar, Python callable, or</span>
</span><span data-line="1842"><span class="sd">            :class:`~sqlalchemy.sql.expression.ClauseElement` representing a</span>
</span><span data-line="1843"><span class="sd">            default value to be applied to the column within UPDATE</span>
</span><span data-line="1844"><span class="sd">            statements, which will be invoked upon update if this column is not</span>
</span><span data-line="1845"><span class="sd">            present in the SET clause of the update. This is a shortcut to</span>
</span><span data-line="1846"><span class="sd">            using :class:`.ColumnDefault` as a positional argument with</span>
</span><span data-line="1847"><span class="sd">            ``for_update=True``.</span>
</span><span data-line="1848">
</span><span data-line="1849"><span class="sd">            .. seealso::</span>
</span><span data-line="1850">
</span><span data-line="1851"><span class="sd">                :ref:`metadata_defaults` - complete discussion of onupdate</span>
</span><span data-line="1852">
</span><span data-line="1853"><span class="sd">        :param primary_key: If ``True``, marks this column as a primary key</span>
</span><span data-line="1854"><span class="sd">            column. Multiple columns can have this flag set to specify</span>
</span><span data-line="1855"><span class="sd">            composite primary keys. As an alternative, the primary key of a</span>
</span><span data-line="1856"><span class="sd">            :class:`_schema.Table` can be specified via an explicit</span>
</span><span data-line="1857"><span class="sd">            :class:`.PrimaryKeyConstraint` object.</span>
</span><span data-line="1858">
</span><span data-line="1859"><span class="sd">        :param server_default: A :class:`.FetchedValue` instance, str, Unicode</span>
</span><span data-line="1860"><span class="sd">            or :func:`~sqlalchemy.sql.expression.text` construct representing</span>
</span><span data-line="1861"><span class="sd">            the DDL DEFAULT value for the column.</span>
</span><span data-line="1862">
</span><span data-line="1863"><span class="sd">            String types will be emitted as-is, surrounded by single quotes::</span>
</span><span data-line="1864">
</span><span data-line="1865"><span class="sd">                Column(&#39;x&#39;, Text, server_default=&quot;val&quot;)</span>
</span><span data-line="1866">
</span><span data-line="1867"><span class="sd">                x TEXT DEFAULT &#39;val&#39;</span>
</span><span data-line="1868">
</span><span data-line="1869"><span class="sd">            A :func:`~sqlalchemy.sql.expression.text` expression will be</span>
</span><span data-line="1870"><span class="sd">            rendered as-is, without quotes::</span>
</span><span data-line="1871">
</span><span data-line="1872"><span class="sd">                Column(&#39;y&#39;, DateTime, server_default=text(&#39;NOW()&#39;))</span>
</span><span data-line="1873">
</span><span data-line="1874"><span class="sd">                y DATETIME DEFAULT NOW()</span>
</span><span data-line="1875">
</span><span data-line="1876"><span class="sd">            Strings and text() will be converted into a</span>
</span><span data-line="1877"><span class="sd">            :class:`.DefaultClause` object upon initialization.</span>
</span><span data-line="1878">
</span><span data-line="1879"><span class="sd">            This parameter can also accept complex combinations of contextually</span>
</span><span data-line="1880"><span class="sd">            valid SQLAlchemy expressions or constructs::</span>
</span><span data-line="1881">
</span><span data-line="1882"><span class="sd">                from sqlalchemy import create_engine</span>
</span><span data-line="1883"><span class="sd">                from sqlalchemy import Table, Column, MetaData, ARRAY, Text</span>
</span><span data-line="1884"><span class="sd">                from sqlalchemy.dialects.postgresql import array</span>
</span><span data-line="1885">
</span><span data-line="1886"><span class="sd">                engine = create_engine(</span>
</span><span data-line="1887"><span class="sd">                    &#39;postgresql+psycopg2://scott:tiger@localhost/mydatabase&#39;</span>
</span><span data-line="1888"><span class="sd">                )</span>
</span><span data-line="1889"><span class="sd">                metadata_obj = MetaData()</span>
</span><span data-line="1890"><span class="sd">                tbl = Table(</span>
</span><span data-line="1891"><span class="sd">                        &quot;foo&quot;,</span>
</span><span data-line="1892"><span class="sd">                        metadata_obj,</span>
</span><span data-line="1893"><span class="sd">                        Column(&quot;bar&quot;,</span>
</span><span data-line="1894"><span class="sd">                               ARRAY(Text),</span>
</span><span data-line="1895"><span class="sd">                               server_default=array([&quot;biz&quot;, &quot;bang&quot;, &quot;bash&quot;])</span>
</span><span data-line="1896"><span class="sd">                               )</span>
</span><span data-line="1897"><span class="sd">                )</span>
</span><span data-line="1898"><span class="sd">                metadata_obj.create_all(engine)</span>
</span><span data-line="1899">
</span><span data-line="1900"><span class="sd">            The above results in a table created with the following SQL::</span>
</span><span data-line="1901">
</span><span data-line="1902"><span class="sd">                CREATE TABLE foo (</span>
</span><span data-line="1903"><span class="sd">                    bar TEXT[] DEFAULT ARRAY[&#39;biz&#39;, &#39;bang&#39;, &#39;bash&#39;]</span>
</span><span data-line="1904"><span class="sd">                )</span>
</span><span data-line="1905">
</span><span data-line="1906"><span class="sd">            Use :class:`.FetchedValue` to indicate that an already-existing</span>
</span><span data-line="1907"><span class="sd">            column will generate a default value on the database side which</span>
</span><span data-line="1908"><span class="sd">            will be available to SQLAlchemy for post-fetch after inserts. This</span>
</span><span data-line="1909"><span class="sd">            construct does not specify any DDL and the implementation is left</span>
</span><span data-line="1910"><span class="sd">            to the database, such as via a trigger.</span>
</span><span data-line="1911">
</span><span data-line="1912"><span class="sd">            .. seealso::</span>
</span><span data-line="1913">
</span><span data-line="1914"><span class="sd">                :ref:`server_defaults` - complete discussion of server side</span>
</span><span data-line="1915"><span class="sd">                defaults</span>
</span><span data-line="1916">
</span><span data-line="1917"><span class="sd">        :param server_onupdate: A :class:`.FetchedValue` instance</span>
</span><span data-line="1918"><span class="sd">            representing a database-side default generation function,</span>
</span><span data-line="1919"><span class="sd">            such as a trigger. This</span>
</span><span data-line="1920"><span class="sd">            indicates to SQLAlchemy that a newly generated value will be</span>
</span><span data-line="1921"><span class="sd">            available after updates. This construct does not actually</span>
</span><span data-line="1922"><span class="sd">            implement any kind of generation function within the database,</span>
</span><span data-line="1923"><span class="sd">            which instead must be specified separately.</span>
</span><span data-line="1924">
</span><span data-line="1925">
</span><span data-line="1926"><span class="sd">            .. warning:: This directive **does not** currently produce MySQL&#39;s</span>
</span><span data-line="1927"><span class="sd">               &quot;ON UPDATE CURRENT_TIMESTAMP()&quot; clause.  See</span>
</span><span data-line="1928"><span class="sd">               :ref:`mysql_timestamp_onupdate` for background on how to</span>
</span><span data-line="1929"><span class="sd">               produce this clause.</span>
</span><span data-line="1930">
</span><span data-line="1931"><span class="sd">            .. seealso::</span>
</span><span data-line="1932">
</span><span data-line="1933"><span class="sd">                :ref:`triggered_columns`</span>
</span><span data-line="1934">
</span><span data-line="1935"><span class="sd">        :param quote: Force quoting of this column&#39;s name on or off,</span>
</span><span data-line="1936"><span class="sd">             corresponding to ``True`` or ``False``. When left at its default</span>
</span><span data-line="1937"><span class="sd">             of ``None``, the column identifier will be quoted according to</span>
</span><span data-line="1938"><span class="sd">             whether the name is case sensitive (identifiers with at least one</span>
</span><span data-line="1939"><span class="sd">             upper case character are treated as case sensitive), or if it&#39;s a</span>
</span><span data-line="1940"><span class="sd">             reserved word. This flag is only needed to force quoting of a</span>
</span><span data-line="1941"><span class="sd">             reserved word which is not known by the SQLAlchemy dialect.</span>
</span><span data-line="1942">
</span><span data-line="1943"><span class="sd">        :param unique: When ``True``, and the :paramref:`_schema.Column.index`</span>
</span><span data-line="1944"><span class="sd">            parameter is left at its default value of ``False``,</span>
</span><span data-line="1945"><span class="sd">            indicates that a :class:`_schema.UniqueConstraint`</span>
</span><span data-line="1946"><span class="sd">            construct will be automatically generated for this</span>
</span><span data-line="1947"><span class="sd">            :class:`_schema.Column`,</span>
</span><span data-line="1948"><span class="sd">            which will result in a &quot;UNIQUE CONSTRAINT&quot; clause referring</span>
</span><span data-line="1949"><span class="sd">            to this column being included</span>
</span><span data-line="1950"><span class="sd">            in the ``CREATE TABLE`` statement emitted, when the DDL create</span>
</span><span data-line="1951"><span class="sd">            operation for the :class:`_schema.Table` object is invoked.</span>
</span><span data-line="1952">
</span><span data-line="1953"><span class="sd">            When this flag is ``True`` while the</span>
</span><span data-line="1954"><span class="sd">            :paramref:`_schema.Column.index` parameter is simultaneously</span>
</span><span data-line="1955"><span class="sd">            set to ``True``, the effect instead is that a</span>
</span><span data-line="1956"><span class="sd">            :class:`_schema.Index` construct which includes the</span>
</span><span data-line="1957"><span class="sd">            :paramref:`_schema.Index.unique` parameter set to ``True``</span>
</span><span data-line="1958"><span class="sd">            is generated.  See the documentation for</span>
</span><span data-line="1959"><span class="sd">            :paramref:`_schema.Column.index` for additional detail.</span>
</span><span data-line="1960">
</span><span data-line="1961"><span class="sd">            Using this flag is equivalent to making use of the</span>
</span><span data-line="1962"><span class="sd">            :class:`_schema.UniqueConstraint` construct explicitly at the</span>
</span><span data-line="1963"><span class="sd">            level of the :class:`_schema.Table` construct itself::</span>
</span><span data-line="1964">
</span><span data-line="1965"><span class="sd">                Table(</span>
</span><span data-line="1966"><span class="sd">                    &quot;some_table&quot;,</span>
</span><span data-line="1967"><span class="sd">                    metadata,</span>
</span><span data-line="1968"><span class="sd">                    Column(&quot;x&quot;, Integer),</span>
</span><span data-line="1969"><span class="sd">                    UniqueConstraint(&quot;x&quot;)</span>
</span><span data-line="1970"><span class="sd">                )</span>
</span><span data-line="1971">
</span><span data-line="1972"><span class="sd">            The :paramref:`_schema.UniqueConstraint.name` parameter</span>
</span><span data-line="1973"><span class="sd">            of the unique constraint object is left at its default value</span>
</span><span data-line="1974"><span class="sd">            of ``None``; in the absence of a :ref:`naming convention &lt;constraint_naming_conventions&gt;`</span>
</span><span data-line="1975"><span class="sd">            for the enclosing :class:`_schema.MetaData`, the UNIQUE CONSTRAINT</span>
</span><span data-line="1976"><span class="sd">            construct will be emitted as unnamed, which typically invokes</span>
</span><span data-line="1977"><span class="sd">            a database-specific naming convention to take place.</span>
</span><span data-line="1978">
</span><span data-line="1979"><span class="sd">            As this flag is intended only as a convenience for the common case</span>
</span><span data-line="1980"><span class="sd">            of adding a single-column, default configured unique constraint to a table</span>
</span><span data-line="1981"><span class="sd">            definition, explicit use of the :class:`_schema.UniqueConstraint` construct</span>
</span><span data-line="1982"><span class="sd">            should be preferred for most use cases, including composite constraints</span>
</span><span data-line="1983"><span class="sd">            that encompass more than one column, backend-specific index configuration options, and</span>
</span><span data-line="1984"><span class="sd">            constraints that use a specific name.</span>
</span><span data-line="1985">
</span><span data-line="1986"><span class="sd">            .. note:: the :attr:`_schema.Column.unique` attribute on</span>
</span><span data-line="1987"><span class="sd">                :class:`_schema.Column`</span>
</span><span data-line="1988"><span class="sd">                **does not indicate** if this column has a unique constraint or</span>
</span><span data-line="1989"><span class="sd">                not, only if this flag was explicitly set here.  To view</span>
</span><span data-line="1990"><span class="sd">                indexes and unique constraints that may involve this column,</span>
</span><span data-line="1991"><span class="sd">                view the</span>
</span><span data-line="1992"><span class="sd">                :attr:`_schema.Table.indexes` and/or</span>
</span><span data-line="1993"><span class="sd">                :attr:`_schema.Table.constraints` collections or use</span>
</span><span data-line="1994"><span class="sd">                :meth:`_reflection.Inspector.get_indexes` and/or</span>
</span><span data-line="1995"><span class="sd">                :meth:`_reflection.Inspector.get_unique_constraints`</span>
</span><span data-line="1996">
</span><span data-line="1997"><span class="sd">            .. seealso::</span>
</span><span data-line="1998">
</span><span data-line="1999"><span class="sd">                :ref:`schema_unique_constraint`</span>
</span><span data-line="2000">
</span><span data-line="2001"><span class="sd">                :ref:`constraint_naming_conventions`</span>
</span><span data-line="2002">
</span><span data-line="2003"><span class="sd">                :paramref:`_schema.Column.index`</span>
</span><span data-line="2004">
</span><span data-line="2005"><span class="sd">        :param system: When ``True``, indicates this is a &quot;system&quot; column,</span>
</span><span data-line="2006"><span class="sd">             that is a column which is automatically made available by the</span>
</span><span data-line="2007"><span class="sd">             database, and should not be included in the columns list for a</span>
</span><span data-line="2008"><span class="sd">             ``CREATE TABLE`` statement.</span>
</span><span data-line="2009">
</span><span data-line="2010"><span class="sd">             For more elaborate scenarios where columns should be</span>
</span><span data-line="2011"><span class="sd">             conditionally rendered differently on different backends,</span>
</span><span data-line="2012"><span class="sd">             consider custom compilation rules for :class:`.CreateColumn`.</span>
</span><span data-line="2013">
</span><span data-line="2014"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span data-line="2015"><span class="sd">             table creation.</span>
</span><span data-line="2016">
</span><span data-line="2017"><span class="sd">             .. versionadded:: 1.2 Added the</span>
</span><span data-line="2018"><span class="sd">                :paramref:`_schema.Column.comment`</span>
</span><span data-line="2019"><span class="sd">                parameter to :class:`_schema.Column`.</span>
</span><span data-line="2020">
</span><span data-line="2021"><span class="sd">        :param insert_sentinel: Marks this :class:`_schema.Column` as an</span>
</span><span data-line="2022"><span class="sd">         :term:`insert sentinel` used for optimizing the performance of the</span>
</span><span data-line="2023"><span class="sd">         :term:`insertmanyvalues` feature for tables that don&#39;t</span>
</span><span data-line="2024"><span class="sd">         otherwise have qualifying primary key configurations.</span>
</span><span data-line="2025">
</span><span data-line="2026"><span class="sd">         .. versionadded:: 2.0.10</span>
</span><span data-line="2027">
</span><span data-line="2028"><span class="sd">         .. seealso::</span>
</span><span data-line="2029">
</span><span data-line="2030"><span class="sd">            :func:`_schema.insert_sentinel` - all in one helper for declaring</span>
</span><span data-line="2031"><span class="sd">            sentinel columns</span>
</span><span data-line="2032">
</span><span data-line="2033"><span class="sd">            :ref:`engine_insertmanyvalues`</span>
</span><span data-line="2034">
</span><span data-line="2035"><span class="sd">            :ref:`engine_insertmanyvalues_sentinel_columns`</span>
</span><span data-line="2036">
</span><span data-line="2037">
</span><span data-line="2038"><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501, RST201, RST202</span>
</span><span data-line="2039">
</span><span data-line="2040">        <span class="n">l_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">__name_pos</span><span class="p">,</span> <span class="n">__type_pos</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span data-line="2041">        <span class="k">del</span> <span class="n">args</span>
</span><span data-line="2042">
</span><span data-line="2043">        <span class="k">if</span> <span class="n">l_args</span><span class="p">:</span>
</span><span data-line="2044">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="2045">                <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2046">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2047">                        <span class="s2">&quot;May not pass name positionally and as a keyword.&quot;</span>
</span><span data-line="2048">                    <span class="p">)</span>
</span><span data-line="2049">                <span class="n">name</span> <span class="o">=</span> <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2050">            <span class="k">elif</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2051">                <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="2052">        <span class="k">if</span> <span class="n">l_args</span><span class="p">:</span>
</span><span data-line="2053">            <span class="n">coltype</span> <span class="o">=</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="2054">
</span><span data-line="2055">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coltype</span><span class="p">,</span> <span class="s2">&quot;_sqla_type&quot;</span><span class="p">):</span>
</span><span data-line="2056">                <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2057">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2058">                        <span class="s2">&quot;May not pass type_ positionally and as a keyword.&quot;</span>
</span><span data-line="2059">                    <span class="p">)</span>
</span><span data-line="2060">                <span class="n">type_</span> <span class="o">=</span> <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2061">            <span class="k">elif</span> <span class="n">l_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2062">                <span class="n">l_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="2063">
</span><span data-line="2064">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2065">            <span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span data-line="2066">        <span class="k">elif</span> <span class="n">quote</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2067">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2068">                <span class="s2">&quot;Explicit &#39;name&#39; is required when sending &#39;quote&#39; argument&quot;</span>
</span><span data-line="2069">            <span class="p">)</span>
</span><span data-line="2070">
</span><span data-line="2071">        <span class="c1"># name = None is expected to be an interim state</span>
</span><span data-line="2072">        <span class="c1"># note this use case is legacy now that ORM declarative has a</span>
</span><span data-line="2073">        <span class="c1"># dedicated &quot;column&quot; construct local to the ORM</span>
</span><span data-line="2074">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">type_</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2075">
</span><span data-line="2076">        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2077">        <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>
</span><span data-line="2078">        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span> <span class="o">=</span> <span class="n">insert_sentinel</span>
</span><span data-line="2079">        <span class="bp">self</span><span class="o">.</span><span class="n">_omit_from_statements</span> <span class="o">=</span> <span class="n">_omit_from_statements</span>
</span><span data-line="2080">        <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="n">udn</span> <span class="o">=</span> <span class="n">nullable</span>
</span><span data-line="2081">        <span class="k">if</span> <span class="n">udn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span data-line="2082">            <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">udn</span>
</span><span data-line="2083">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2084">            <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">primary_key</span>
</span><span data-line="2085">
</span><span data-line="2086">        <span class="c1"># these default to None because .index and .unique is *not*</span>
</span><span data-line="2087">        <span class="c1"># an informational flag about Column - there can still be an</span>
</span><span data-line="2088">        <span class="c1"># Index or UniqueConstraint referring to this Column.</span>
</span><span data-line="2089">        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
</span><span data-line="2090">        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
</span><span data-line="2091">
</span><span data-line="2092">        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
</span><span data-line="2093">        <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">doc</span>
</span><span data-line="2094">        <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span><span class="p">:</span> <span class="n">_AutoIncrementType</span> <span class="o">=</span> <span class="n">autoincrement</span>
</span><span data-line="2095">        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="2096">        <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="2097">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span data-line="2098">        <span class="bp">self</span><span class="o">.</span><span class="n">computed</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2099">        <span class="bp">self</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2100">
</span><span data-line="2101">        <span class="c1"># check if this Column is proxying another column</span>
</span><span data-line="2102">
</span><span data-line="2103">        <span class="k">if</span> <span class="n">_proxies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2104">            <span class="bp">self</span><span class="o">.</span><span class="n">_proxies</span> <span class="o">=</span> <span class="n">_proxies</span>
</span><span data-line="2105">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2106">            <span class="c1"># otherwise, add DDL-related events</span>
</span><span data-line="2107">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span data-line="2108">
</span><span data-line="2109">        <span class="k">if</span> <span class="n">insert_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">:</span>
</span><span data-line="2110">            <span class="n">resolved_default</span> <span class="o">=</span> <span class="n">insert_default</span>
</span><span data-line="2111">        <span class="k">elif</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_NoArg</span><span class="o">.</span><span class="n">NO_ARG</span><span class="p">:</span>
</span><span data-line="2112">            <span class="n">resolved_default</span> <span class="o">=</span> <span class="n">default</span>
</span><span data-line="2113">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2114">            <span class="n">resolved_default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2115">
</span><span data-line="2116">        <span class="k">if</span> <span class="n">resolved_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2117">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolved_default</span><span class="p">,</span> <span class="p">(</span><span class="n">ColumnDefault</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)):</span>
</span><span data-line="2118">                <span class="n">resolved_default</span> <span class="o">=</span> <span class="n">ColumnDefault</span><span class="p">(</span><span class="n">resolved_default</span><span class="p">)</span>
</span><span data-line="2119">
</span><span data-line="2120">            <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">resolved_default</span>
</span><span data-line="2121">            <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resolved_default</span><span class="p">)</span>
</span><span data-line="2122">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2123">            <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2124">
</span><span data-line="2125">        <span class="k">if</span> <span class="n">onupdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2126">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">onupdate</span><span class="p">,</span> <span class="p">(</span><span class="n">ColumnDefault</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)):</span>
</span><span data-line="2127">                <span class="n">onupdate</span> <span class="o">=</span> <span class="n">ColumnDefault</span><span class="p">(</span><span class="n">onupdate</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="2128">
</span><span data-line="2129">            <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span data-line="2130">            <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">onupdate</span><span class="p">)</span>
</span><span data-line="2131">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2132">            <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2133">
</span><span data-line="2134">        <span class="k">if</span> <span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2135">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_default</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span data-line="2136">                <span class="n">server_default</span> <span class="o">=</span> <span class="n">server_default</span><span class="o">.</span><span class="n">_as_for_update</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="2137">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span data-line="2138">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2139">                <span class="n">server_default</span> <span class="o">=</span> <span class="n">DefaultClause</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span data-line="2140">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="p">)</span>
</span><span data-line="2141">        <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="n">server_default</span>
</span><span data-line="2142">
</span><span data-line="2143">        <span class="k">if</span> <span class="n">server_onupdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2144">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span data-line="2145">                <span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">server_onupdate</span><span class="o">.</span><span class="n">_as_for_update</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="2146">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">)</span>
</span><span data-line="2147">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2148">                <span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">DefaultClause</span><span class="p">(</span>
</span><span data-line="2149">                    <span class="n">server_onupdate</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="2150">                <span class="p">)</span>
</span><span data-line="2151">                <span class="n">l_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_onupdate</span><span class="p">)</span>
</span><span data-line="2152">        <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="n">server_onupdate</span>
</span><span data-line="2153">
</span><span data-line="2154">        <span class="bp">self</span><span class="o">.</span><span class="n">_init_items</span><span class="p">(</span><span class="o">*</span><span class="n">cast</span><span class="p">(</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">SchemaItem</span><span class="p">],</span> <span class="n">l_args</span><span class="p">))</span>
</span><span data-line="2155">
</span><span data-line="2156">        <span class="n">util</span><span class="o">.</span><span class="n">set_creation_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="2157">
</span><span data-line="2158">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2159">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="2160">
</span><span data-line="2161">        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">)</span>
</span><span data-line="2162">
</span><span data-line="2163">    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span>
</span><span data-line="2164">
</span><span data-line="2165">    <span class="n">constraints</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Constraint</span><span class="p">]</span>
</span><span data-line="2166">
</span><span data-line="2167">    <span class="n">foreign_keys</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span>
</span><span data-line="2168"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of all :class:`_schema.ForeignKey` marker objects</span>
</span><span data-line="2169"><span class="sd">       associated with this :class:`_schema.Column`.</span>
</span><span data-line="2170">
</span><span data-line="2171"><span class="sd">       Each object is a member of a :class:`_schema.Table`-wide</span>
</span><span data-line="2172"><span class="sd">       :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="2173">
</span><span data-line="2174"><span class="sd">       .. seealso::</span>
</span><span data-line="2175">
</span><span data-line="2176"><span class="sd">           :attr:`_schema.Table.foreign_keys`</span>
</span><span data-line="2177">
</span><span data-line="2178"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="2179">
</span><span data-line="2180">    <span class="n">index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</span><span data-line="2181"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The value of the :paramref:`_schema.Column.index` parameter.</span>
</span><span data-line="2182">
</span><span data-line="2183"><span class="sd">       Does not indicate if this :class:`_schema.Column` is actually indexed</span>
</span><span data-line="2184"><span class="sd">       or not; use :attr:`_schema.Table.indexes`.</span>
</span><span data-line="2185">
</span><span data-line="2186"><span class="sd">       .. seealso::</span>
</span><span data-line="2187">
</span><span data-line="2188"><span class="sd">           :attr:`_schema.Table.indexes`</span>
</span><span data-line="2189"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="2190">
</span><span data-line="2191">    <span class="n">unique</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</span><span data-line="2192"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The value of the :paramref:`_schema.Column.unique` parameter.</span>
</span><span data-line="2193">
</span><span data-line="2194"><span class="sd">       Does not indicate if this :class:`_schema.Column` is actually subject to</span>
</span><span data-line="2195"><span class="sd">       a unique constraint or not; use :attr:`_schema.Table.indexes` and</span>
</span><span data-line="2196"><span class="sd">       :attr:`_schema.Table.constraints`.</span>
</span><span data-line="2197">
</span><span data-line="2198"><span class="sd">       .. seealso::</span>
</span><span data-line="2199">
</span><span data-line="2200"><span class="sd">           :attr:`_schema.Table.indexes`</span>
</span><span data-line="2201">
</span><span data-line="2202"><span class="sd">           :attr:`_schema.Table.constraints`.</span>
</span><span data-line="2203">
</span><span data-line="2204"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="2205">
</span><span data-line="2206">    <span class="n">computed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Computed</span><span class="p">]</span>
</span><span data-line="2207">
</span><span data-line="2208">    <span class="n">identity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Identity</span><span class="p">]</span>
</span><span data-line="2209">
</span><span data-line="2210">    <span class="k">def</span> <span class="nf">_set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="n">TypeEngine</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2211">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span> <span class="ow">or</span> <span class="n">type_</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span><span data-line="2212">
</span><span data-line="2213">        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
</span><span data-line="2214">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2215">            <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="2216">        <span class="k">for</span> <span class="n">impl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_variant_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span data-line="2217">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">impl</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2218">                <span class="n">impl</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="2219">
</span><span data-line="2220">    <span class="nd">@HasMemoized</span><span class="o">.</span><span class="n">memoized_attribute</span>
</span><span data-line="2221">    <span class="k">def</span> <span class="nf">_default_description_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DefaultDescriptionTuple</span><span class="p">:</span>
</span><span data-line="2222"><span class="w">        </span><span class="sd">&quot;&quot;&quot;used by default.py -&gt; _process_execute_defaults()&quot;&quot;&quot;</span>
</span><span data-line="2223">
</span><span data-line="2224">        <span class="k">return</span> <span class="n">_DefaultDescriptionTuple</span><span class="o">.</span><span class="n">_from_column_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</span><span data-line="2225">
</span><span data-line="2226">    <span class="nd">@HasMemoized</span><span class="o">.</span><span class="n">memoized_attribute</span>
</span><span data-line="2227">    <span class="k">def</span> <span class="nf">_onupdate_description_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DefaultDescriptionTuple</span><span class="p">:</span>
</span><span data-line="2228"><span class="w">        </span><span class="sd">&quot;&quot;&quot;used by default.py -&gt; _process_execute_defaults()&quot;&quot;&quot;</span>
</span><span data-line="2229">        <span class="k">return</span> <span class="n">_DefaultDescriptionTuple</span><span class="o">.</span><span class="n">_from_column_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">)</span>
</span><span data-line="2230">
</span><span data-line="2231">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span data-line="2232">    <span class="k">def</span> <span class="nf">_gen_static_annotations_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2233"><span class="w">        </span><span class="sd">&quot;&quot;&quot;special attribute used by cache key gen, if true, we will</span>
</span><span data-line="2234"><span class="sd">        use a static cache key for the annotations dictionary, else we</span>
</span><span data-line="2235"><span class="sd">        will generate a new cache key for annotations each time.</span>
</span><span data-line="2236">
</span><span data-line="2237"><span class="sd">        Added for #8790</span>
</span><span data-line="2238">
</span><span data-line="2239"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2240">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_is_table</span>
</span><span data-line="2241">
</span><span data-line="2242">    <span class="k">def</span> <span class="nf">_extra_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2243">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span data-line="2244">
</span><span data-line="2245">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="2246">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2247">            <span class="k">return</span> <span class="s2">&quot;(no name)&quot;</span>
</span><span data-line="2248">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2249">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">named_with_column</span><span class="p">:</span>
</span><span data-line="2250">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span data-line="2251">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2252">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span data-line="2253">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2254">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
</span><span data-line="2255">
</span><span data-line="2256">    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="2257"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if this Column references the given column via foreign</span>
</span><span data-line="2258"><span class="sd">        key.&quot;&quot;&quot;</span>
</span><span data-line="2259">
</span><span data-line="2260">        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span data-line="2261">            <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">proxy_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">proxy_set</span><span class="p">):</span>
</span><span data-line="2262">                <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="2263">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2264">            <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="2265">
</span><span data-line="2266">    <span class="k">def</span> <span class="nf">append_foreign_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2267">        <span class="n">fk</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="2268">
</span><span data-line="2269">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="2270">        <span class="n">kwarg</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="2271">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span data-line="2272">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">)</span>
</span><span data-line="2273">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="2274">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;primary_key&quot;</span><span class="p">)</span>
</span><span data-line="2275">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span data-line="2276">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;nullable&quot;</span><span class="p">)</span>
</span><span data-line="2277">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">:</span>
</span><span data-line="2278">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;onupdate&quot;</span><span class="p">)</span>
</span><span data-line="2279">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
</span><span data-line="2280">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span data-line="2281">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span><span class="p">:</span>
</span><span data-line="2282">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;server_default&quot;</span><span class="p">)</span>
</span><span data-line="2283">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">:</span>
</span><span data-line="2284">            <span class="n">kwarg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">)</span>
</span><span data-line="2285">        <span class="k">return</span> <span class="s2">&quot;Column(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span data-line="2286">            <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span data-line="2287">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)]</span>
</span><span data-line="2288">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span data-line="2289">            <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span>
</span><span data-line="2290">            <span class="o">+</span> <span class="p">[</span>
</span><span data-line="2291">                <span class="p">(</span>
</span><span data-line="2292">                    <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="2293">                    <span class="ow">and</span> <span class="s2">&quot;table=&lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span>
</span><span data-line="2294">                    <span class="ow">or</span> <span class="s2">&quot;table=None&quot;</span>
</span><span data-line="2295">                <span class="p">)</span>
</span><span data-line="2296">            <span class="p">]</span>
</span><span data-line="2297">            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwarg</span><span class="p">]</span>
</span><span data-line="2298">        <span class="p">)</span>
</span><span data-line="2299">
</span><span data-line="2300">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
</span><span data-line="2301">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="2302">        <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span>
</span><span data-line="2303">        <span class="o">*</span><span class="p">,</span>
</span><span data-line="2304">        <span class="n">all_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span>
</span><span data-line="2305">        <span class="n">allow_replacements</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span data-line="2306">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="2307">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2308">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="2309">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="2310">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span data-line="2311">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2312">                <span class="s2">&quot;Column must be constructed with a non-blank name or &quot;</span>
</span><span data-line="2313">                <span class="s2">&quot;assign a non-blank .name before adding to a Table.&quot;</span>
</span><span data-line="2314">            <span class="p">)</span>
</span><span data-line="2315">
</span><span data-line="2316">        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_memoizations</span><span class="p">()</span>
</span><span data-line="2317">
</span><span data-line="2318">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2319">            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="2320">
</span><span data-line="2321">        <span class="n">existing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="2322">        <span class="k">if</span> <span class="n">existing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">existing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">table</span><span class="p">:</span>
</span><span data-line="2323">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2324">                <span class="sa">f</span><span class="s2">&quot;Column object &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; already &quot;</span>
</span><span data-line="2325">                <span class="sa">f</span><span class="s2">&quot;assigned to Table &#39;</span><span class="si">{</span><span class="n">existing</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span data-line="2326">            <span class="p">)</span>
</span><span data-line="2327">
</span><span data-line="2328">        <span class="n">extra_remove</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2329">        <span class="n">existing_col</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2330">        <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="2331">
</span><span data-line="2332">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span data-line="2333">            <span class="n">existing_col</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="2334">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span data-line="2335">                <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
</span><span data-line="2336">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2337">                <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span>
</span><span data-line="2338">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
</span><span data-line="2339">            <span class="n">existing_col</span> <span class="o">=</span> <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span data-line="2340">            <span class="n">extra_remove</span> <span class="o">=</span> <span class="p">{</span><span class="n">existing_col</span><span class="p">}</span>
</span><span data-line="2341">            <span class="n">conflicts_on</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
</span><span data-line="2342">
</span><span data-line="2343">        <span class="k">if</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2344">            <span class="k">if</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="2345">                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_replacements</span><span class="p">:</span>
</span><span data-line="2346">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">DuplicateColumnError</span><span class="p">(</span>
</span><span data-line="2347">                        <span class="sa">f</span><span class="s2">&quot;A column with </span><span class="si">{</span><span class="n">conflicts_on</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span data-line="2348">                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&#39;</span><span class="si">{</span>
</span><span data-line="2349"><span class="w">                            </span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">conflicts_on</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;key&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="2350"><span class="w">                        </span><span class="si">}</span><span class="s2">&#39; &quot;&quot;&quot;</span>
</span><span data-line="2351">                        <span class="sa">f</span><span class="s2">&quot;is already present in table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span data-line="2352">                    <span class="p">)</span>
</span><span data-line="2353">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">existing_col</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span data-line="2354">                    <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span data-line="2355">                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span data-line="2356">                        <span class="c1"># this might have been removed</span>
</span><span data-line="2357">                        <span class="c1"># already, if it&#39;s a composite constraint</span>
</span><span data-line="2358">                        <span class="c1"># and more than one col being replaced</span>
</span><span data-line="2359">                        <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">constraint</span><span class="p">)</span>
</span><span data-line="2360">
</span><span data-line="2361">        <span class="k">if</span> <span class="n">extra_remove</span> <span class="ow">and</span> <span class="n">existing_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
</span><span data-line="2362">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="2363">                <span class="sa">f</span><span class="s1">&#39;Column with user-specified key &quot;</span><span class="si">{</span><span class="n">existing_col</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; is &#39;</span>
</span><span data-line="2364">                <span class="s2">&quot;being replaced with &quot;</span>
</span><span data-line="2365">                <span class="sa">f</span><span class="s1">&#39;plain named column &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;, &#39;</span>
</span><span data-line="2366">                <span class="sa">f</span><span class="s1">&#39;key &quot;</span><span class="si">{</span><span class="n">existing_col</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; is being removed.  If this is a &#39;</span>
</span><span data-line="2367">                <span class="s2">&quot;reflection operation, specify autoload_replace=False to &quot;</span>
</span><span data-line="2368">                <span class="s2">&quot;prevent this replacement.&quot;</span>
</span><span data-line="2369">            <span class="p">)</span>
</span><span data-line="2370">        <span class="n">table</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_remove</span><span class="o">=</span><span class="n">extra_remove</span><span class="p">)</span>
</span><span data-line="2371">        <span class="n">all_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="2372">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span data-line="2373">
</span><span data-line="2374">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">:</span>
</span><span data-line="2375">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2376">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2377">                    <span class="s2">&quot;a Table may have only one explicit sentinel column&quot;</span>
</span><span data-line="2378">                <span class="p">)</span>
</span><span data-line="2379">            <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">_sentinel_column</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="2380">
</span><span data-line="2381">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="2382">            <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="2383">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="2384">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2385">                <span class="sa">f</span><span class="s2">&quot;Trying to redefine primary-key column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; as a &quot;</span>
</span><span data-line="2386">                <span class="sa">f</span><span class="s2">&quot;non-primary-key column on table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span data-line="2387">            <span class="p">)</span>
</span><span data-line="2388">
</span><span data-line="2389">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span data-line="2390">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="2391">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2392">                    <span class="s2">&quot;The &#39;index&#39; keyword argument on Column is boolean only. &quot;</span>
</span><span data-line="2393">                    <span class="s2">&quot;To create indexes with a specific name, create an &quot;</span>
</span><span data-line="2394">                    <span class="s2">&quot;explicit Index object external to the Table.&quot;</span>
</span><span data-line="2395">                <span class="p">)</span>
</span><span data-line="2396">            <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span data-line="2397">                <span class="n">Index</span><span class="p">(</span>
</span><span data-line="2398">                    <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">),</span> <span class="n">_column_flag</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="2399">                <span class="p">)</span>
</span><span data-line="2400">            <span class="p">)</span>
</span><span data-line="2401">
</span><span data-line="2402">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">:</span>
</span><span data-line="2403">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="2404">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2405">                    <span class="s2">&quot;The &#39;unique&#39; keyword argument on Column is boolean &quot;</span>
</span><span data-line="2406">                    <span class="s2">&quot;only. To create unique constraints or indexes with a &quot;</span>
</span><span data-line="2407">                    <span class="s2">&quot;specific name, append an explicit UniqueConstraint to &quot;</span>
</span><span data-line="2408">                    <span class="s2">&quot;the Table&#39;s list of elements, or create an explicit &quot;</span>
</span><span data-line="2409">                    <span class="s2">&quot;Index object external to the Table.&quot;</span>
</span><span data-line="2410">                <span class="p">)</span>
</span><span data-line="2411">            <span class="n">table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
</span><span data-line="2412">                <span class="n">UniqueConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">_column_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="2413">            <span class="p">)</span>
</span><span data-line="2414">
</span><span data-line="2415">        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_on_memoized_fks</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fk</span><span class="p">:</span> <span class="n">fk</span><span class="o">.</span><span class="n">_set_remote_table</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</span><span data-line="2416">
</span><span data-line="2417">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">identity</span> <span class="ow">and</span> <span class="p">(</span>
</span><span data-line="2418">            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span data-line="2419">            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span>
</span><span data-line="2420">        <span class="p">):</span>
</span><span data-line="2421">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2422">                <span class="s2">&quot;An column cannot specify both Identity and Sequence.&quot;</span>
</span><span data-line="2423">            <span class="p">)</span>
</span><span data-line="2424">
</span><span data-line="2425">    <span class="k">def</span> <span class="nf">_setup_on_memoized_fks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2426">        <span class="n">fk_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="2427">            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="kc">False</span><span class="p">),</span>
</span><span data-line="2428">            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="kc">True</span><span class="p">),</span>
</span><span data-line="2429">        <span class="p">]</span>
</span><span data-line="2430">        <span class="k">for</span> <span class="n">fk_key</span><span class="p">,</span> <span class="n">link_to_name</span> <span class="ow">in</span> <span class="n">fk_keys</span><span class="p">:</span>
</span><span data-line="2431">            <span class="k">if</span> <span class="n">fk_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">:</span>
</span><span data-line="2432">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]:</span>
</span><span data-line="2433">                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">link_to_name</span> <span class="ow">is</span> <span class="n">link_to_name</span><span class="p">:</span>
</span><span data-line="2434">                        <span class="n">fn</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span data-line="2435">
</span><span data-line="2436">    <span class="k">def</span> <span class="nf">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2437">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2438">            <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="2439">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2440">            <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;after_parent_attach&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span><span data-line="2441">
</span><span data-line="2442">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="2443">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="2444">        <span class="s2">&quot;The :meth:`_schema.Column.copy` method is deprecated &quot;</span>
</span><span data-line="2445">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="2446">    <span class="p">)</span>
</span><span data-line="2447">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="2448">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="2449">
</span><span data-line="2450">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="2451"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a copy of this ``Column``, uninitialized.</span>
</span><span data-line="2452">
</span><span data-line="2453"><span class="sd">        This is used in :meth:`_schema.Table.to_metadata` and by the ORM.</span>
</span><span data-line="2454">
</span><span data-line="2455"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2456">
</span><span data-line="2457">        <span class="c1"># Constraint objects plus non-constraint-bound ForeignKey objects</span>
</span><span data-line="2458">        <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SchemaItem</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="2459">            <span class="n">c</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">_type_bound</span>
</span><span data-line="2460">        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">constraint</span><span class="p">]</span>
</span><span data-line="2461">
</span><span data-line="2462">        <span class="c1"># ticket #5276</span>
</span><span data-line="2463">        <span class="n">column_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="2464">        <span class="k">for</span> <span class="n">dialect_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">:</span>
</span><span data-line="2465">            <span class="n">dialect_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">[</span><span class="n">dialect_name</span><span class="p">]</span><span class="o">.</span><span class="n">_non_defaults</span>
</span><span data-line="2466">            <span class="k">for</span> <span class="p">(</span>
</span><span data-line="2467">                <span class="n">dialect_option_key</span><span class="p">,</span>
</span><span data-line="2468">                <span class="n">dialect_option_value</span><span class="p">,</span>
</span><span data-line="2469">            <span class="p">)</span> <span class="ow">in</span> <span class="n">dialect_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="2470">                <span class="n">column_kwargs</span><span class="p">[</span><span class="n">dialect_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dialect_option_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="2471">                    <span class="n">dialect_option_value</span>
</span><span data-line="2472">                <span class="p">)</span>
</span><span data-line="2473">
</span><span data-line="2474">        <span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span>
</span><span data-line="2475">        <span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span>
</span><span data-line="2476">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="n">Computed</span><span class="p">,</span> <span class="n">Identity</span><span class="p">)):</span>
</span><span data-line="2477">            <span class="c1"># TODO: likely should be copied in all cases</span>
</span><span data-line="2478">            <span class="c1"># TODO: if a Sequence, we would need to transfer the Sequence</span>
</span><span data-line="2479">            <span class="c1"># .metadata as well</span>
</span><span data-line="2480">            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">server_default</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
</span><span data-line="2481">            <span class="n">server_default</span> <span class="o">=</span> <span class="n">server_onupdate</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2482">
</span><span data-line="2483">        <span class="n">type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span><span data-line="2484">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2485">            <span class="n">type_</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="2486">
</span><span data-line="2487">        <span class="c1"># TODO: DefaultGenerator is not copied here!  it&#39;s just used again</span>
</span><span data-line="2488">        <span class="c1"># with _set_parent() pointing to the old column.  see the new</span>
</span><span data-line="2489">        <span class="c1"># use of _copy() in the new _merge() method</span>
</span><span data-line="2490">
</span><span data-line="2491">        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor</span><span class="p">(</span>
</span><span data-line="2492">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="2493">            <span class="n">type_</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span>
</span><span data-line="2494">            <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span data-line="2495">            <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
</span><span data-line="2496">            <span class="n">unique</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span><span class="p">,</span>
</span><span data-line="2497">            <span class="n">system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
</span><span data-line="2498">            <span class="c1"># quote=self.quote,  # disabled 2013-08-27 (commit 031ef080)</span>
</span><span data-line="2499">            <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span data-line="2500">            <span class="n">autoincrement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span><span class="p">,</span>
</span><span data-line="2501">            <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
</span><span data-line="2502">            <span class="n">server_default</span><span class="o">=</span><span class="n">server_default</span><span class="p">,</span>
</span><span data-line="2503">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span data-line="2504">            <span class="n">server_onupdate</span><span class="o">=</span><span class="n">server_onupdate</span><span class="p">,</span>
</span><span data-line="2505">            <span class="n">doc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span>
</span><span data-line="2506">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="2507">            <span class="n">_omit_from_statements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_omit_from_statements</span><span class="p">,</span>
</span><span data-line="2508">            <span class="n">insert_sentinel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">,</span>
</span><span data-line="2509">            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span data-line="2510">            <span class="o">**</span><span class="n">column_kwargs</span><span class="p">,</span>
</span><span data-line="2511">        <span class="p">)</span>
</span><span data-line="2512">
</span><span data-line="2513">        <span class="c1"># copy the state of &quot;nullable&quot; exactly, to accommodate for</span>
</span><span data-line="2514">        <span class="c1"># ORM flipping the .nullable flag directly</span>
</span><span data-line="2515">        <span class="n">c</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span>
</span><span data-line="2516">        <span class="n">c</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span>
</span><span data-line="2517">
</span><span data-line="2518">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span data-line="2519">
</span><span data-line="2520">    <span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2521"><span class="w">        </span><span class="sd">&quot;&quot;&quot;merge the elements of another column into this one.</span>
</span><span data-line="2522">
</span><span data-line="2523"><span class="sd">        this is used by ORM pep-593 merge and will likely need a lot</span>
</span><span data-line="2524"><span class="sd">        of fixes.</span>
</span><span data-line="2525">
</span><span data-line="2526">
</span><span data-line="2527"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2528">
</span><span data-line="2529">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="2530">            <span class="n">other</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="2531">
</span><span data-line="2532">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">!=</span> <span class="s2">&quot;auto&quot;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span data-line="2533">            <span class="n">other</span><span class="o">.</span><span class="n">autoincrement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoincrement</span>
</span><span data-line="2534">
</span><span data-line="2535">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">:</span>
</span><span data-line="2536">            <span class="n">other</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
</span><span data-line="2537">
</span><span data-line="2538">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
</span><span data-line="2539">            <span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</span><span data-line="2540">
</span><span data-line="2541">        <span class="n">type_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
</span><span data-line="2542">        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_</span><span class="o">.</span><span class="n">_isnull</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span data-line="2543">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2544">                <span class="n">type_</span> <span class="o">=</span> <span class="n">type_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="2545">
</span><span data-line="2546">            <span class="n">other</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">type_</span>
</span><span data-line="2547">
</span><span data-line="2548">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2549">                <span class="n">type_</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2550">
</span><span data-line="2551">            <span class="k">for</span> <span class="n">impl</span> <span class="ow">in</span> <span class="n">type_</span><span class="o">.</span><span class="n">_variant_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span data-line="2552">                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">impl</span><span class="p">,</span> <span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="2553">                    <span class="n">impl</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2554">
</span><span data-line="2555">        <span class="k">if</span> <span class="p">(</span>
</span><span data-line="2556">            <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NULL_UNSPECIFIED</span>
</span><span data-line="2557">            <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span>
</span><span data-line="2558">        <span class="p">):</span>
</span><span data-line="2559">            <span class="n">other</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nullable</span>
</span><span data-line="2560">            <span class="n">other</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_defined_nullable</span>
</span><span data-line="2561">
</span><span data-line="2562">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2563">            <span class="n">new_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2564">            <span class="n">new_default</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2565">
</span><span data-line="2566">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2567">            <span class="n">new_server_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_default</span>
</span><span data-line="2568">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_server_default</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span data-line="2569">                <span class="n">new_server_default</span> <span class="o">=</span> <span class="n">new_server_default</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2570">                <span class="n">new_server_default</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2571">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2572">                <span class="n">other</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="n">new_server_default</span>
</span><span data-line="2573">
</span><span data-line="2574">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2575">            <span class="n">new_server_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_onupdate</span>
</span><span data-line="2576">            <span class="n">new_server_onupdate</span> <span class="o">=</span> <span class="n">new_server_onupdate</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2577">            <span class="n">new_server_onupdate</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2578">
</span><span data-line="2579">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">onupdate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2580">            <span class="n">new_onupdate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2581">            <span class="n">new_onupdate</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2582">
</span><span data-line="2583">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2584">            <span class="n">other</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
</span><span data-line="2585">
</span><span data-line="2586">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">unique</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2587">            <span class="n">other</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique</span>
</span><span data-line="2588">
</span><span data-line="2589">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">doc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2590">            <span class="n">other</span><span class="o">.</span><span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doc</span>
</span><span data-line="2591">
</span><span data-line="2592">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2593">            <span class="n">other</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
</span><span data-line="2594">
</span><span data-line="2595">        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
</span><span data-line="2596">            <span class="k">if</span> <span class="ow">not</span> <span class="n">const</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">:</span>
</span><span data-line="2597">                <span class="n">new_const</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2598">                <span class="n">new_const</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2599">
</span><span data-line="2600">        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span data-line="2601">            <span class="k">if</span> <span class="ow">not</span> <span class="n">fk</span><span class="o">.</span><span class="n">constraint</span><span class="p">:</span>
</span><span data-line="2602">                <span class="n">new_fk</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">_copy</span><span class="p">()</span>
</span><span data-line="2603">                <span class="n">new_fk</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span data-line="2604">
</span><span data-line="2605">    <span class="k">def</span> <span class="nf">_make_proxy</span><span class="p">(</span>
</span><span data-line="2606">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="2607">        <span class="n">selectable</span><span class="p">:</span> <span class="n">FromClause</span><span class="p">,</span>
</span><span data-line="2608">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2609">        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2610">        <span class="n">name_is_truncatable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="2611">        <span class="n">compound_select_cols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="2612">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="2613">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2614">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="2615">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnClause</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
</span><span data-line="2616"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a *proxy* for this column.</span>
</span><span data-line="2617">
</span><span data-line="2618"><span class="sd">        This is a copy of this ``Column`` referenced by a different parent</span>
</span><span data-line="2619"><span class="sd">        (such as an alias or select statement).  The column should</span>
</span><span data-line="2620"><span class="sd">        be used only in select scenarios, as its full DDL/default</span>
</span><span data-line="2621"><span class="sd">        information is not transferred.</span>
</span><span data-line="2622">
</span><span data-line="2623"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2624">
</span><span data-line="2625">        <span class="n">fk</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="2626">            <span class="n">ForeignKey</span><span class="p">(</span>
</span><span data-line="2627">                <span class="n">col</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span>
</span><span data-line="2628">                <span class="n">_unresolvable</span><span class="o">=</span><span class="n">col</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2629">                <span class="n">_constraint</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">constraint</span><span class="p">,</span>
</span><span data-line="2630">            <span class="p">)</span>
</span><span data-line="2631">            <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span>
</span><span data-line="2632">                <span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">_resolve_column</span><span class="p">(</span><span class="n">raiseerr</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span data-line="2633">                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span>
</span><span data-line="2634">            <span class="p">]</span>
</span><span data-line="2635">        <span class="p">]</span>
</span><span data-line="2636">
</span><span data-line="2637">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2638">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="2639">                <span class="s2">&quot;Cannot initialize a sub-selectable&quot;</span>
</span><span data-line="2640">                <span class="s2">&quot; with this Column object until its &#39;name&#39; has &quot;</span>
</span><span data-line="2641">                <span class="s2">&quot;been assigned.&quot;</span>
</span><span data-line="2642">            <span class="p">)</span>
</span><span data-line="2643">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="2644">            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constructor</span><span class="p">(</span>
</span><span data-line="2645">                <span class="p">(</span>
</span><span data-line="2646">                    <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span>
</span><span data-line="2647">                        <span class="n">roles</span><span class="o">.</span><span class="n">TruncatedLabelRole</span><span class="p">,</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="2648">                    <span class="p">)</span>
</span><span data-line="2649">                    <span class="k">if</span> <span class="n">name_is_truncatable</span>
</span><span data-line="2650">                    <span class="k">else</span> <span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="2651">                <span class="p">),</span>
</span><span data-line="2652">                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
</span><span data-line="2653">                <span class="c1"># this may actually be ._proxy_key when the key is incoming</span>
</span><span data-line="2654">                <span class="n">key</span><span class="o">=</span><span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="k">else</span> <span class="n">name</span> <span class="k">if</span> <span class="n">name</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span data-line="2655">                <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
</span><span data-line="2656">                <span class="n">nullable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nullable</span><span class="p">,</span>
</span><span data-line="2657">                <span class="n">_proxies</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="2658">                    <span class="nb">list</span><span class="p">(</span><span class="n">compound_select_cols</span><span class="p">)</span>
</span><span data-line="2659">                    <span class="k">if</span> <span class="n">compound_select_cols</span>
</span><span data-line="2660">                    <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
</span><span data-line="2661">                <span class="p">),</span>
</span><span data-line="2662">                <span class="o">*</span><span class="n">fk</span><span class="p">,</span>
</span><span data-line="2663">            <span class="p">)</span>
</span><span data-line="2664">        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span><span data-line="2665">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span data-line="2666">                <span class="s2">&quot;Could not create a copy of this </span><span class="si">%r</span><span class="s2"> object.  &quot;</span>
</span><span data-line="2667">                <span class="s2">&quot;Ensure the class includes a _constructor() &quot;</span>
</span><span data-line="2668">                <span class="s2">&quot;attribute or method which accepts the &quot;</span>
</span><span data-line="2669">                <span class="s2">&quot;standard Column constructor arguments, or &quot;</span>
</span><span data-line="2670">                <span class="s2">&quot;references the Column class itself.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
</span><span data-line="2671">            <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
</span><span data-line="2672">
</span><span data-line="2673">        <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">selectable</span>
</span><span data-line="2674">        <span class="n">c</span><span class="o">.</span><span class="n">_propagate_attrs</span> <span class="o">=</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_propagate_attrs</span>
</span><span data-line="2675">        <span class="k">if</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_is_clone_of</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2676">            <span class="n">c</span><span class="o">.</span><span class="n">_is_clone_of</span> <span class="o">=</span> <span class="n">selectable</span><span class="o">.</span><span class="n">_is_clone_of</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="2677">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">:</span>
</span><span data-line="2678">            <span class="n">selectable</span><span class="o">.</span><span class="n">primary_key</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2679">        <span class="k">if</span> <span class="n">fk</span><span class="p">:</span>
</span><span data-line="2680">            <span class="n">selectable</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2681">        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">c</span>
</span><span data-line="2682">
</span><span data-line="2683">
</span><span data-line="2684"><span class="k">def</span> <span class="nf">insert_sentinel</span><span class="p">(</span>
</span><span data-line="2685">    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2686">    <span class="n">type_</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2687">    <span class="o">*</span><span class="p">,</span>
</span><span data-line="2688">    <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2689">    <span class="n">omit_from_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="2690"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="2691"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Provides a surrogate :class:`_schema.Column` that will act as a</span>
</span><span data-line="2692"><span class="sd">    dedicated insert :term:`sentinel` column, allowing efficient bulk</span>
</span><span data-line="2693"><span class="sd">    inserts with deterministic RETURNING sorting for tables that</span>
</span><span data-line="2694"><span class="sd">    don&#39;t otherwise have qualifying primary key configurations.</span>
</span><span data-line="2695">
</span><span data-line="2696"><span class="sd">    Adding this column to a :class:`.Table` object requires that a</span>
</span><span data-line="2697"><span class="sd">    corresponding database table actually has this column present, so if adding</span>
</span><span data-line="2698"><span class="sd">    it to an existing model, existing database tables would need to be migrated</span>
</span><span data-line="2699"><span class="sd">    (e.g. using ALTER TABLE or similar) to include this column.</span>
</span><span data-line="2700">
</span><span data-line="2701"><span class="sd">    For background on how this object is used, see the section</span>
</span><span data-line="2702"><span class="sd">    :ref:`engine_insertmanyvalues_sentinel_columns` as part of the</span>
</span><span data-line="2703"><span class="sd">    section :ref:`engine_insertmanyvalues`.</span>
</span><span data-line="2704">
</span><span data-line="2705"><span class="sd">    The :class:`_schema.Column` returned will be a nullable integer column by</span>
</span><span data-line="2706"><span class="sd">    default and make use of a sentinel-specific default generator used only in</span>
</span><span data-line="2707"><span class="sd">    &quot;insertmanyvalues&quot; operations.</span>
</span><span data-line="2708">
</span><span data-line="2709"><span class="sd">    .. seealso::</span>
</span><span data-line="2710">
</span><span data-line="2711"><span class="sd">        :func:`_orm.orm_insert_sentinel`</span>
</span><span data-line="2712">
</span><span data-line="2713"><span class="sd">        :paramref:`_schema.Column.insert_sentinel`</span>
</span><span data-line="2714">
</span><span data-line="2715"><span class="sd">        :ref:`engine_insertmanyvalues`</span>
</span><span data-line="2716">
</span><span data-line="2717"><span class="sd">        :ref:`engine_insertmanyvalues_sentinel_columns`</span>
</span><span data-line="2718">
</span><span data-line="2719">
</span><span data-line="2720"><span class="sd">    .. versionadded:: 2.0.10</span>
</span><span data-line="2721">
</span><span data-line="2722"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="2723">    <span class="k">return</span> <span class="n">Column</span><span class="p">(</span>
</span><span data-line="2724">        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="2725">        <span class="n">type_</span><span class="o">=</span><span class="n">type_api</span><span class="o">.</span><span class="n">INTEGERTYPE</span> <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">type_</span><span class="p">,</span>
</span><span data-line="2726">        <span class="n">default</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="2727">            <span class="n">default</span> <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">()</span>
</span><span data-line="2728">        <span class="p">),</span>
</span><span data-line="2729">        <span class="n">_omit_from_statements</span><span class="o">=</span><span class="n">omit_from_statements</span><span class="p">,</span>
</span><span data-line="2730">        <span class="n">insert_sentinel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="2731">    <span class="p">)</span>
</span><span data-line="2732">
</span><span data-line="2733">
</span><span data-line="2734"><span class="k">class</span> <span class="nc">ForeignKey</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="2735"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines a dependency between two columns.</span>
</span><span data-line="2736">
</span><span data-line="2737"><span class="sd">    ``ForeignKey`` is specified as an argument to a :class:`_schema.Column`</span>
</span><span data-line="2738"><span class="sd">    object,</span>
</span><span data-line="2739"><span class="sd">    e.g.::</span>
</span><span data-line="2740">
</span><span data-line="2741"><span class="sd">        t = Table(&quot;remote_table&quot;, metadata,</span>
</span><span data-line="2742"><span class="sd">            Column(&quot;remote_id&quot;, ForeignKey(&quot;main_table.id&quot;))</span>
</span><span data-line="2743"><span class="sd">        )</span>
</span><span data-line="2744">
</span><span data-line="2745"><span class="sd">    Note that ``ForeignKey`` is only a marker object that defines</span>
</span><span data-line="2746"><span class="sd">    a dependency between two columns.   The actual constraint</span>
</span><span data-line="2747"><span class="sd">    is in all cases represented by the :class:`_schema.ForeignKeyConstraint`</span>
</span><span data-line="2748"><span class="sd">    object.   This object will be generated automatically when</span>
</span><span data-line="2749"><span class="sd">    a ``ForeignKey`` is associated with a :class:`_schema.Column` which</span>
</span><span data-line="2750"><span class="sd">    in turn is associated with a :class:`_schema.Table`.   Conversely,</span>
</span><span data-line="2751"><span class="sd">    when :class:`_schema.ForeignKeyConstraint` is applied to a</span>
</span><span data-line="2752"><span class="sd">    :class:`_schema.Table`,</span>
</span><span data-line="2753"><span class="sd">    ``ForeignKey`` markers are automatically generated to be</span>
</span><span data-line="2754"><span class="sd">    present on each associated :class:`_schema.Column`, which are also</span>
</span><span data-line="2755"><span class="sd">    associated with the constraint object.</span>
</span><span data-line="2756">
</span><span data-line="2757"><span class="sd">    Note that you cannot define a &quot;composite&quot; foreign key constraint,</span>
</span><span data-line="2758"><span class="sd">    that is a constraint between a grouping of multiple parent/child</span>
</span><span data-line="2759"><span class="sd">    columns, using ``ForeignKey`` objects.   To define this grouping,</span>
</span><span data-line="2760"><span class="sd">    the :class:`_schema.ForeignKeyConstraint` object must be used, and applied</span>
</span><span data-line="2761"><span class="sd">    to the :class:`_schema.Table`.   The associated ``ForeignKey`` objects</span>
</span><span data-line="2762"><span class="sd">    are created automatically.</span>
</span><span data-line="2763">
</span><span data-line="2764"><span class="sd">    The ``ForeignKey`` objects associated with an individual</span>
</span><span data-line="2765"><span class="sd">    :class:`_schema.Column`</span>
</span><span data-line="2766"><span class="sd">    object are available in the `foreign_keys` collection</span>
</span><span data-line="2767"><span class="sd">    of that column.</span>
</span><span data-line="2768">
</span><span data-line="2769"><span class="sd">    Further examples of foreign key configuration are in</span>
</span><span data-line="2770"><span class="sd">    :ref:`metadata_foreignkeys`.</span>
</span><span data-line="2771">
</span><span data-line="2772"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="2773">
</span><span data-line="2774">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;foreign_key&quot;</span>
</span><span data-line="2775">
</span><span data-line="2776">    <span class="n">parent</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span data-line="2777">
</span><span data-line="2778">    <span class="n">_table_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="2779">
</span><span data-line="2780">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="2781">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="2782">        <span class="n">column</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span data-line="2783">        <span class="n">_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ForeignKeyConstraint</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2784">        <span class="n">use_alter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="2785">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2786">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2787">        <span class="n">ondelete</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2788">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2789">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2790">        <span class="n">link_to_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="2791">        <span class="n">match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2792">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2793">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2794">        <span class="n">_unresolvable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="2795">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="2796">    <span class="p">):</span>
</span><span data-line="2797"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="2798"><span class="sd">        Construct a column-level FOREIGN KEY.</span>
</span><span data-line="2799">
</span><span data-line="2800"><span class="sd">        The :class:`_schema.ForeignKey` object when constructed generates a</span>
</span><span data-line="2801"><span class="sd">        :class:`_schema.ForeignKeyConstraint`</span>
</span><span data-line="2802"><span class="sd">        which is associated with the parent</span>
</span><span data-line="2803"><span class="sd">        :class:`_schema.Table` object&#39;s collection of constraints.</span>
</span><span data-line="2804">
</span><span data-line="2805"><span class="sd">        :param column: A single target column for the key relationship. A</span>
</span><span data-line="2806"><span class="sd">            :class:`_schema.Column` object or a column name as a string:</span>
</span><span data-line="2807"><span class="sd">            ``tablename.columnkey`` or ``schema.tablename.columnkey``.</span>
</span><span data-line="2808"><span class="sd">            ``columnkey`` is the ``key`` which has been assigned to the column</span>
</span><span data-line="2809"><span class="sd">            (defaults to the column name itself), unless ``link_to_name`` is</span>
</span><span data-line="2810"><span class="sd">            ``True`` in which case the rendered name of the column is used.</span>
</span><span data-line="2811">
</span><span data-line="2812"><span class="sd">        :param name: Optional string. An in-database name for the key if</span>
</span><span data-line="2813"><span class="sd">            `constraint` is not provided.</span>
</span><span data-line="2814">
</span><span data-line="2815"><span class="sd">        :param onupdate: Optional string. If set, emit ON UPDATE &lt;value&gt; when</span>
</span><span data-line="2816"><span class="sd">            issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span data-line="2817"><span class="sd">            DELETE and RESTRICT.</span>
</span><span data-line="2818">
</span><span data-line="2819"><span class="sd">        :param ondelete: Optional string. If set, emit ON DELETE &lt;value&gt; when</span>
</span><span data-line="2820"><span class="sd">            issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span data-line="2821"><span class="sd">            DELETE and RESTRICT.</span>
</span><span data-line="2822">
</span><span data-line="2823"><span class="sd">        :param deferrable: Optional bool. If set, emit DEFERRABLE or NOT</span>
</span><span data-line="2824"><span class="sd">            DEFERRABLE when issuing DDL for this constraint.</span>
</span><span data-line="2825">
</span><span data-line="2826"><span class="sd">        :param initially: Optional string. If set, emit INITIALLY &lt;value&gt; when</span>
</span><span data-line="2827"><span class="sd">            issuing DDL for this constraint.</span>
</span><span data-line="2828">
</span><span data-line="2829"><span class="sd">        :param link_to_name: if True, the string name given in ``column`` is</span>
</span><span data-line="2830"><span class="sd">            the rendered name of the referenced column, not its locally</span>
</span><span data-line="2831"><span class="sd">            assigned ``key``.</span>
</span><span data-line="2832">
</span><span data-line="2833"><span class="sd">        :param use_alter: passed to the underlying</span>
</span><span data-line="2834"><span class="sd">            :class:`_schema.ForeignKeyConstraint`</span>
</span><span data-line="2835"><span class="sd">            to indicate the constraint should</span>
</span><span data-line="2836"><span class="sd">            be generated/dropped externally from the CREATE TABLE/ DROP TABLE</span>
</span><span data-line="2837"><span class="sd">            statement.  See :paramref:`_schema.ForeignKeyConstraint.use_alter`</span>
</span><span data-line="2838"><span class="sd">            for further description.</span>
</span><span data-line="2839">
</span><span data-line="2840"><span class="sd">            .. seealso::</span>
</span><span data-line="2841">
</span><span data-line="2842"><span class="sd">                :paramref:`_schema.ForeignKeyConstraint.use_alter`</span>
</span><span data-line="2843">
</span><span data-line="2844"><span class="sd">                :ref:`use_alter`</span>
</span><span data-line="2845">
</span><span data-line="2846"><span class="sd">        :param match: Optional string. If set, emit MATCH &lt;value&gt; when issuing</span>
</span><span data-line="2847"><span class="sd">            DDL for this constraint. Typical values include SIMPLE, PARTIAL</span>
</span><span data-line="2848"><span class="sd">            and FULL.</span>
</span><span data-line="2849">
</span><span data-line="2850"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="2851"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="2852">
</span><span data-line="2853"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span data-line="2854"><span class="sd">          foreign key constraint creation.</span>
</span><span data-line="2855">
</span><span data-line="2856"><span class="sd">            .. versionadded:: 2.0</span>
</span><span data-line="2857">
</span><span data-line="2858"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span data-line="2859"><span class="sd">            specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  The</span>
</span><span data-line="2860"><span class="sd">            arguments are ultimately handled by a corresponding</span>
</span><span data-line="2861"><span class="sd">            :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="2862"><span class="sd">            See the documentation regarding</span>
</span><span data-line="2863"><span class="sd">            an individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span data-line="2864"><span class="sd">            documented arguments.</span>
</span><span data-line="2865">
</span><span data-line="2866"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2867">
</span><span data-line="2868">        <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLReferredColumnRole</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span><span data-line="2869">        <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span> <span class="o">=</span> <span class="n">_unresolvable</span>
</span><span data-line="2870">
</span><span data-line="2871">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="2872">            <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2873">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2874">            <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span data-line="2875">
</span><span data-line="2876">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span data-line="2877">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">TableClause</span><span class="p">)</span>
</span><span data-line="2878">            <span class="p">):</span>
</span><span data-line="2879">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="2880">                    <span class="s2">&quot;ForeignKey received Column not bound &quot;</span>
</span><span data-line="2881">                    <span class="s2">&quot;to a Table, got: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span>
</span><span data-line="2882">                <span class="p">)</span>
</span><span data-line="2883">
</span><span data-line="2884">        <span class="c1"># the linked ForeignKeyConstraint.</span>
</span><span data-line="2885">        <span class="c1"># ForeignKey will create this when parent Column</span>
</span><span data-line="2886">        <span class="c1"># is attached to a Table, *or* ForeignKeyConstraint</span>
</span><span data-line="2887">        <span class="c1"># object passes itself in when creating ForeignKey</span>
</span><span data-line="2888">        <span class="c1"># markers.</span>
</span><span data-line="2889">        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="o">=</span> <span class="n">_constraint</span>
</span><span data-line="2890">
</span><span data-line="2891">        <span class="c1"># .parent is not Optional under normal use</span>
</span><span data-line="2892">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
</span><span data-line="2893">
</span><span data-line="2894">        <span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span> <span class="o">=</span> <span class="n">use_alter</span>
</span><span data-line="2895">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="2896">        <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span data-line="2897">        <span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span> <span class="o">=</span> <span class="n">ondelete</span>
</span><span data-line="2898">        <span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span> <span class="o">=</span> <span class="n">deferrable</span>
</span><span data-line="2899">        <span class="bp">self</span><span class="o">.</span><span class="n">initially</span> <span class="o">=</span> <span class="n">initially</span>
</span><span data-line="2900">        <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span> <span class="o">=</span> <span class="n">link_to_name</span>
</span><span data-line="2901">        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">match</span>
</span><span data-line="2902">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span data-line="2903">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span data-line="2904">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="2905">        <span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span> <span class="o">=</span> <span class="n">dialect_kw</span>
</span><span data-line="2906">
</span><span data-line="2907">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="2908">        <span class="k">return</span> <span class="s2">&quot;ForeignKey(</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">()</span>
</span><span data-line="2909">
</span><span data-line="2910">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="2911">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="2912">        <span class="s2">&quot;The :meth:`_schema.ForeignKey.copy` method is deprecated &quot;</span>
</span><span data-line="2913">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="2914">    <span class="p">)</span>
</span><span data-line="2915">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKey</span><span class="p">:</span>
</span><span data-line="2916">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="2917">
</span><span data-line="2918">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKey</span><span class="p">:</span>
</span><span data-line="2919"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Produce a copy of this :class:`_schema.ForeignKey` object.</span>
</span><span data-line="2920">
</span><span data-line="2921"><span class="sd">        The new :class:`_schema.ForeignKey` will not be bound</span>
</span><span data-line="2922"><span class="sd">        to any :class:`_schema.Column`.</span>
</span><span data-line="2923">
</span><span data-line="2924"><span class="sd">        This method is usually used by the internal</span>
</span><span data-line="2925"><span class="sd">        copy procedures of :class:`_schema.Column`, :class:`_schema.Table`,</span>
</span><span data-line="2926"><span class="sd">        and :class:`_schema.MetaData`.</span>
</span><span data-line="2927">
</span><span data-line="2928"><span class="sd">        :param schema: The returned :class:`_schema.ForeignKey` will</span>
</span><span data-line="2929"><span class="sd">          reference the original table and column name, qualified</span>
</span><span data-line="2930"><span class="sd">          by the given string schema name.</span>
</span><span data-line="2931">
</span><span data-line="2932"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2933">        <span class="n">fk</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span>
</span><span data-line="2934">            <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">),</span>
</span><span data-line="2935">            <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span data-line="2936">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="2937">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span data-line="2938">            <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span data-line="2939">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="2940">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="2941">            <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span data-line="2942">            <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span data-line="2943">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="2944">            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span><span class="p">,</span>
</span><span data-line="2945">        <span class="p">)</span>
</span><span data-line="2946">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span data-line="2947">
</span><span data-line="2948">    <span class="k">def</span> <span class="nf">_get_colspec</span><span class="p">(</span>
</span><span data-line="2949">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="2950">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="2951">            <span class="n">Union</span><span class="p">[</span>
</span><span data-line="2952">                <span class="nb">str</span><span class="p">,</span>
</span><span data-line="2953">                <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">RETAIN_SCHEMA</span><span class="p">,</span> <span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">],</span>
</span><span data-line="2954">            <span class="p">]</span>
</span><span data-line="2955">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2956">        <span class="n">table_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="2957">        <span class="n">_is_copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="2958">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="2959"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string based &#39;column specification&#39; for this</span>
</span><span data-line="2960"><span class="sd">        :class:`_schema.ForeignKey`.</span>
</span><span data-line="2961">
</span><span data-line="2962"><span class="sd">        This is usually the equivalent of the string-based &quot;tablename.colname&quot;</span>
</span><span data-line="2963"><span class="sd">        argument first passed to the object&#39;s constructor.</span>
</span><span data-line="2964">
</span><span data-line="2965"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="2966">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">RETAIN_SCHEMA</span><span class="p">):</span>
</span><span data-line="2967">            <span class="n">_schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span data-line="2968">            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2969">                <span class="n">tname</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span data-line="2970">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span data-line="2971">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="2972">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2973">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="2974">        <span class="k">elif</span> <span class="n">table_name</span><span class="p">:</span>
</span><span data-line="2975">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span data-line="2976">            <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
</span><span data-line="2977">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="2978">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="2979">                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="2980">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2981">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2982">                <span class="k">if</span> <span class="n">_is_copy</span><span class="p">:</span>
</span><span data-line="2983">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="2984">                        <span class="sa">f</span><span class="s2">&quot;Can&#39;t copy ForeignKey object which refers to &quot;</span>
</span><span data-line="2985">                        <span class="sa">f</span><span class="s2">&quot;non-table bound Column </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span data-line="2986">                    <span class="p">)</span>
</span><span data-line="2987">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="2988">                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="2989">            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="2990">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span>
</span><span data-line="2991">                <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
</span><span data-line="2992">            <span class="p">)</span>
</span><span data-line="2993">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2994">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span data-line="2995">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span data-line="2996">
</span><span data-line="2997">    <span class="nd">@property</span>
</span><span data-line="2998">    <span class="k">def</span> <span class="nf">_referred_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="2999">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="3000">
</span><span data-line="3001">    <span class="k">def</span> <span class="nf">_table_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="3002">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3003">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3004">                <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="3005">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="3006">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_column</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="3007">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3008">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span data-line="3009">            <span class="k">return</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="3010">
</span><span data-line="3011">    <span class="n">target_fullname</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_colspec</span><span class="p">)</span>
</span><span data-line="3012">
</span><span data-line="3013">    <span class="k">def</span> <span class="nf">references</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="3014"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the given :class:`_schema.Table`</span>
</span><span data-line="3015"><span class="sd">        is referenced by this</span>
</span><span data-line="3016"><span class="sd">        :class:`_schema.ForeignKey`.&quot;&quot;&quot;</span>
</span><span data-line="3017">
</span><span data-line="3018">        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">corresponding_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="3019">
</span><span data-line="3020">    <span class="k">def</span> <span class="nf">get_referent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">FromClause</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="3021"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the :class:`_schema.Column` in the given</span>
</span><span data-line="3022"><span class="sd">        :class:`_schema.Table` (or any :class:`.FromClause`)</span>
</span><span data-line="3023"><span class="sd">        referenced by this :class:`_schema.ForeignKey`.</span>
</span><span data-line="3024">
</span><span data-line="3025"><span class="sd">        Returns None if this :class:`_schema.ForeignKey`</span>
</span><span data-line="3026"><span class="sd">        does not reference the given</span>
</span><span data-line="3027"><span class="sd">        :class:`_schema.Table`.</span>
</span><span data-line="3028">
</span><span data-line="3029"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3030">        <span class="c1"># our column is a Column, and any subquery etc. proxying us</span>
</span><span data-line="3031">        <span class="c1"># would be doing so via another Column, so that&#39;s what would</span>
</span><span data-line="3032">        <span class="c1"># be returned here</span>
</span><span data-line="3033">        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">corresponding_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="3034">
</span><span data-line="3035">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span data-line="3036">    <span class="k">def</span> <span class="nf">_column_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span data-line="3037"><span class="w">        </span><span class="sd">&quot;&quot;&quot;parse a string-based _colspec into its component parts.&quot;&quot;&quot;</span>
</span><span data-line="3038">
</span><span data-line="3039">        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span data-line="3040">        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3041">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="3042">                <span class="sa">f</span><span class="s2">&quot;Invalid foreign key column specification: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="3043">            <span class="p">)</span>
</span><span data-line="3044">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="3045">            <span class="n">tname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span data-line="3046">            <span class="n">colname</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3047">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3048">            <span class="n">colname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span data-line="3049">            <span class="n">tname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span data-line="3050">
</span><span data-line="3051">        <span class="c1"># A FK between column &#39;bar&#39; and table &#39;foo&#39; can be</span>
</span><span data-line="3052">        <span class="c1"># specified as &#39;foo&#39;, &#39;foo.bar&#39;, &#39;dbo.foo.bar&#39;,</span>
</span><span data-line="3053">        <span class="c1"># &#39;otherdb.dbo.foo.bar&#39;. Once we have the column name and</span>
</span><span data-line="3054">        <span class="c1"># the table name, treat everything else as the schema</span>
</span><span data-line="3055">        <span class="c1"># name. Some databases (e.g. Sybase) support</span>
</span><span data-line="3056">        <span class="c1"># inter-database foreign keys. See tickets#1341 and --</span>
</span><span data-line="3057">        <span class="c1"># indirectly related -- Ticket #594. This assumes that &#39;.&#39;</span>
</span><span data-line="3058">        <span class="c1"># will never appear *within* any component of the FK.</span>
</span><span data-line="3059">
</span><span data-line="3060">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="3061">            <span class="n">schema</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span data-line="3062">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3063">            <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3064">        <span class="k">return</span> <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span>
</span><span data-line="3065">
</span><span data-line="3066">    <span class="k">def</span> <span class="nf">_resolve_col_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span data-line="3067">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3068">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="3069">                <span class="s2">&quot;this ForeignKey object does not yet have a &quot;</span>
</span><span data-line="3070">                <span class="s2">&quot;parent Column associated with it.&quot;</span>
</span><span data-line="3071">            <span class="p">)</span>
</span><span data-line="3072">
</span><span data-line="3073">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3074">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="3075">                <span class="s2">&quot;this ForeignKey&#39;s parent column is not yet associated &quot;</span>
</span><span data-line="3076">                <span class="s2">&quot;with a Table.&quot;</span>
</span><span data-line="3077">            <span class="p">)</span>
</span><span data-line="3078">
</span><span data-line="3079">        <span class="n">parenttable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span>
</span><span data-line="3080">
</span><span data-line="3081">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span><span class="p">:</span>
</span><span data-line="3082">            <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span data-line="3083">            <span class="n">tablekey</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="3084">            <span class="k">return</span> <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span>
</span><span data-line="3085">
</span><span data-line="3086">        <span class="c1"># assertion</span>
</span><span data-line="3087">        <span class="c1"># basically Column._make_proxy() sends the actual</span>
</span><span data-line="3088">        <span class="c1"># target Column to the ForeignKey object, so the</span>
</span><span data-line="3089">        <span class="c1"># string resolution here is never called.</span>
</span><span data-line="3090">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">base_columns</span><span class="p">:</span>
</span><span data-line="3091">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span data-line="3092">                <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="n">parenttable</span>
</span><span data-line="3093">                <span class="k">break</span>
</span><span data-line="3094">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3095">            <span class="k">assert</span> <span class="kc">False</span>
</span><span data-line="3096">        <span class="c1">######################</span>
</span><span data-line="3097">
</span><span data-line="3098">        <span class="n">schema</span><span class="p">,</span> <span class="n">tname</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_column_tokens</span>
</span><span data-line="3099">
</span><span data-line="3100">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3101">            <span class="n">schema</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="3102">
</span><span data-line="3103">        <span class="n">tablekey</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="3104">        <span class="k">return</span> <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span>
</span><span data-line="3105">
</span><span data-line="3106">    <span class="k">def</span> <span class="nf">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span data-line="3107">        <span class="bp">self</span><span class="p">,</span> <span class="n">parenttable</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">colname</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span data-line="3108">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="3109">        <span class="n">_column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3110">        <span class="k">if</span> <span class="n">colname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3111">            <span class="c1"># colname is None in the case that ForeignKey argument</span>
</span><span data-line="3112">            <span class="c1"># was specified as table name only, in which case we</span>
</span><span data-line="3113">            <span class="c1"># match the column name to the same column on the</span>
</span><span data-line="3114">            <span class="c1"># parent.</span>
</span><span data-line="3115">            <span class="c1"># this use case wasn&#39;t working in later 1.x series</span>
</span><span data-line="3116">            <span class="c1"># as it had no test coverage; fixed in 2.0</span>
</span><span data-line="3117">            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span data-line="3118">            <span class="k">assert</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="3119">            <span class="n">key</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="3120">            <span class="n">_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="3121">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">:</span>
</span><span data-line="3122">            <span class="n">key</span> <span class="o">=</span> <span class="n">colname</span>
</span><span data-line="3123">            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="p">:</span>
</span><span data-line="3124">                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">colname</span><span class="p">:</span>
</span><span data-line="3125">                    <span class="n">_column</span> <span class="o">=</span> <span class="n">c</span>
</span><span data-line="3126">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3127">            <span class="n">key</span> <span class="o">=</span> <span class="n">colname</span>
</span><span data-line="3128">            <span class="n">_column</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">colname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="3129">
</span><span data-line="3130">        <span class="k">if</span> <span class="n">_column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3131">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedColumnError</span><span class="p">(</span>
</span><span data-line="3132">                <span class="s2">&quot;Could not initialize target column &quot;</span>
</span><span data-line="3133">                <span class="sa">f</span><span class="s2">&quot;for ForeignKey &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span data-line="3134">                <span class="sa">f</span><span class="s2">&quot;on table &#39;</span><span class="si">{</span><span class="n">parenttable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: &quot;</span>
</span><span data-line="3135">                <span class="sa">f</span><span class="s2">&quot;table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no column named &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span data-line="3136">                <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="3137">                <span class="n">key</span><span class="p">,</span>
</span><span data-line="3138">            <span class="p">)</span>
</span><span data-line="3139">
</span><span data-line="3140">        <span class="k">return</span> <span class="n">_column</span>
</span><span data-line="3141">
</span><span data-line="3142">    <span class="k">def</span> <span class="nf">_set_target_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3143">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="3144">
</span><span data-line="3145">        <span class="c1"># propagate TypeEngine to parent if it didn&#39;t have one</span>
</span><span data-line="3146">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span data-line="3147">            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">type</span>
</span><span data-line="3148">
</span><span data-line="3149">        <span class="c1"># super-edgy case, if other FKs point to our column,</span>
</span><span data-line="3150">        <span class="c1"># they&#39;d get the type propagated out also.</span>
</span><span data-line="3151">
</span><span data-line="3152">        <span class="k">def</span> <span class="nf">set_type</span><span class="p">(</span><span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3153">            <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_isnull</span><span class="p">:</span>
</span><span data-line="3154">                <span class="n">fk</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">type</span>
</span><span data-line="3155">
</span><span data-line="3156">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_setup_on_memoized_fks</span><span class="p">(</span><span class="n">set_type</span><span class="p">)</span>
</span><span data-line="3157">
</span><span data-line="3158">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>  <span class="c1"># type: ignore</span>
</span><span data-line="3159">
</span><span data-line="3160">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span data-line="3161">    <span class="k">def</span> <span class="nf">column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span data-line="3162"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the target :class:`_schema.Column` referenced by this</span>
</span><span data-line="3163"><span class="sd">        :class:`_schema.ForeignKey`.</span>
</span><span data-line="3164">
</span><span data-line="3165"><span class="sd">        If no target column has been established, an exception</span>
</span><span data-line="3166"><span class="sd">        is raised.</span>
</span><span data-line="3167">
</span><span data-line="3168"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3169">
</span><span data-line="3170">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_column</span><span class="p">()</span>
</span><span data-line="3171">
</span><span data-line="3172">    <span class="nd">@overload</span>
</span><span data-line="3173">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span>
</span><span data-line="3174">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
</span><span data-line="3175">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span> <span class="o">...</span>
</span><span data-line="3176">
</span><span data-line="3177">    <span class="nd">@overload</span>
</span><span data-line="3178">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span>
</span><span data-line="3179">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span data-line="3180">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span> <span class="o">...</span>
</span><span data-line="3181">
</span><span data-line="3182">    <span class="k">def</span> <span class="nf">_resolve_column</span><span class="p">(</span>
</span><span data-line="3183">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">raiseerr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3184">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="3185">        <span class="n">_column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span data-line="3186">
</span><span data-line="3187">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="3188">            <span class="n">parenttable</span><span class="p">,</span> <span class="n">tablekey</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span data-line="3189">
</span><span data-line="3190">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unresolvable</span> <span class="ow">or</span> <span class="n">tablekey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
</span><span data-line="3191">                <span class="k">if</span> <span class="ow">not</span> <span class="n">raiseerr</span><span class="p">:</span>
</span><span data-line="3192">                    <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="3193">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedTableError</span><span class="p">(</span>
</span><span data-line="3194">                    <span class="sa">f</span><span class="s2">&quot;Foreign key associated with column &quot;</span>
</span><span data-line="3195">                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">&#39; could not find &quot;</span>
</span><span data-line="3196">                    <span class="sa">f</span><span class="s2">&quot;table &#39;</span><span class="si">{</span><span class="n">tablekey</span><span class="si">}</span><span class="s2">&#39; with which to generate a &quot;</span>
</span><span data-line="3197">                    <span class="sa">f</span><span class="s2">&quot;foreign key to target column &#39;</span><span class="si">{</span><span class="n">colname</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
</span><span data-line="3198">                    <span class="n">tablekey</span><span class="p">,</span>
</span><span data-line="3199">                <span class="p">)</span>
</span><span data-line="3200">            <span class="k">elif</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
</span><span data-line="3201">                <span class="k">if</span> <span class="ow">not</span> <span class="n">raiseerr</span><span class="p">:</span>
</span><span data-line="3202">                    <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="3203">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="3204">                    <span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">parenttable</span><span class="si">}</span><span class="s2"> is no longer associated with its &quot;</span>
</span><span data-line="3205">                    <span class="s2">&quot;parent MetaData&quot;</span>
</span><span data-line="3206">                <span class="p">)</span>
</span><span data-line="3207">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="3208">                <span class="n">table</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">tablekey</span><span class="p">]</span>
</span><span data-line="3209">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span data-line="3210">                    <span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span>
</span><span data-line="3211">                <span class="p">)</span>
</span><span data-line="3212">
</span><span data-line="3213">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="s2">&quot;__clause_element__&quot;</span><span class="p">):</span>
</span><span data-line="3214">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="o">.</span><span class="n">__clause_element__</span><span class="p">()</span>
</span><span data-line="3215">            <span class="k">return</span> <span class="n">_column</span>
</span><span data-line="3216">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3217">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span data-line="3218">            <span class="k">return</span> <span class="n">_column</span>
</span><span data-line="3219">
</span><span data-line="3220">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3221">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="3222">
</span><span data-line="3223">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
</span><span data-line="3224">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="3225">                <span class="s2">&quot;This ForeignKey already has a parent !&quot;</span>
</span><span data-line="3226">            <span class="p">)</span>
</span><span data-line="3227">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="3228">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="3229">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">)</span>
</span><span data-line="3230">
</span><span data-line="3231">    <span class="k">def</span> <span class="nf">_set_remote_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3232">        <span class="n">parenttable</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span data-line="3233">        <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span><span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="3234">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span data-line="3235">        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="3236">        <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_validate_dest_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="3237">
</span><span data-line="3238">    <span class="k">def</span> <span class="nf">_remove_from_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3239">        <span class="n">parenttable</span><span class="p">,</span> <span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span data-line="3240">        <span class="n">fk_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="3241">
</span><span data-line="3242">        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]:</span>
</span><span data-line="3243">            <span class="c1"># TODO: no test coverage for self not in memos</span>
</span><span data-line="3244">            <span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="3245">
</span><span data-line="3246">    <span class="k">def</span> <span class="nf">_set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3247">        <span class="c1"># standalone ForeignKey - create ForeignKeyConstraint</span>
</span><span data-line="3248">        <span class="c1"># on the hosting Table when attached to the Table.</span>
</span><span data-line="3249">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="3250">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3251">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span> <span class="o">=</span> <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
</span><span data-line="3252">                <span class="p">[],</span>
</span><span data-line="3253">                <span class="p">[],</span>
</span><span data-line="3254">                <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span data-line="3255">                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="3256">                <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span data-line="3257">                <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span data-line="3258">                <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="3259">                <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="3260">                <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span data-line="3261">                <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="3262">                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_unvalidated_dialect_kw</span><span class="p">,</span>
</span><span data-line="3263">            <span class="p">)</span>
</span><span data-line="3264">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_append_element</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="3265">            <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="3266">        <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="3267">        <span class="c1"># set up remote &quot;.column&quot; attribute, or a note to pick it</span>
</span><span data-line="3268">        <span class="c1"># up when the other Table/Column shows up</span>
</span><span data-line="3269">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="3270">            <span class="n">parenttable</span><span class="p">,</span> <span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_col_tokens</span><span class="p">()</span>
</span><span data-line="3271">            <span class="n">fk_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">colname</span><span class="p">)</span>
</span><span data-line="3272">            <span class="k">if</span> <span class="n">table_key</span> <span class="ow">in</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span data-line="3273">                <span class="n">table</span> <span class="o">=</span> <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_key</span><span class="p">]</span>
</span><span data-line="3274">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="3275">                    <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_to_col_by_colstring</span><span class="p">(</span>
</span><span data-line="3276">                        <span class="n">parenttable</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">colname</span>
</span><span data-line="3277">                    <span class="p">)</span>
</span><span data-line="3278">                <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">NoReferencedColumnError</span><span class="p">:</span>
</span><span data-line="3279">                    <span class="c1"># this is OK, we&#39;ll try later</span>
</span><span data-line="3280">                    <span class="k">pass</span>
</span><span data-line="3281">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="3282">                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span data-line="3283">
</span><span data-line="3284">            <span class="n">parenttable</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">[</span><span class="n">fk_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="3285">        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="p">,</span> <span class="s2">&quot;__clause_element__&quot;</span><span class="p">):</span>
</span><span data-line="3286">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span><span class="o">.</span><span class="n">__clause_element__</span><span class="p">()</span>
</span><span data-line="3287">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span data-line="3288">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3289">            <span class="n">_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colspec</span>
</span><span data-line="3290">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_target_column</span><span class="p">(</span><span class="n">_column</span><span class="p">)</span>
</span><span data-line="3291">
</span><span data-line="3292">
</span><span data-line="3293"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="3294">
</span><span data-line="3295">    <span class="k">def</span> <span class="nf">default_is_sequence</span><span class="p">(</span>
</span><span data-line="3296">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span data-line="3297">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]:</span> <span class="o">...</span>
</span><span data-line="3298">
</span><span data-line="3299">    <span class="k">def</span> <span class="nf">default_is_clause_element</span><span class="p">(</span>
</span><span data-line="3300">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span data-line="3301">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">ColumnElementColumnDefault</span><span class="p">]:</span> <span class="o">...</span>
</span><span data-line="3302">
</span><span data-line="3303">    <span class="k">def</span> <span class="nf">default_is_scalar</span><span class="p">(</span>
</span><span data-line="3304">        <span class="n">obj</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DefaultGenerator</span><span class="p">],</span>
</span><span data-line="3305">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">ScalarElementColumnDefault</span><span class="p">]:</span> <span class="o">...</span>
</span><span data-line="3306">
</span><span data-line="3307"><span class="k">else</span><span class="p">:</span>
</span><span data-line="3308">    <span class="n">default_is_sequence</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_sequence&quot;</span><span class="p">)</span>
</span><span data-line="3309">
</span><span data-line="3310">    <span class="n">default_is_clause_element</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_clause_element&quot;</span><span class="p">)</span>
</span><span data-line="3311">
</span><span data-line="3312">    <span class="n">default_is_scalar</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;is_scalar&quot;</span><span class="p">)</span>
</span><span data-line="3313">
</span><span data-line="3314">
</span><span data-line="3315"><span class="k">class</span> <span class="nc">DefaultGenerator</span><span class="p">(</span><span class="n">Executable</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="3316"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for column *default* values.</span>
</span><span data-line="3317">
</span><span data-line="3318"><span class="sd">    This object is only present on column.default or column.onupdate.</span>
</span><span data-line="3319"><span class="sd">    It&#39;s not valid as a server default.</span>
</span><span data-line="3320">
</span><span data-line="3321"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3322">
</span><span data-line="3323">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;default_generator&quot;</span>
</span><span data-line="3324">
</span><span data-line="3325">    <span class="n">_is_default_generator</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3326">    <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3327">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3328">    <span class="n">is_server_default</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3329">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3330">    <span class="n">is_callable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3331">    <span class="n">is_scalar</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3332">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3333">    <span class="n">is_sentinel</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3334">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="3335">
</span><span data-line="3336">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3337">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3338">
</span><span data-line="3339">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3340">        <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="3341">            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="3342">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="3343">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span data-line="3344">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="3345">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3346">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="3347">
</span><span data-line="3348">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultGenerator</span><span class="p">:</span>
</span><span data-line="3349">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span data-line="3350">
</span><span data-line="3351">    <span class="k">def</span> <span class="nf">_execute_on_connection</span><span class="p">(</span>
</span><span data-line="3352">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3353">        <span class="n">connection</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span>
</span><span data-line="3354">        <span class="n">distilled_params</span><span class="p">:</span> <span class="n">_CoreMultiExecuteParams</span><span class="p">,</span>
</span><span data-line="3355">        <span class="n">execution_options</span><span class="p">:</span> <span class="n">CoreExecuteOptionsParameter</span><span class="p">,</span>
</span><span data-line="3356">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="3357">        <span class="n">util</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
</span><span data-line="3358">            <span class="s2">&quot;Using the .execute() method to invoke a &quot;</span>
</span><span data-line="3359">            <span class="s2">&quot;DefaultGenerator object is deprecated; please use &quot;</span>
</span><span data-line="3360">            <span class="s2">&quot;the .scalar() method.&quot;</span><span class="p">,</span>
</span><span data-line="3361">            <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span data-line="3362">        <span class="p">)</span>
</span><span data-line="3363">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_on_scalar</span><span class="p">(</span>
</span><span data-line="3364">            <span class="n">connection</span><span class="p">,</span> <span class="n">distilled_params</span><span class="p">,</span> <span class="n">execution_options</span>
</span><span data-line="3365">        <span class="p">)</span>
</span><span data-line="3366">
</span><span data-line="3367">    <span class="k">def</span> <span class="nf">_execute_on_scalar</span><span class="p">(</span>
</span><span data-line="3368">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3369">        <span class="n">connection</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span>
</span><span data-line="3370">        <span class="n">distilled_params</span><span class="p">:</span> <span class="n">_CoreMultiExecuteParams</span><span class="p">,</span>
</span><span data-line="3371">        <span class="n">execution_options</span><span class="p">:</span> <span class="n">CoreExecuteOptionsParameter</span><span class="p">,</span>
</span><span data-line="3372">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span data-line="3373">        <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">_execute_default</span><span class="p">(</span>
</span><span data-line="3374">            <span class="bp">self</span><span class="p">,</span> <span class="n">distilled_params</span><span class="p">,</span> <span class="n">execution_options</span>
</span><span data-line="3375">        <span class="p">)</span>
</span><span data-line="3376">
</span><span data-line="3377">
</span><span data-line="3378"><span class="k">class</span> <span class="nc">ColumnDefault</span><span class="p">(</span><span class="n">DefaultGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
</span><span data-line="3379"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A plain default value on a column.</span>
</span><span data-line="3380">
</span><span data-line="3381"><span class="sd">    This could correspond to a constant, a callable function,</span>
</span><span data-line="3382"><span class="sd">    or a SQL clause.</span>
</span><span data-line="3383">
</span><span data-line="3384"><span class="sd">    :class:`.ColumnDefault` is generated automatically</span>
</span><span data-line="3385"><span class="sd">    whenever the ``default``, ``onupdate`` arguments of</span>
</span><span data-line="3386"><span class="sd">    :class:`_schema.Column` are used.  A :class:`.ColumnDefault`</span>
</span><span data-line="3387"><span class="sd">    can be passed positionally as well.</span>
</span><span data-line="3388">
</span><span data-line="3389"><span class="sd">    For example, the following::</span>
</span><span data-line="3390">
</span><span data-line="3391"><span class="sd">        Column(&#39;foo&#39;, Integer, default=50)</span>
</span><span data-line="3392">
</span><span data-line="3393"><span class="sd">    Is equivalent to::</span>
</span><span data-line="3394">
</span><span data-line="3395"><span class="sd">        Column(&#39;foo&#39;, Integer, ColumnDefault(50))</span>
</span><span data-line="3396">
</span><span data-line="3397">
</span><span data-line="3398"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3399">
</span><span data-line="3400">    <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="3401">
</span><span data-line="3402">    <span class="nd">@overload</span>
</span><span data-line="3403">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span data-line="3404">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span data-line="3405">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallableColumnDefault</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="3406">
</span><span data-line="3407">    <span class="nd">@overload</span>
</span><span data-line="3408">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span data-line="3409">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span>
</span><span data-line="3410">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElementColumnDefault</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="3411">
</span><span data-line="3412">    <span class="c1"># if I return ScalarElementColumnDefault here, which is what&#39;s actually</span>
</span><span data-line="3413">    <span class="c1"># returned, mypy complains that</span>
</span><span data-line="3414">    <span class="c1"># overloads overlap w/ incompatible return types.</span>
</span><span data-line="3415">    <span class="nd">@overload</span>
</span><span data-line="3416">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnDefault</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="3417">
</span><span data-line="3418">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span data-line="3419">        <span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3420">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnDefault</span><span class="p">:</span>
</span><span data-line="3421"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a new :class:`.ColumnDefault`.</span>
</span><span data-line="3422">
</span><span data-line="3423">
</span><span data-line="3424"><span class="sd">        :param arg: argument representing the default value.</span>
</span><span data-line="3425"><span class="sd">         May be one of the following:</span>
</span><span data-line="3426">
</span><span data-line="3427"><span class="sd">         * a plain non-callable Python value, such as a</span>
</span><span data-line="3428"><span class="sd">           string, integer, boolean, or other simple type.</span>
</span><span data-line="3429"><span class="sd">           The default value will be used as is each time.</span>
</span><span data-line="3430"><span class="sd">         * a SQL expression, that is one which derives from</span>
</span><span data-line="3431"><span class="sd">           :class:`_expression.ColumnElement`.  The SQL expression will</span>
</span><span data-line="3432"><span class="sd">           be rendered into the INSERT or UPDATE statement,</span>
</span><span data-line="3433"><span class="sd">           or in the case of a primary key column when</span>
</span><span data-line="3434"><span class="sd">           RETURNING is not used may be</span>
</span><span data-line="3435"><span class="sd">           pre-executed before an INSERT within a SELECT.</span>
</span><span data-line="3436"><span class="sd">         * A Python callable.  The function will be invoked for each</span>
</span><span data-line="3437"><span class="sd">           new row subject to an INSERT or UPDATE.</span>
</span><span data-line="3438"><span class="sd">           The callable must accept exactly</span>
</span><span data-line="3439"><span class="sd">           zero or one positional arguments.  The one-argument form</span>
</span><span data-line="3440"><span class="sd">           will receive an instance of the :class:`.ExecutionContext`,</span>
</span><span data-line="3441"><span class="sd">           which provides contextual information as to the current</span>
</span><span data-line="3442"><span class="sd">           :class:`_engine.Connection` in use as well as the current</span>
</span><span data-line="3443"><span class="sd">           statement and parameters.</span>
</span><span data-line="3444">
</span><span data-line="3445"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3446">
</span><span data-line="3447">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">):</span>
</span><span data-line="3448">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="3449">                <span class="s2">&quot;ColumnDefault may not be a server-side default type.&quot;</span>
</span><span data-line="3450">            <span class="p">)</span>
</span><span data-line="3451">        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span><span data-line="3452">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">CallableColumnDefault</span>
</span><span data-line="3453">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">):</span>
</span><span data-line="3454">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ColumnElementColumnDefault</span>
</span><span data-line="3455">        <span class="k">elif</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3456">            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ScalarElementColumnDefault</span>
</span><span data-line="3457">
</span><span data-line="3458">        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span data-line="3459">
</span><span data-line="3460">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="3461">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</span><span data-line="3462">
</span><span data-line="3463">
</span><span data-line="3464"><span class="k">class</span> <span class="nc">ScalarElementColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span data-line="3465"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a fixed scalar Python value</span>
</span><span data-line="3466">
</span><span data-line="3467"><span class="sd">    .. versionadded: 2.0</span>
</span><span data-line="3468">
</span><span data-line="3469"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3470">
</span><span data-line="3471">    <span class="n">is_scalar</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3472">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3473">
</span><span data-line="3474">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3475">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3476">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span data-line="3477">
</span><span data-line="3478">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScalarElementColumnDefault</span><span class="p">:</span>
</span><span data-line="3479">        <span class="k">return</span> <span class="n">ScalarElementColumnDefault</span><span class="p">(</span>
</span><span data-line="3480">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span>
</span><span data-line="3481">        <span class="p">)</span>
</span><span data-line="3482">
</span><span data-line="3483">
</span><span data-line="3484"><span class="k">class</span> <span class="nc">_InsertSentinelColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span data-line="3485"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Default generator that&#39;s specific to the use of a &quot;sentinel&quot; column</span>
</span><span data-line="3486"><span class="sd">    when using the insertmanyvalues feature.</span>
</span><span data-line="3487">
</span><span data-line="3488"><span class="sd">    This default is used as part of the :func:`_schema.insert_sentinel`</span>
</span><span data-line="3489"><span class="sd">    construct.</span>
</span><span data-line="3490">
</span><span data-line="3491"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3492">
</span><span data-line="3493">    <span class="n">is_sentinel</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3494">    <span class="n">for_update</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3495">    <span class="n">arg</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3496">
</span><span data-line="3497">    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">:</span>
</span><span data-line="3498">        <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span data-line="3499">
</span><span data-line="3500">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3501">        <span class="k">pass</span>
</span><span data-line="3502">
</span><span data-line="3503">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3504">        <span class="n">col</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Column[Any]&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span data-line="3505">        <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">_insert_sentinel</span><span class="p">:</span>
</span><span data-line="3506">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="3507">                <span class="s2">&quot;The _InsertSentinelColumnDefault may only be applied to a &quot;</span>
</span><span data-line="3508">                <span class="s2">&quot;Column marked as insert_sentinel=True&quot;</span>
</span><span data-line="3509">            <span class="p">)</span>
</span><span data-line="3510">        <span class="k">elif</span> <span class="ow">not</span> <span class="n">col</span><span class="o">.</span><span class="n">nullable</span><span class="p">:</span>
</span><span data-line="3511">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="3512">                <span class="s2">&quot;The _InsertSentinelColumnDefault may only be applied to a &quot;</span>
</span><span data-line="3513">                <span class="s2">&quot;Column that is nullable&quot;</span>
</span><span data-line="3514">            <span class="p">)</span>
</span><span data-line="3515">
</span><span data-line="3516">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="3517">
</span><span data-line="3518">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">:</span>
</span><span data-line="3519">        <span class="k">return</span> <span class="n">_InsertSentinelColumnDefault</span><span class="p">()</span>
</span><span data-line="3520">
</span><span data-line="3521">
</span><span data-line="3522"><span class="n">_SQLExprDefault</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;ColumnElement[Any]&quot;</span><span class="p">,</span> <span class="s2">&quot;TextClause&quot;</span><span class="p">]</span>
</span><span data-line="3523">
</span><span data-line="3524">
</span><span data-line="3525"><span class="k">class</span> <span class="nc">ColumnElementColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span data-line="3526"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a SQL expression</span>
</span><span data-line="3527">
</span><span data-line="3528"><span class="sd">    .. versionadded:: 2.0</span>
</span><span data-line="3529">
</span><span data-line="3530"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3531">
</span><span data-line="3532">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3533">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3534">    <span class="n">arg</span><span class="p">:</span> <span class="n">_SQLExprDefault</span>
</span><span data-line="3535">
</span><span data-line="3536">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="3537">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3538">        <span class="n">arg</span><span class="p">:</span> <span class="n">_SQLExprDefault</span><span class="p">,</span>
</span><span data-line="3539">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="3540">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3541">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3542">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span data-line="3543">
</span><span data-line="3544">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnElementColumnDefault</span><span class="p">:</span>
</span><span data-line="3545">        <span class="k">return</span> <span class="n">ColumnElementColumnDefault</span><span class="p">(</span>
</span><span data-line="3546">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span>
</span><span data-line="3547">        <span class="p">)</span>
</span><span data-line="3548">
</span><span data-line="3549">    <span class="nd">@util</span><span class="o">.</span><span class="n">memoized_property</span>
</span><span data-line="3550">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.sql.sqltypes&quot;</span><span class="p">)</span>
</span><span data-line="3551">    <span class="k">def</span> <span class="nf">_arg_is_typed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="3552">        <span class="n">sqltypes</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">sql_sqltypes</span>
</span><span data-line="3553">
</span><span data-line="3554">        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">sqltypes</span><span class="o">.</span><span class="n">NullType</span><span class="p">)</span>
</span><span data-line="3555">
</span><span data-line="3556">
</span><span data-line="3557"><span class="k">class</span> <span class="nc">_CallableColumnDefaultProtocol</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span data-line="3558">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">ExecutionContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="3559">
</span><span data-line="3560">
</span><span data-line="3561"><span class="k">class</span> <span class="nc">CallableColumnDefault</span><span class="p">(</span><span class="n">ColumnDefault</span><span class="p">):</span>
</span><span data-line="3562"><span class="w">    </span><span class="sd">&quot;&quot;&quot;default generator for a callable Python function</span>
</span><span data-line="3563">
</span><span data-line="3564"><span class="sd">    .. versionadded:: 2.0</span>
</span><span data-line="3565">
</span><span data-line="3566"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3567">
</span><span data-line="3568">    <span class="n">is_callable</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3569">    <span class="n">arg</span><span class="p">:</span> <span class="n">_CallableColumnDefaultProtocol</span>
</span><span data-line="3570">    <span class="n">has_arg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3571">
</span><span data-line="3572">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="3573">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3574">        <span class="n">arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_CallableColumnDefaultProtocol</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]],</span>
</span><span data-line="3575">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="3576">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3577">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3578">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_wrap_callable</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span data-line="3579">
</span><span data-line="3580">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallableColumnDefault</span><span class="p">:</span>
</span><span data-line="3581">        <span class="k">return</span> <span class="n">CallableColumnDefault</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="3582">
</span><span data-line="3583">    <span class="k">def</span> <span class="nf">_maybe_wrap_callable</span><span class="p">(</span>
</span><span data-line="3584">        <span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_CallableColumnDefaultProtocol</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]]</span>
</span><span data-line="3585">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_CallableColumnDefaultProtocol</span><span class="p">:</span>
</span><span data-line="3586"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrap callables that don&#39;t accept a context.</span>
</span><span data-line="3587">
</span><span data-line="3588"><span class="sd">        This is to allow easy compatibility with default callables</span>
</span><span data-line="3589"><span class="sd">        that aren&#39;t specific to accepting of a context.</span>
</span><span data-line="3590">
</span><span data-line="3591"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3592">
</span><span data-line="3593">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="3594">            <span class="n">argspec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_callable_argspec</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">no_self</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="3595">        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span data-line="3596">            <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">wrap_callable</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">fn</span><span class="p">(),</span> <span class="n">fn</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="3597">
</span><span data-line="3598">        <span class="n">defaulted</span> <span class="o">=</span> <span class="n">argspec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="ow">or</span> <span class="mi">0</span>
</span><span data-line="3599">        <span class="n">positionals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">argspec</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">defaulted</span>
</span><span data-line="3600">
</span><span data-line="3601">        <span class="k">if</span> <span class="n">positionals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="3602">            <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">wrap_callable</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">fn</span><span class="p">(),</span> <span class="n">fn</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="3603">
</span><span data-line="3604">        <span class="k">elif</span> <span class="n">positionals</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="3605">            <span class="k">return</span> <span class="n">fn</span>  <span class="c1"># type: ignore</span>
</span><span data-line="3606">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3607">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="3608">                <span class="s2">&quot;ColumnDefault Python function takes zero or one &quot;</span>
</span><span data-line="3609">                <span class="s2">&quot;positional arguments&quot;</span>
</span><span data-line="3610">            <span class="p">)</span>
</span><span data-line="3611">
</span><span data-line="3612">
</span><span data-line="3613"><span class="k">class</span> <span class="nc">IdentityOptions</span><span class="p">:</span>
</span><span data-line="3614"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines options for a named database sequence or an identity column.</span>
</span><span data-line="3615">
</span><span data-line="3616"><span class="sd">    .. versionadded:: 1.3.18</span>
</span><span data-line="3617">
</span><span data-line="3618"><span class="sd">    .. seealso::</span>
</span><span data-line="3619">
</span><span data-line="3620"><span class="sd">        :class:`.Sequence`</span>
</span><span data-line="3621">
</span><span data-line="3622"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3623">
</span><span data-line="3624">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="3625">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3626">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3627">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3628">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3629">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3630">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3631">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3632">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3633">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3634">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3635">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3636"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a :class:`.IdentityOptions` object.</span>
</span><span data-line="3637">
</span><span data-line="3638"><span class="sd">        See the :class:`.Sequence` documentation for a complete description</span>
</span><span data-line="3639"><span class="sd">        of the parameters.</span>
</span><span data-line="3640">
</span><span data-line="3641"><span class="sd">        :param start: the starting index of the sequence.</span>
</span><span data-line="3642"><span class="sd">        :param increment: the increment value of the sequence.</span>
</span><span data-line="3643"><span class="sd">        :param minvalue: the minimum value of the sequence.</span>
</span><span data-line="3644"><span class="sd">        :param maxvalue: the maximum value of the sequence.</span>
</span><span data-line="3645"><span class="sd">        :param nominvalue: no minimum value of the sequence.</span>
</span><span data-line="3646"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.</span>
</span><span data-line="3647"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span data-line="3648"><span class="sd">         or minvalue has been reached.</span>
</span><span data-line="3649"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span data-line="3650"><span class="sd">         sequence which are calculated in advance.</span>
</span><span data-line="3651"><span class="sd">        :param order: optional boolean value; if ``True``, renders the</span>
</span><span data-line="3652"><span class="sd">         ORDER keyword.</span>
</span><span data-line="3653">
</span><span data-line="3654"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3655">        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
</span><span data-line="3656">        <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">=</span> <span class="n">increment</span>
</span><span data-line="3657">        <span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span> <span class="o">=</span> <span class="n">minvalue</span>
</span><span data-line="3658">        <span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span> <span class="o">=</span> <span class="n">maxvalue</span>
</span><span data-line="3659">        <span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span> <span class="o">=</span> <span class="n">nominvalue</span>
</span><span data-line="3660">        <span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span> <span class="o">=</span> <span class="n">nomaxvalue</span>
</span><span data-line="3661">        <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="n">cycle</span>
</span><span data-line="3662">        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span>
</span><span data-line="3663">        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
</span><span data-line="3664">
</span><span data-line="3665">    <span class="nd">@property</span>
</span><span data-line="3666">    <span class="k">def</span> <span class="nf">_increment_is_negative</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="3667">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">increment</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span data-line="3668">
</span><span data-line="3669">
</span><span data-line="3670"><span class="k">class</span> <span class="nc">Sequence</span><span class="p">(</span><span class="n">HasSchemaAttr</span><span class="p">,</span> <span class="n">IdentityOptions</span><span class="p">,</span> <span class="n">DefaultGenerator</span><span class="p">):</span>
</span><span data-line="3671"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a named database sequence.</span>
</span><span data-line="3672">
</span><span data-line="3673"><span class="sd">    The :class:`.Sequence` object represents the name and configurational</span>
</span><span data-line="3674"><span class="sd">    parameters of a database sequence.   It also represents</span>
</span><span data-line="3675"><span class="sd">    a construct that can be &quot;executed&quot; by a SQLAlchemy :class:`_engine.Engine`</span>
</span><span data-line="3676"><span class="sd">    or :class:`_engine.Connection`,</span>
</span><span data-line="3677"><span class="sd">    rendering the appropriate &quot;next value&quot; function</span>
</span><span data-line="3678"><span class="sd">    for the target database and returning a result.</span>
</span><span data-line="3679">
</span><span data-line="3680"><span class="sd">    The :class:`.Sequence` is typically associated with a primary key column::</span>
</span><span data-line="3681">
</span><span data-line="3682"><span class="sd">        some_table = Table(</span>
</span><span data-line="3683"><span class="sd">            &#39;some_table&#39;, metadata,</span>
</span><span data-line="3684"><span class="sd">            Column(&#39;id&#39;, Integer, Sequence(&#39;some_table_seq&#39;, start=1),</span>
</span><span data-line="3685"><span class="sd">            primary_key=True)</span>
</span><span data-line="3686"><span class="sd">        )</span>
</span><span data-line="3687">
</span><span data-line="3688"><span class="sd">    When CREATE TABLE is emitted for the above :class:`_schema.Table`, if the</span>
</span><span data-line="3689"><span class="sd">    target platform supports sequences, a CREATE SEQUENCE statement will</span>
</span><span data-line="3690"><span class="sd">    be emitted as well.   For platforms that don&#39;t support sequences,</span>
</span><span data-line="3691"><span class="sd">    the :class:`.Sequence` construct is ignored.</span>
</span><span data-line="3692">
</span><span data-line="3693"><span class="sd">    .. seealso::</span>
</span><span data-line="3694">
</span><span data-line="3695"><span class="sd">        :ref:`defaults_sequences`</span>
</span><span data-line="3696">
</span><span data-line="3697"><span class="sd">        :class:`.CreateSequence`</span>
</span><span data-line="3698">
</span><span data-line="3699"><span class="sd">        :class:`.DropSequence`</span>
</span><span data-line="3700">
</span><span data-line="3701"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3702">
</span><span data-line="3703">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;sequence&quot;</span>
</span><span data-line="3704">
</span><span data-line="3705">    <span class="n">is_sequence</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3706">
</span><span data-line="3707">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="3708">    <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeEngine</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
</span><span data-line="3709">
</span><span data-line="3710">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="3711">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3712">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="3713">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3714">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3715">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3716">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3717">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3718">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3719">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3720">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Literal</span><span class="p">[</span><span class="n">SchemaConst</span><span class="o">.</span><span class="n">BLANK_SCHEMA</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3721">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3722">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3723">        <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_TypeEngineArgument</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3724">        <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="3725">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3726">        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MetaData</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3727">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="3728">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="3729">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3730"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a :class:`.Sequence` object.</span>
</span><span data-line="3731">
</span><span data-line="3732"><span class="sd">        :param name: the name of the sequence.</span>
</span><span data-line="3733">
</span><span data-line="3734"><span class="sd">        :param start: the starting index of the sequence.  This value is</span>
</span><span data-line="3735"><span class="sd">         used when the CREATE SEQUENCE command is emitted to the database</span>
</span><span data-line="3736"><span class="sd">         as the value of the &quot;START WITH&quot; clause. If ``None``, the</span>
</span><span data-line="3737"><span class="sd">         clause is omitted, which on most platforms indicates a starting</span>
</span><span data-line="3738"><span class="sd">         value of 1.</span>
</span><span data-line="3739">
</span><span data-line="3740"><span class="sd">         .. versionchanged:: 2.0 The :paramref:`.Sequence.start` parameter</span>
</span><span data-line="3741"><span class="sd">            is required in order to have DDL emit &quot;START WITH&quot;.  This is a</span>
</span><span data-line="3742"><span class="sd">            reversal of a change made in version 1.4 which would implicitly</span>
</span><span data-line="3743"><span class="sd">            render &quot;START WITH 1&quot; if the :paramref:`.Sequence.start` were</span>
</span><span data-line="3744"><span class="sd">            not included.  See :ref:`change_7211` for more detail.</span>
</span><span data-line="3745">
</span><span data-line="3746"><span class="sd">        :param increment: the increment value of the sequence.  This</span>
</span><span data-line="3747"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span data-line="3748"><span class="sd">         the database as the value of the &quot;INCREMENT BY&quot; clause.  If ``None``,</span>
</span><span data-line="3749"><span class="sd">         the clause is omitted, which on most platforms indicates an</span>
</span><span data-line="3750"><span class="sd">         increment of 1.</span>
</span><span data-line="3751"><span class="sd">        :param minvalue: the minimum value of the sequence.  This</span>
</span><span data-line="3752"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span data-line="3753"><span class="sd">         the database as the value of the &quot;MINVALUE&quot; clause.  If ``None``,</span>
</span><span data-line="3754"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span data-line="3755"><span class="sd">         minvalue of 1 and -2^63-1 for ascending and descending sequences,</span>
</span><span data-line="3756"><span class="sd">         respectively.</span>
</span><span data-line="3757">
</span><span data-line="3758"><span class="sd">        :param maxvalue: the maximum value of the sequence.  This</span>
</span><span data-line="3759"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span data-line="3760"><span class="sd">         the database as the value of the &quot;MAXVALUE&quot; clause.  If ``None``,</span>
</span><span data-line="3761"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span data-line="3762"><span class="sd">         maxvalue of 2^63-1 and -1 for ascending and descending sequences,</span>
</span><span data-line="3763"><span class="sd">         respectively.</span>
</span><span data-line="3764">
</span><span data-line="3765"><span class="sd">        :param nominvalue: no minimum value of the sequence.  This</span>
</span><span data-line="3766"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span data-line="3767"><span class="sd">         the database as the value of the &quot;NO MINVALUE&quot; clause.  If ``None``,</span>
</span><span data-line="3768"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span data-line="3769"><span class="sd">         minvalue of 1 and -2^63-1 for ascending and descending sequences,</span>
</span><span data-line="3770"><span class="sd">         respectively.</span>
</span><span data-line="3771">
</span><span data-line="3772"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.  This</span>
</span><span data-line="3773"><span class="sd">         value is used when the CREATE SEQUENCE command is emitted to</span>
</span><span data-line="3774"><span class="sd">         the database as the value of the &quot;NO MAXVALUE&quot; clause.  If ``None``,</span>
</span><span data-line="3775"><span class="sd">         the clause is omitted, which on most platforms indicates a</span>
</span><span data-line="3776"><span class="sd">         maxvalue of 2^63-1 and -1 for ascending and descending sequences,</span>
</span><span data-line="3777"><span class="sd">         respectively.</span>
</span><span data-line="3778">
</span><span data-line="3779"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span data-line="3780"><span class="sd">         or minvalue has been reached by an ascending or descending sequence</span>
</span><span data-line="3781"><span class="sd">         respectively.  This value is used when the CREATE SEQUENCE command</span>
</span><span data-line="3782"><span class="sd">         is emitted to the database as the &quot;CYCLE&quot; clause.  If the limit is</span>
</span><span data-line="3783"><span class="sd">         reached, the next number generated will be the minvalue or maxvalue,</span>
</span><span data-line="3784"><span class="sd">         respectively.  If cycle=False (the default) any calls to nextval</span>
</span><span data-line="3785"><span class="sd">         after the sequence has reached its maximum value will return an</span>
</span><span data-line="3786"><span class="sd">         error.</span>
</span><span data-line="3787">
</span><span data-line="3788"><span class="sd">        :param schema: optional schema name for the sequence, if located</span>
</span><span data-line="3789"><span class="sd">         in a schema other than the default.  The rules for selecting the</span>
</span><span data-line="3790"><span class="sd">         schema name when a :class:`_schema.MetaData`</span>
</span><span data-line="3791"><span class="sd">         is also present are the same</span>
</span><span data-line="3792"><span class="sd">         as that of :paramref:`_schema.Table.schema`.</span>
</span><span data-line="3793">
</span><span data-line="3794"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span data-line="3795"><span class="sd">         sequence which are calculated in advance.  Renders the CACHE keyword</span>
</span><span data-line="3796"><span class="sd">         understood by Oracle and PostgreSQL.</span>
</span><span data-line="3797">
</span><span data-line="3798"><span class="sd">        :param order: optional boolean value; if ``True``, renders the</span>
</span><span data-line="3799"><span class="sd">         ORDER keyword, understood by Oracle, indicating the sequence is</span>
</span><span data-line="3800"><span class="sd">         definitively ordered.   May be necessary to provide deterministic</span>
</span><span data-line="3801"><span class="sd">         ordering using Oracle RAC.</span>
</span><span data-line="3802">
</span><span data-line="3803"><span class="sd">        :param data_type: The type to be returned by the sequence, for</span>
</span><span data-line="3804"><span class="sd">         dialects that allow us to choose between INTEGER, BIGINT, etc.</span>
</span><span data-line="3805"><span class="sd">         (e.g., mssql).</span>
</span><span data-line="3806">
</span><span data-line="3807"><span class="sd">         .. versionadded:: 1.4.0</span>
</span><span data-line="3808">
</span><span data-line="3809"><span class="sd">        :param optional: boolean value, when ``True``, indicates that this</span>
</span><span data-line="3810"><span class="sd">         :class:`.Sequence` object only needs to be explicitly generated</span>
</span><span data-line="3811"><span class="sd">         on backends that don&#39;t provide another way to generate primary</span>
</span><span data-line="3812"><span class="sd">         key identifiers.  Currently, it essentially means, &quot;don&#39;t create</span>
</span><span data-line="3813"><span class="sd">         this sequence on the PostgreSQL backend, where the SERIAL keyword</span>
</span><span data-line="3814"><span class="sd">         creates a sequence for us automatically&quot;.</span>
</span><span data-line="3815"><span class="sd">        :param quote: boolean value, when ``True`` or ``False``, explicitly</span>
</span><span data-line="3816"><span class="sd">         forces quoting of the :paramref:`_schema.Sequence.name` on or off.</span>
</span><span data-line="3817"><span class="sd">         When left at its default of ``None``, normal quoting rules based</span>
</span><span data-line="3818"><span class="sd">         on casing and reserved words take place.</span>
</span><span data-line="3819"><span class="sd">        :param quote_schema: Set the quoting preferences for the ``schema``</span>
</span><span data-line="3820"><span class="sd">         name.</span>
</span><span data-line="3821">
</span><span data-line="3822"><span class="sd">        :param metadata: optional :class:`_schema.MetaData` object which this</span>
</span><span data-line="3823"><span class="sd">         :class:`.Sequence` will be associated with.  A :class:`.Sequence`</span>
</span><span data-line="3824"><span class="sd">         that is associated with a :class:`_schema.MetaData`</span>
</span><span data-line="3825"><span class="sd">         gains the following</span>
</span><span data-line="3826"><span class="sd">         capabilities:</span>
</span><span data-line="3827">
</span><span data-line="3828"><span class="sd">         * The :class:`.Sequence` will inherit the</span>
</span><span data-line="3829"><span class="sd">           :paramref:`_schema.MetaData.schema`</span>
</span><span data-line="3830"><span class="sd">           parameter specified to the target :class:`_schema.MetaData`, which</span>
</span><span data-line="3831"><span class="sd">           affects the production of CREATE / DROP DDL, if any.</span>
</span><span data-line="3832">
</span><span data-line="3833"><span class="sd">         * The :meth:`.Sequence.create` and :meth:`.Sequence.drop` methods</span>
</span><span data-line="3834"><span class="sd">           automatically use the engine bound to the :class:`_schema.MetaData`</span>
</span><span data-line="3835"><span class="sd">           object, if any.</span>
</span><span data-line="3836">
</span><span data-line="3837"><span class="sd">         * The :meth:`_schema.MetaData.create_all` and</span>
</span><span data-line="3838"><span class="sd">           :meth:`_schema.MetaData.drop_all`</span>
</span><span data-line="3839"><span class="sd">           methods will emit CREATE / DROP for this :class:`.Sequence`,</span>
</span><span data-line="3840"><span class="sd">           even if the :class:`.Sequence` is not associated with any</span>
</span><span data-line="3841"><span class="sd">           :class:`_schema.Table` / :class:`_schema.Column`</span>
</span><span data-line="3842"><span class="sd">           that&#39;s a member of this</span>
</span><span data-line="3843"><span class="sd">           :class:`_schema.MetaData`.</span>
</span><span data-line="3844">
</span><span data-line="3845"><span class="sd">         The above behaviors can only occur if the :class:`.Sequence` is</span>
</span><span data-line="3846"><span class="sd">         explicitly associated with the :class:`_schema.MetaData`</span>
</span><span data-line="3847"><span class="sd">         via this parameter.</span>
</span><span data-line="3848">
</span><span data-line="3849"><span class="sd">         .. seealso::</span>
</span><span data-line="3850">
</span><span data-line="3851"><span class="sd">            :ref:`sequence_metadata` - full discussion of the</span>
</span><span data-line="3852"><span class="sd">            :paramref:`.Sequence.metadata` parameter.</span>
</span><span data-line="3853">
</span><span data-line="3854"><span class="sd">        :param for_update: Indicates this :class:`.Sequence`, when associated</span>
</span><span data-line="3855"><span class="sd">         with a :class:`_schema.Column`,</span>
</span><span data-line="3856"><span class="sd">         should be invoked for UPDATE statements</span>
</span><span data-line="3857"><span class="sd">         on that column&#39;s table, rather than for INSERT statements, when</span>
</span><span data-line="3858"><span class="sd">         no value is otherwise present for that column in the statement.</span>
</span><span data-line="3859">
</span><span data-line="3860"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3861">        <span class="n">DefaultGenerator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="3862">        <span class="n">IdentityOptions</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="3863">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="3864">            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
</span><span data-line="3865">            <span class="n">increment</span><span class="o">=</span><span class="n">increment</span><span class="p">,</span>
</span><span data-line="3866">            <span class="n">minvalue</span><span class="o">=</span><span class="n">minvalue</span><span class="p">,</span>
</span><span data-line="3867">            <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span data-line="3868">            <span class="n">nominvalue</span><span class="o">=</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span data-line="3869">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span data-line="3870">            <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span>
</span><span data-line="3871">            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
</span><span data-line="3872">            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span data-line="3873">        <span class="p">)</span>
</span><span data-line="3874">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3875">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span data-line="3876">        <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>
</span><span data-line="3877">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="n">BLANK_SCHEMA</span><span class="p">:</span>
</span><span data-line="3878">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3879">        <span class="k">elif</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
</span><span data-line="3880">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="3881">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3882">            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span data-line="3883">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span data-line="3884">        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="3885">        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
</span><span data-line="3886">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span data-line="3887">        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3888">            <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">to_instance</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
</span><span data-line="3889">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3890">            <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="3891">
</span><span data-line="3892">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.sql.functions&quot;</span><span class="p">)</span>
</span><span data-line="3893">    <span class="k">def</span> <span class="nf">next_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Function</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span data-line="3894"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a :class:`.next_value` function element</span>
</span><span data-line="3895"><span class="sd">        which will render the appropriate increment function</span>
</span><span data-line="3896"><span class="sd">        for this :class:`.Sequence` within any SQL expression.</span>
</span><span data-line="3897">
</span><span data-line="3898"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="3899">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">sql_functions</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">next_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="3900">
</span><span data-line="3901">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3902">        <span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="3903">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="3904">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span data-line="3905">        <span class="n">column</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_table</span><span class="p">)</span>
</span><span data-line="3906">
</span><span data-line="3907">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span data-line="3908">        <span class="k">return</span> <span class="n">Sequence</span><span class="p">(</span>
</span><span data-line="3909">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="3910">            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
</span><span data-line="3911">            <span class="n">increment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
</span><span data-line="3912">            <span class="n">minvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span><span class="p">,</span>
</span><span data-line="3913">            <span class="n">maxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span data-line="3914">            <span class="n">nominvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span data-line="3915">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span data-line="3916">            <span class="n">cycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span>
</span><span data-line="3917">            <span class="n">schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span data-line="3918">            <span class="n">cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span>
</span><span data-line="3919">            <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
</span><span data-line="3920">            <span class="n">data_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span>
</span><span data-line="3921">            <span class="n">optional</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optional</span><span class="p">,</span>
</span><span data-line="3922">            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
</span><span data-line="3923">            <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">,</span>
</span><span data-line="3924">        <span class="p">)</span>
</span><span data-line="3925">
</span><span data-line="3926">    <span class="k">def</span> <span class="nf">_set_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3927">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</span><span data-line="3928">
</span><span data-line="3929">    <span class="k">def</span> <span class="nf">_set_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3930">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span data-line="3931">        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">_sequences</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="3932">
</span><span data-line="3933">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3934"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates this sequence in the database.&quot;&quot;&quot;</span>
</span><span data-line="3935">
</span><span data-line="3936">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="3937">
</span><span data-line="3938">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3939"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drops this sequence from the database.&quot;&quot;&quot;</span>
</span><span data-line="3940">
</span><span data-line="3941">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="3942">
</span><span data-line="3943">    <span class="k">def</span> <span class="nf">_not_a_column_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span data-line="3944">        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="3945">            <span class="sa">f</span><span class="s2">&quot;This </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> cannot be used directly &quot;</span>
</span><span data-line="3946">            <span class="s2">&quot;as a column expression.  Use func.next_value(sequence) &quot;</span>
</span><span data-line="3947">            <span class="s2">&quot;to produce a &#39;next value&#39; function that&#39;s usable &quot;</span>
</span><span data-line="3948">            <span class="s2">&quot;as a column element.&quot;</span>
</span><span data-line="3949">        <span class="p">)</span>
</span><span data-line="3950">
</span><span data-line="3951">
</span><span data-line="3952"><span class="nd">@inspection</span><span class="o">.</span><span class="n">_self_inspects</span>
</span><span data-line="3953"><span class="k">class</span> <span class="nc">FetchedValue</span><span class="p">(</span><span class="n">SchemaEventTarget</span><span class="p">):</span>
</span><span data-line="3954"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A marker for a transparent database-side default.</span>
</span><span data-line="3955">
</span><span data-line="3956"><span class="sd">    Use :class:`.FetchedValue` when the database is configured</span>
</span><span data-line="3957"><span class="sd">    to provide some automatic default for a column.</span>
</span><span data-line="3958">
</span><span data-line="3959"><span class="sd">    E.g.::</span>
</span><span data-line="3960">
</span><span data-line="3961"><span class="sd">        Column(&#39;foo&#39;, Integer, FetchedValue())</span>
</span><span data-line="3962">
</span><span data-line="3963"><span class="sd">    Would indicate that some trigger or default generator</span>
</span><span data-line="3964"><span class="sd">    will create a new value for the ``foo`` column during an</span>
</span><span data-line="3965"><span class="sd">    INSERT.</span>
</span><span data-line="3966">
</span><span data-line="3967"><span class="sd">    .. seealso::</span>
</span><span data-line="3968">
</span><span data-line="3969"><span class="sd">        :ref:`triggered_columns`</span>
</span><span data-line="3970">
</span><span data-line="3971"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="3972">
</span><span data-line="3973">    <span class="n">is_server_default</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="3974">    <span class="n">reflected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3975">    <span class="n">has_argument</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3976">    <span class="n">is_clause_element</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3977">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="3978">
</span><span data-line="3979">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="3980">
</span><span data-line="3981">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="3982">        <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3983">
</span><span data-line="3984">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span data-line="3985">        <span class="k">if</span> <span class="n">for_update</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span data-line="3986">            <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="3987">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="3988">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clone</span><span class="p">(</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="3989">
</span><span data-line="3990">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span data-line="3991">        <span class="k">return</span> <span class="n">FetchedValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="3992">
</span><span data-line="3993">    <span class="k">def</span> <span class="nf">_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span data-line="3994">        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
</span><span data-line="3995">        <span class="n">n</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span data-line="3996">        <span class="n">n</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;column&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="3997">        <span class="n">n</span><span class="o">.</span><span class="n">for_update</span> <span class="o">=</span> <span class="n">for_update</span>
</span><span data-line="3998">        <span class="k">return</span> <span class="n">n</span>
</span><span data-line="3999">
</span><span data-line="4000">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4001">        <span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="4002">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="4003">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>
</span><span data-line="4004">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">:</span>
</span><span data-line="4005">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="4006">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4007">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="4008">
</span><span data-line="4009">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="4010">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">generic_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="4011">
</span><span data-line="4012">
</span><span data-line="4013"><span class="k">class</span> <span class="nc">DefaultClause</span><span class="p">(</span><span class="n">FetchedValue</span><span class="p">):</span>
</span><span data-line="4014"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A DDL-specified DEFAULT column value.</span>
</span><span data-line="4015">
</span><span data-line="4016"><span class="sd">    :class:`.DefaultClause` is a :class:`.FetchedValue`</span>
</span><span data-line="4017"><span class="sd">    that also generates a &quot;DEFAULT&quot; clause when</span>
</span><span data-line="4018"><span class="sd">    &quot;CREATE TABLE&quot; is emitted.</span>
</span><span data-line="4019">
</span><span data-line="4020"><span class="sd">    :class:`.DefaultClause` is generated automatically</span>
</span><span data-line="4021"><span class="sd">    whenever the ``server_default``, ``server_onupdate`` arguments of</span>
</span><span data-line="4022"><span class="sd">    :class:`_schema.Column` are used.  A :class:`.DefaultClause`</span>
</span><span data-line="4023"><span class="sd">    can be passed positionally as well.</span>
</span><span data-line="4024">
</span><span data-line="4025"><span class="sd">    For example, the following::</span>
</span><span data-line="4026">
</span><span data-line="4027"><span class="sd">        Column(&#39;foo&#39;, Integer, server_default=&quot;50&quot;)</span>
</span><span data-line="4028">
</span><span data-line="4029"><span class="sd">    Is equivalent to::</span>
</span><span data-line="4030">
</span><span data-line="4031"><span class="sd">        Column(&#39;foo&#39;, Integer, DefaultClause(&quot;50&quot;))</span>
</span><span data-line="4032">
</span><span data-line="4033"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4034">
</span><span data-line="4035">    <span class="n">has_argument</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="4036">
</span><span data-line="4037">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4038">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4039">        <span class="n">arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">],</span>
</span><span data-line="4040">        <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4041">        <span class="n">_reflected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4042">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4043">        <span class="n">util</span><span class="o">.</span><span class="n">assert_arg_type</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">,</span> <span class="n">TextClause</span><span class="p">),</span> <span class="s2">&quot;arg&quot;</span><span class="p">)</span>
</span><span data-line="4044">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="4045">        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
</span><span data-line="4046">        <span class="bp">self</span><span class="o">.</span><span class="n">reflected</span> <span class="o">=</span> <span class="n">_reflected</span>
</span><span data-line="4047">
</span><span data-line="4048">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DefaultClause</span><span class="p">:</span>
</span><span data-line="4049">        <span class="k">return</span> <span class="n">DefaultClause</span><span class="p">(</span>
</span><span data-line="4050">            <span class="n">arg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">for_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">,</span> <span class="n">_reflected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reflected</span>
</span><span data-line="4051">        <span class="p">)</span>
</span><span data-line="4052">
</span><span data-line="4053">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="4054">        <span class="k">return</span> <span class="s2">&quot;DefaultClause(</span><span class="si">%r</span><span class="s2">, for_update=</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_update</span><span class="p">)</span>
</span><span data-line="4055">
</span><span data-line="4056">
</span><span data-line="4057"><span class="k">class</span> <span class="nc">Constraint</span><span class="p">(</span><span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">HasConditionalDDL</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="4058"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level SQL constraint.</span>
</span><span data-line="4059">
</span><span data-line="4060"><span class="sd">    :class:`_schema.Constraint` serves as the base class for the series of</span>
</span><span data-line="4061"><span class="sd">    constraint objects that can be associated with :class:`_schema.Table`</span>
</span><span data-line="4062"><span class="sd">    objects, including :class:`_schema.PrimaryKeyConstraint`,</span>
</span><span data-line="4063"><span class="sd">    :class:`_schema.ForeignKeyConstraint`</span>
</span><span data-line="4064"><span class="sd">    :class:`_schema.UniqueConstraint`, and</span>
</span><span data-line="4065"><span class="sd">    :class:`_schema.CheckConstraint`.</span>
</span><span data-line="4066">
</span><span data-line="4067"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4068">
</span><span data-line="4069">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;constraint&quot;</span>
</span><span data-line="4070">
</span><span data-line="4071">    <span class="n">_creation_order</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="4072">    <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span>
</span><span data-line="4073">
</span><span data-line="4074">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4075">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4076">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4077">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4078">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4079">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4080">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4081">        <span class="n">_create_rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4082">        <span class="n">_type_bound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4083">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4084">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4085"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create a SQL constraint.</span>
</span><span data-line="4086">
</span><span data-line="4087"><span class="sd">        :param name:</span>
</span><span data-line="4088"><span class="sd">          Optional, the in-database name of this ``Constraint``.</span>
</span><span data-line="4089">
</span><span data-line="4090"><span class="sd">        :param deferrable:</span>
</span><span data-line="4091"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span data-line="4092"><span class="sd">          issuing DDL for this constraint.</span>
</span><span data-line="4093">
</span><span data-line="4094"><span class="sd">        :param initially:</span>
</span><span data-line="4095"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span data-line="4096"><span class="sd">          for this constraint.</span>
</span><span data-line="4097">
</span><span data-line="4098"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="4099"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="4100">
</span><span data-line="4101"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span data-line="4102"><span class="sd">          foreign key constraint creation.</span>
</span><span data-line="4103">
</span><span data-line="4104"><span class="sd">            .. versionadded:: 2.0</span>
</span><span data-line="4105">
</span><span data-line="4106"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span data-line="4107"><span class="sd">            specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  See</span>
</span><span data-line="4108"><span class="sd">            the documentation regarding an individual dialect at</span>
</span><span data-line="4109"><span class="sd">            :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span data-line="4110">
</span><span data-line="4111"><span class="sd">        :param _create_rule:</span>
</span><span data-line="4112"><span class="sd">          used internally by some datatypes that also create constraints.</span>
</span><span data-line="4113">
</span><span data-line="4114"><span class="sd">        :param _type_bound:</span>
</span><span data-line="4115"><span class="sd">          used internally to indicate that this constraint is associated with</span>
</span><span data-line="4116"><span class="sd">          a specific datatype.</span>
</span><span data-line="4117">
</span><span data-line="4118"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4119">
</span><span data-line="4120">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="4121">        <span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span> <span class="o">=</span> <span class="n">deferrable</span>
</span><span data-line="4122">        <span class="bp">self</span><span class="o">.</span><span class="n">initially</span> <span class="o">=</span> <span class="n">initially</span>
</span><span data-line="4123">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span data-line="4124">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="4125">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span> <span class="o">=</span> <span class="n">_create_rule</span>
</span><span data-line="4126">        <span class="bp">self</span><span class="o">.</span><span class="n">_type_bound</span> <span class="o">=</span> <span class="n">_type_bound</span>
</span><span data-line="4127">        <span class="n">util</span><span class="o">.</span><span class="n">set_creation_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="4128">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">dialect_kw</span><span class="p">)</span>
</span><span data-line="4129">        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
</span><span data-line="4130">
</span><span data-line="4131">    <span class="k">def</span> <span class="nf">_should_create_for_compiler</span><span class="p">(</span>
</span><span data-line="4132">        <span class="bp">self</span><span class="p">,</span> <span class="n">compiler</span><span class="p">:</span> <span class="n">DDLCompiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="4133">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="4134">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span><span class="p">(</span><span class="n">compiler</span><span class="p">):</span>
</span><span data-line="4135">            <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="4136">        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4137">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ddl_if</span><span class="o">.</span><span class="n">_should_execute</span><span class="p">(</span>
</span><span data-line="4138">                <span class="n">ddl</span><span class="o">.</span><span class="n">CreateConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span>
</span><span data-line="4139">            <span class="p">)</span>
</span><span data-line="4140">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4141">            <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="4142">
</span><span data-line="4143">    <span class="nd">@property</span>
</span><span data-line="4144">    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span data-line="4145">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="4146">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
</span><span data-line="4147">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span data-line="4148">        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span data-line="4149">            <span class="k">pass</span>
</span><span data-line="4150">        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="4151">            <span class="s2">&quot;This constraint is not bound to a table.  Did you &quot;</span>
</span><span data-line="4152">            <span class="s2">&quot;mean to call table.append_constraint(constraint) ?&quot;</span>
</span><span data-line="4153">        <span class="p">)</span>
</span><span data-line="4154">
</span><span data-line="4155">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4156">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">))</span>
</span><span data-line="4157">        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="4158">        <span class="n">parent</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="4159">
</span><span data-line="4160">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="4161">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="4162">        <span class="s2">&quot;The :meth:`_schema.Constraint.copy` method is deprecated &quot;</span>
</span><span data-line="4163">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="4164">    <span class="p">)</span>
</span><span data-line="4165">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span data-line="4166">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="4167">
</span><span data-line="4168">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span data-line="4169">        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</span><span data-line="4170">
</span><span data-line="4171">
</span><span data-line="4172"><span class="k">class</span> <span class="nc">ColumnCollectionMixin</span><span class="p">:</span>
</span><span data-line="4173"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` of :class:`_schema.Column`</span>
</span><span data-line="4174"><span class="sd">    objects.</span>
</span><span data-line="4175">
</span><span data-line="4176"><span class="sd">    This collection represents the columns which are referred to by</span>
</span><span data-line="4177"><span class="sd">    this object.</span>
</span><span data-line="4178">
</span><span data-line="4179"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4180">
</span><span data-line="4181">    <span class="n">_columns</span><span class="p">:</span> <span class="n">DedupeColumnCollection</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="4182">
</span><span data-line="4183">    <span class="n">_allow_multiple_tables</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="4184">
</span><span data-line="4185">    <span class="n">_pending_colargs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]]</span>
</span><span data-line="4186">
</span><span data-line="4187">    <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="4188">
</span><span data-line="4189">        <span class="k">def</span> <span class="nf">_set_parent_with_dispatch</span><span class="p">(</span>
</span><span data-line="4190">            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="4191">        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="4192">
</span><span data-line="4193">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4194">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4195">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span data-line="4196">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="4197">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4198">        <span class="n">_gather_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="4199">            <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</span><span data-line="4200">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4201">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4202">        <span class="bp">self</span><span class="o">.</span><span class="n">_column_flag</span> <span class="o">=</span> <span class="n">_column_flag</span>
</span><span data-line="4203">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="o">=</span> <span class="n">DedupeColumnCollection</span><span class="p">()</span>
</span><span data-line="4204">
</span><span data-line="4205">        <span class="n">processed_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span data-line="4206">            <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span>
</span><span data-line="4207">        <span class="p">]</span> <span class="o">=</span> <span class="n">_gather_expressions</span>
</span><span data-line="4208">
</span><span data-line="4209">        <span class="k">if</span> <span class="n">processed_expressions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4210">            <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="4211">            <span class="k">for</span> <span class="p">(</span>
</span><span data-line="4212">                <span class="n">expr</span><span class="p">,</span>
</span><span data-line="4213">                <span class="n">_</span><span class="p">,</span>
</span><span data-line="4214">                <span class="n">_</span><span class="p">,</span>
</span><span data-line="4215">                <span class="n">add_element</span><span class="p">,</span>
</span><span data-line="4216">            <span class="p">)</span> <span class="ow">in</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect_col_expression_collection</span><span class="p">(</span>
</span><span data-line="4217">                <span class="n">roles</span><span class="o">.</span><span class="n">DDLConstraintColumnRole</span><span class="p">,</span> <span class="n">columns</span>
</span><span data-line="4218">            <span class="p">):</span>
</span><span data-line="4219">                <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_element</span><span class="p">)</span>
</span><span data-line="4220">                <span class="n">processed_expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</span><span data-line="4221">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4222">            <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4223">                <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLConstraintColumnRole</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
</span><span data-line="4224">                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span>
</span><span data-line="4225">            <span class="p">]</span>
</span><span data-line="4226">
</span><span data-line="4227">        <span class="k">if</span> <span class="n">_autoattach</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="p">:</span>
</span><span data-line="4228">            <span class="bp">self</span><span class="o">.</span><span class="n">_check_attach</span><span class="p">()</span>
</span><span data-line="4229">
</span><span data-line="4230">    <span class="k">def</span> <span class="nf">_check_attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4231">        <span class="n">col_objs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">)]</span>
</span><span data-line="4232">
</span><span data-line="4233">        <span class="n">cols_w_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">col_objs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)]</span>
</span><span data-line="4234">
</span><span data-line="4235">        <span class="n">cols_wo_table</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">col_objs</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">cols_w_table</span><span class="p">)</span>
</span><span data-line="4236">        <span class="k">if</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span data-line="4237">            <span class="c1"># feature #3341 - place event listeners for Column objects</span>
</span><span data-line="4238">            <span class="c1"># such that when all those cols are attached, we autoattach.</span>
</span><span data-line="4239">            <span class="k">assert</span> <span class="ow">not</span> <span class="n">evt</span><span class="p">,</span> <span class="s2">&quot;Should not reach here on event call&quot;</span>
</span><span data-line="4240">
</span><span data-line="4241">            <span class="c1"># issue #3411 - don&#39;t do the per-column auto-attach if some of the</span>
</span><span data-line="4242">            <span class="c1"># columns are specified as strings.</span>
</span><span data-line="4243">            <span class="n">has_string_cols</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="4244">                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="4245">            <span class="p">}</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">col_objs</span><span class="p">)</span>
</span><span data-line="4246">            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_string_cols</span><span class="p">:</span>
</span><span data-line="4247">
</span><span data-line="4248">                <span class="k">def</span> <span class="nf">_col_attached</span><span class="p">(</span><span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4249">                    <span class="c1"># this isinstance() corresponds with the</span>
</span><span data-line="4250">                    <span class="c1"># isinstance() above; only want to count Table-bound</span>
</span><span data-line="4251">                    <span class="c1"># columns</span>
</span><span data-line="4252">                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
</span><span data-line="4253">                        <span class="n">cols_wo_table</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span data-line="4254">                        <span class="k">if</span> <span class="ow">not</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span data-line="4255">                            <span class="bp">self</span><span class="o">.</span><span class="n">_check_attach</span><span class="p">(</span><span class="n">evt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="4256">
</span><span data-line="4257">                <span class="bp">self</span><span class="o">.</span><span class="n">_cols_wo_table</span> <span class="o">=</span> <span class="n">cols_wo_table</span>
</span><span data-line="4258">                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_wo_table</span><span class="p">:</span>
</span><span data-line="4259">                    <span class="n">col</span><span class="o">.</span><span class="n">_on_table_attach</span><span class="p">(</span><span class="n">_col_attached</span><span class="p">)</span>
</span><span data-line="4260">                <span class="k">return</span>
</span><span data-line="4261">
</span><span data-line="4262">        <span class="n">columns</span> <span class="o">=</span> <span class="n">cols_w_table</span>
</span><span data-line="4263">
</span><span data-line="4264">        <span class="n">tables</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">}</span>
</span><span data-line="4265">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="4266">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span data-line="4267">        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_multiple_tables</span><span class="p">:</span>
</span><span data-line="4268">            <span class="n">table</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">table</span>
</span><span data-line="4269">            <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">table</span><span class="p">]</span>
</span><span data-line="4270">            <span class="k">if</span> <span class="n">others</span><span class="p">:</span>
</span><span data-line="4271">                <span class="c1"># black could not format this inline</span>
</span><span data-line="4272">                <span class="n">other_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">others</span><span class="p">)</span>
</span><span data-line="4273">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="4274">                    <span class="sa">f</span><span class="s2">&quot;Column(s) </span><span class="si">{</span><span class="n">other_str</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span data-line="4275">                    <span class="sa">f</span><span class="s2">&quot;are not part of table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span data-line="4276">                <span class="p">)</span>
</span><span data-line="4277">
</span><span data-line="4278">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span data-line="4279">    <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="4280">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">as_readonly</span><span class="p">()</span>
</span><span data-line="4281">
</span><span data-line="4282">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span data-line="4283">    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="4284">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">as_readonly</span><span class="p">()</span>
</span><span data-line="4285">
</span><span data-line="4286">    <span class="k">def</span> <span class="nf">_col_expressions</span><span class="p">(</span>
</span><span data-line="4287">        <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="4288">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]:</span>
</span><span data-line="4289">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">):</span>
</span><span data-line="4290">            <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4291">                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="4292">            <span class="p">]</span>
</span><span data-line="4293">            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span><span class="p">)</span>
</span><span data-line="4294">            <span class="k">return</span> <span class="n">result</span>
</span><span data-line="4295">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4296">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="4297">                <span class="k">return</span> <span class="p">[</span>
</span><span data-line="4298">                    <span class="n">parent</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">col</span>
</span><span data-line="4299">                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span>
</span><span data-line="4300">                <span class="p">]</span>
</span><span data-line="4301">            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ke</span><span class="p">:</span>
</span><span data-line="4302">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ConstraintColumnNotFoundError</span><span class="p">(</span>
</span><span data-line="4303">                    <span class="sa">f</span><span class="s2">&quot;Can&#39;t create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span data-line="4304">                    <span class="sa">f</span><span class="s2">&quot;on table &#39;</span><span class="si">{</span><span class="n">parent</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;: no column &quot;</span>
</span><span data-line="4305">                    <span class="sa">f</span><span class="s2">&quot;named &#39;</span><span class="si">{</span><span class="n">ke</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; is present.&quot;</span>
</span><span data-line="4306">                <span class="p">)</span> <span class="kn">from</span> <span class="nn">ke</span>
</span><span data-line="4307">
</span><span data-line="4308">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4309">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">))</span>
</span><span data-line="4310">
</span><span data-line="4311">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_expressions</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
</span><span data-line="4312">            <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4313">                <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span data-line="4314">
</span><span data-line="4315">
</span><span data-line="4316"><span class="k">class</span> <span class="nc">ColumnCollectionConstraint</span><span class="p">(</span><span class="n">ColumnCollectionMixin</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">):</span>
</span><span data-line="4317"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A constraint that proxies a ColumnCollection.&quot;&quot;&quot;</span>
</span><span data-line="4318">
</span><span data-line="4319">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4320">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4321">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span data-line="4322">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4323">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4324">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4325">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4326">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="4327">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4328">        <span class="n">_gather_expressions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4329">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4330">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4331"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="4332"><span class="sd">        :param \*columns:</span>
</span><span data-line="4333"><span class="sd">          A sequence of column names or Column objects.</span>
</span><span data-line="4334">
</span><span data-line="4335"><span class="sd">        :param name:</span>
</span><span data-line="4336"><span class="sd">          Optional, the in-database name of this constraint.</span>
</span><span data-line="4337">
</span><span data-line="4338"><span class="sd">        :param deferrable:</span>
</span><span data-line="4339"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span data-line="4340"><span class="sd">          issuing DDL for this constraint.</span>
</span><span data-line="4341">
</span><span data-line="4342"><span class="sd">        :param initially:</span>
</span><span data-line="4343"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span data-line="4344"><span class="sd">          for this constraint.</span>
</span><span data-line="4345">
</span><span data-line="4346"><span class="sd">        :param \**dialect_kw: other keyword arguments including</span>
</span><span data-line="4347"><span class="sd">          dialect-specific arguments are propagated to the :class:`.Constraint`</span>
</span><span data-line="4348"><span class="sd">          superclass.</span>
</span><span data-line="4349">
</span><span data-line="4350"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4351">        <span class="n">Constraint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4352">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4353">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4354">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4355">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4356">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span data-line="4357">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span data-line="4358">        <span class="p">)</span>
</span><span data-line="4359">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4360">            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="n">_autoattach</span><span class="o">=</span><span class="n">_autoattach</span><span class="p">,</span> <span class="n">_column_flag</span><span class="o">=</span><span class="n">_column_flag</span>
</span><span data-line="4361">        <span class="p">)</span>
</span><span data-line="4362">
</span><span data-line="4363">    <span class="n">columns</span><span class="p">:</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="4364"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` representing the set of columns</span>
</span><span data-line="4365"><span class="sd">    for this constraint.</span>
</span><span data-line="4366">
</span><span data-line="4367"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4368">
</span><span data-line="4369">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4370">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">(</span><span class="n">Column</span><span class="p">,</span> <span class="n">Table</span><span class="p">))</span>
</span><span data-line="4371">        <span class="n">Constraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span data-line="4372">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
</span><span data-line="4373">
</span><span data-line="4374">    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="4375">        <span class="k">return</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span data-line="4376">
</span><span data-line="4377">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="4378">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="4379">        <span class="s2">&quot;The :meth:`_schema.ColumnCollectionConstraint.copy` method &quot;</span>
</span><span data-line="4380">        <span class="s2">&quot;is deprecated and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="4381">    <span class="p">)</span>
</span><span data-line="4382">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span data-line="4383">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4384">        <span class="o">*</span><span class="p">,</span>
</span><span data-line="4385">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4386">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4387">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnCollectionConstraint</span><span class="p">:</span>
</span><span data-line="4388">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="4389">
</span><span data-line="4390">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span data-line="4391">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4392">        <span class="o">*</span><span class="p">,</span>
</span><span data-line="4393">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4394">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4395">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ColumnCollectionConstraint</span><span class="p">:</span>
</span><span data-line="4396">        <span class="c1"># ticket #5276</span>
</span><span data-line="4397">        <span class="n">constraint_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="4398">        <span class="k">for</span> <span class="n">dialect_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">:</span>
</span><span data-line="4399">            <span class="n">dialect_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialect_options</span><span class="p">[</span><span class="n">dialect_name</span><span class="p">]</span><span class="o">.</span><span class="n">_non_defaults</span>
</span><span data-line="4400">            <span class="k">for</span> <span class="p">(</span>
</span><span data-line="4401">                <span class="n">dialect_option_key</span><span class="p">,</span>
</span><span data-line="4402">                <span class="n">dialect_option_value</span><span class="p">,</span>
</span><span data-line="4403">            <span class="p">)</span> <span class="ow">in</span> <span class="n">dialect_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="4404">                <span class="n">constraint_kwargs</span><span class="p">[</span><span class="n">dialect_name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dialect_option_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="4405">                    <span class="n">dialect_option_value</span>
</span><span data-line="4406">                <span class="p">)</span>
</span><span data-line="4407">
</span><span data-line="4408">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="4409">        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
</span><span data-line="4410">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4411">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4412">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4413">            <span class="o">*</span><span class="p">[</span>
</span><span data-line="4414">                <span class="n">_copy_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">target_table</span><span class="p">)</span>
</span><span data-line="4415">                <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span data-line="4416">            <span class="p">],</span>
</span><span data-line="4417">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="4418">            <span class="o">**</span><span class="n">constraint_kwargs</span><span class="p">,</span>
</span><span data-line="4419">        <span class="p">)</span>
</span><span data-line="4420">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span data-line="4421">
</span><span data-line="4422">    <span class="k">def</span> <span class="nf">contains_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="4423"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if this constraint contains the given column.</span>
</span><span data-line="4424">
</span><span data-line="4425"><span class="sd">        Note that this object also contains an attribute ``.columns``</span>
</span><span data-line="4426"><span class="sd">        which is a :class:`_expression.ColumnCollection` of</span>
</span><span data-line="4427"><span class="sd">        :class:`_schema.Column` objects.</span>
</span><span data-line="4428">
</span><span data-line="4429"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4430">
</span><span data-line="4431">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">contains_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span data-line="4432">
</span><span data-line="4433">    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="4434">        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span data-line="4435">
</span><span data-line="4436">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="4437">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span data-line="4438">
</span><span data-line="4439">
</span><span data-line="4440"><span class="k">class</span> <span class="nc">CheckConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span data-line="4441"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table- or column-level CHECK constraint.</span>
</span><span data-line="4442">
</span><span data-line="4443"><span class="sd">    Can be included in the definition of a Table or Column.</span>
</span><span data-line="4444"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4445">
</span><span data-line="4446">    <span class="n">_allow_multiple_tables</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="4447">
</span><span data-line="4448">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;table_or_column_check_constraint&quot;</span>
</span><span data-line="4449">
</span><span data-line="4450">    <span class="nd">@_document_text_coercion</span><span class="p">(</span>
</span><span data-line="4451">        <span class="s2">&quot;sqltext&quot;</span><span class="p">,</span>
</span><span data-line="4452">        <span class="s2">&quot;:class:`.CheckConstraint`&quot;</span><span class="p">,</span>
</span><span data-line="4453">        <span class="s2">&quot;:paramref:`.CheckConstraint.sqltext`&quot;</span><span class="p">,</span>
</span><span data-line="4454">    <span class="p">)</span>
</span><span data-line="4455">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4456">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4457">        <span class="n">sqltext</span><span class="p">:</span> <span class="n">_TextCoercedExpressionArgument</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
</span><span data-line="4458">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4459">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4460">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4461">        <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4462">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4463">        <span class="n">_create_rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4464">        <span class="n">_autoattach</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="4465">        <span class="n">_type_bound</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4466">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4467">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4468"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a CHECK constraint.</span>
</span><span data-line="4469">
</span><span data-line="4470"><span class="sd">        :param sqltext:</span>
</span><span data-line="4471"><span class="sd">         A string containing the constraint definition, which will be used</span>
</span><span data-line="4472"><span class="sd">         verbatim, or a SQL expression construct.   If given as a string,</span>
</span><span data-line="4473"><span class="sd">         the object is converted to a :func:`_expression.text` object.</span>
</span><span data-line="4474"><span class="sd">         If the textual</span>
</span><span data-line="4475"><span class="sd">         string includes a colon character, escape this using a backslash::</span>
</span><span data-line="4476">
</span><span data-line="4477"><span class="sd">           CheckConstraint(r&quot;foo ~ E&#39;a(?\:b|c)d&quot;)</span>
</span><span data-line="4478">
</span><span data-line="4479"><span class="sd">        :param name:</span>
</span><span data-line="4480"><span class="sd">          Optional, the in-database name of the constraint.</span>
</span><span data-line="4481">
</span><span data-line="4482"><span class="sd">        :param deferrable:</span>
</span><span data-line="4483"><span class="sd">          Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when</span>
</span><span data-line="4484"><span class="sd">          issuing DDL for this constraint.</span>
</span><span data-line="4485">
</span><span data-line="4486"><span class="sd">        :param initially:</span>
</span><span data-line="4487"><span class="sd">          Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL</span>
</span><span data-line="4488"><span class="sd">          for this constraint.</span>
</span><span data-line="4489">
</span><span data-line="4490"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="4491"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="4492">
</span><span data-line="4493"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4494">
</span><span data-line="4495">        <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLExpressionRole</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">)</span>
</span><span data-line="4496">        <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="4497">        <span class="n">visitors</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">})</span>
</span><span data-line="4498">
</span><span data-line="4499">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4500">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4501">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4502">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4503">            <span class="n">_create_rule</span><span class="o">=</span><span class="n">_create_rule</span><span class="p">,</span>
</span><span data-line="4504">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span data-line="4505">            <span class="n">_type_bound</span><span class="o">=</span><span class="n">_type_bound</span><span class="p">,</span>
</span><span data-line="4506">            <span class="n">_autoattach</span><span class="o">=</span><span class="n">_autoattach</span><span class="p">,</span>
</span><span data-line="4507">            <span class="o">*</span><span class="n">columns</span><span class="p">,</span>
</span><span data-line="4508">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span data-line="4509">        <span class="p">)</span>
</span><span data-line="4510">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4511">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="4512">
</span><span data-line="4513">    <span class="nd">@property</span>
</span><span data-line="4514">    <span class="k">def</span> <span class="nf">is_column_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="4515">        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="4516">
</span><span data-line="4517">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="4518">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="4519">        <span class="s2">&quot;The :meth:`_schema.CheckConstraint.copy` method is deprecated &quot;</span>
</span><span data-line="4520">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="4521">    <span class="p">)</span>
</span><span data-line="4522">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span data-line="4523">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="4524">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CheckConstraint</span><span class="p">:</span>
</span><span data-line="4525">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="4526">
</span><span data-line="4527">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span data-line="4528">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="4529">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CheckConstraint</span><span class="p">:</span>
</span><span data-line="4530">        <span class="k">if</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4531">            <span class="c1"># note that target_table is None for the copy process of</span>
</span><span data-line="4532">            <span class="c1"># a column-bound CheckConstraint, so this path is not reached</span>
</span><span data-line="4533">            <span class="c1"># in that case.</span>
</span><span data-line="4534">            <span class="n">sqltext</span> <span class="o">=</span> <span class="n">_copy_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">target_table</span><span class="p">)</span>
</span><span data-line="4535">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4536">            <span class="n">sqltext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span>
</span><span data-line="4537">        <span class="n">c</span> <span class="o">=</span> <span class="n">CheckConstraint</span><span class="p">(</span>
</span><span data-line="4538">            <span class="n">sqltext</span><span class="p">,</span>
</span><span data-line="4539">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4540">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4541">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4542">            <span class="n">_create_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_rule</span><span class="p">,</span>
</span><span data-line="4543">            <span class="n">table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span>
</span><span data-line="4544">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="4545">            <span class="n">_autoattach</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="4546">            <span class="n">_type_bound</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_bound</span><span class="p">,</span>
</span><span data-line="4547">        <span class="p">)</span>
</span><span data-line="4548">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span data-line="4549">
</span><span data-line="4550">
</span><span data-line="4551"><span class="k">class</span> <span class="nc">ForeignKeyConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span data-line="4552"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level FOREIGN KEY constraint.</span>
</span><span data-line="4553">
</span><span data-line="4554"><span class="sd">    Defines a single column or composite FOREIGN KEY ... REFERENCES</span>
</span><span data-line="4555"><span class="sd">    constraint. For a no-frills, single column foreign key, adding a</span>
</span><span data-line="4556"><span class="sd">    :class:`_schema.ForeignKey` to the definition of a :class:`_schema.Column`</span>
</span><span data-line="4557"><span class="sd">    is a</span>
</span><span data-line="4558"><span class="sd">    shorthand equivalent for an unnamed, single column</span>
</span><span data-line="4559"><span class="sd">    :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="4560">
</span><span data-line="4561"><span class="sd">    Examples of foreign key configuration are in :ref:`metadata_foreignkeys`.</span>
</span><span data-line="4562">
</span><span data-line="4563"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4564">
</span><span data-line="4565">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;foreign_key_constraint&quot;</span>
</span><span data-line="4566">
</span><span data-line="4567">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4568">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4569">        <span class="n">columns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">],</span>
</span><span data-line="4570">        <span class="n">refcolumns</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">_DDLColumnArgument</span><span class="p">],</span>
</span><span data-line="4571">        <span class="n">name</span><span class="p">:</span> <span class="n">_ConstraintNameArgument</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4572">        <span class="n">onupdate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4573">        <span class="n">ondelete</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4574">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4575">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4576">        <span class="n">use_alter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4577">        <span class="n">link_to_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4578">        <span class="n">match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4579">        <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4580">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4581">        <span class="n">comment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4582">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4583">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4584"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct a composite-capable FOREIGN KEY.</span>
</span><span data-line="4585">
</span><span data-line="4586"><span class="sd">        :param columns: A sequence of local column names. The named columns</span>
</span><span data-line="4587"><span class="sd">          must be defined and present in the parent Table. The names should</span>
</span><span data-line="4588"><span class="sd">          match the ``key`` given to each column (defaults to the name) unless</span>
</span><span data-line="4589"><span class="sd">          ``link_to_name`` is True.</span>
</span><span data-line="4590">
</span><span data-line="4591"><span class="sd">        :param refcolumns: A sequence of foreign column names or Column</span>
</span><span data-line="4592"><span class="sd">          objects. The columns must all be located within the same Table.</span>
</span><span data-line="4593">
</span><span data-line="4594"><span class="sd">        :param name: Optional, the in-database name of the key.</span>
</span><span data-line="4595">
</span><span data-line="4596"><span class="sd">        :param onupdate: Optional string. If set, emit ON UPDATE &lt;value&gt; when</span>
</span><span data-line="4597"><span class="sd">          issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span data-line="4598"><span class="sd">          DELETE and RESTRICT.</span>
</span><span data-line="4599">
</span><span data-line="4600"><span class="sd">        :param ondelete: Optional string. If set, emit ON DELETE &lt;value&gt; when</span>
</span><span data-line="4601"><span class="sd">          issuing DDL for this constraint. Typical values include CASCADE,</span>
</span><span data-line="4602"><span class="sd">          DELETE and RESTRICT.</span>
</span><span data-line="4603">
</span><span data-line="4604"><span class="sd">        :param deferrable: Optional bool. If set, emit DEFERRABLE or NOT</span>
</span><span data-line="4605"><span class="sd">          DEFERRABLE when issuing DDL for this constraint.</span>
</span><span data-line="4606">
</span><span data-line="4607"><span class="sd">        :param initially: Optional string. If set, emit INITIALLY &lt;value&gt; when</span>
</span><span data-line="4608"><span class="sd">          issuing DDL for this constraint.</span>
</span><span data-line="4609">
</span><span data-line="4610"><span class="sd">        :param link_to_name: if True, the string name given in ``column`` is</span>
</span><span data-line="4611"><span class="sd">          the rendered name of the referenced column, not its locally assigned</span>
</span><span data-line="4612"><span class="sd">          ``key``.</span>
</span><span data-line="4613">
</span><span data-line="4614"><span class="sd">        :param use_alter: If True, do not emit the DDL for this constraint as</span>
</span><span data-line="4615"><span class="sd">          part of the CREATE TABLE definition. Instead, generate it via an</span>
</span><span data-line="4616"><span class="sd">          ALTER TABLE statement issued after the full collection of tables</span>
</span><span data-line="4617"><span class="sd">          have been created, and drop it via an ALTER TABLE statement before</span>
</span><span data-line="4618"><span class="sd">          the full collection of tables are dropped.</span>
</span><span data-line="4619">
</span><span data-line="4620"><span class="sd">          The use of :paramref:`_schema.ForeignKeyConstraint.use_alter` is</span>
</span><span data-line="4621"><span class="sd">          particularly geared towards the case where two or more tables</span>
</span><span data-line="4622"><span class="sd">          are established within a mutually-dependent foreign key constraint</span>
</span><span data-line="4623"><span class="sd">          relationship; however, the :meth:`_schema.MetaData.create_all` and</span>
</span><span data-line="4624"><span class="sd">          :meth:`_schema.MetaData.drop_all`</span>
</span><span data-line="4625"><span class="sd">          methods will perform this resolution</span>
</span><span data-line="4626"><span class="sd">          automatically, so the flag is normally not needed.</span>
</span><span data-line="4627">
</span><span data-line="4628"><span class="sd">          .. seealso::</span>
</span><span data-line="4629">
</span><span data-line="4630"><span class="sd">                :ref:`use_alter`</span>
</span><span data-line="4631">
</span><span data-line="4632"><span class="sd">        :param match: Optional string. If set, emit MATCH &lt;value&gt; when issuing</span>
</span><span data-line="4633"><span class="sd">          DDL for this constraint. Typical values include SIMPLE, PARTIAL</span>
</span><span data-line="4634"><span class="sd">          and FULL.</span>
</span><span data-line="4635">
</span><span data-line="4636"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="4637"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="4638">
</span><span data-line="4639"><span class="sd">        :param comment: Optional string that will render an SQL comment on</span>
</span><span data-line="4640"><span class="sd">          foreign key constraint creation.</span>
</span><span data-line="4641">
</span><span data-line="4642"><span class="sd">            .. versionadded:: 2.0</span>
</span><span data-line="4643">
</span><span data-line="4644"><span class="sd">        :param \**dialect_kw:  Additional keyword arguments are dialect</span>
</span><span data-line="4645"><span class="sd">          specific, and passed in the form ``&lt;dialectname&gt;_&lt;argname&gt;``.  See</span>
</span><span data-line="4646"><span class="sd">          the documentation regarding an individual dialect at</span>
</span><span data-line="4647"><span class="sd">          :ref:`dialect_toplevel` for detail on documented arguments.</span>
</span><span data-line="4648">
</span><span data-line="4649"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4650">
</span><span data-line="4651">        <span class="n">Constraint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4652">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4653">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4654">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4655">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4656">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span data-line="4657">            <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="4658">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span data-line="4659">        <span class="p">)</span>
</span><span data-line="4660">        <span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span> <span class="o">=</span> <span class="n">onupdate</span>
</span><span data-line="4661">        <span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span> <span class="o">=</span> <span class="n">ondelete</span>
</span><span data-line="4662">        <span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span> <span class="o">=</span> <span class="n">link_to_name</span>
</span><span data-line="4663">        <span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span> <span class="o">=</span> <span class="n">use_alter</span>
</span><span data-line="4664">        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">match</span>
</span><span data-line="4665">
</span><span data-line="4666">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">refcolumns</span><span class="p">):</span>
</span><span data-line="4667">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
</span><span data-line="4668">                <span class="c1"># e.g. FOREIGN KEY (a, a) REFERENCES r (b, c)</span>
</span><span data-line="4669">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="4670">                    <span class="s2">&quot;ForeignKeyConstraint with duplicate source column &quot;</span>
</span><span data-line="4671">                    <span class="s2">&quot;references are not supported.&quot;</span>
</span><span data-line="4672">                <span class="p">)</span>
</span><span data-line="4673">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="4674">                <span class="c1"># e.g. FOREIGN KEY (a) REFERENCES r (b, c)</span>
</span><span data-line="4675">                <span class="c1"># paraphrasing</span>
</span><span data-line="4676">                <span class="c1"># https://www.postgresql.org/docs/current/static/ddl-constraints.html</span>
</span><span data-line="4677">                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="4678">                    <span class="s2">&quot;ForeignKeyConstraint number &quot;</span>
</span><span data-line="4679">                    <span class="s2">&quot;of constrained columns must match the number of &quot;</span>
</span><span data-line="4680">                    <span class="s2">&quot;referenced columns.&quot;</span>
</span><span data-line="4681">                <span class="p">)</span>
</span><span data-line="4682">
</span><span data-line="4683">        <span class="c1"># standalone ForeignKeyConstraint - create</span>
</span><span data-line="4684">        <span class="c1"># associated ForeignKey objects which will be applied to hosted</span>
</span><span data-line="4685">        <span class="c1"># Column objects (in col.foreign_keys), either now or when attached</span>
</span><span data-line="4686">        <span class="c1"># to the Table for string-specified names</span>
</span><span data-line="4687">        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4688">            <span class="n">ForeignKey</span><span class="p">(</span>
</span><span data-line="4689">                <span class="n">refcol</span><span class="p">,</span>
</span><span data-line="4690">                <span class="n">_constraint</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span data-line="4691">                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4692">                <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span data-line="4693">                <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span data-line="4694">                <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span data-line="4695">                <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span data-line="4696">                <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span data-line="4697">                <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4698">                <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4699">                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect_kwargs</span><span class="p">,</span>
</span><span data-line="4700">            <span class="p">)</span>
</span><span data-line="4701">            <span class="k">for</span> <span class="n">refcol</span> <span class="ow">in</span> <span class="n">refcolumns</span>
</span><span data-line="4702">        <span class="p">]</span>
</span><span data-line="4703">
</span><span data-line="4704">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">)</span>
</span><span data-line="4705">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4706">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">):</span>
</span><span data-line="4707">                <span class="k">assert</span> <span class="n">table</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
</span><span data-line="4708">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="4709">
</span><span data-line="4710">    <span class="k">def</span> <span class="nf">_append_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">fk</span><span class="p">:</span> <span class="n">ForeignKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4711">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span><span data-line="4712">        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fk</span><span class="p">)</span>
</span><span data-line="4713">
</span><span data-line="4714">    <span class="n">columns</span><span class="p">:</span> <span class="n">ReadOnlyColumnCollection</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="4715"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A :class:`_expression.ColumnCollection` representing the set of columns</span>
</span><span data-line="4716"><span class="sd">    for this constraint.</span>
</span><span data-line="4717">
</span><span data-line="4718"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4719">
</span><span data-line="4720">    <span class="n">elements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]</span>
</span><span data-line="4721"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A sequence of :class:`_schema.ForeignKey` objects.</span>
</span><span data-line="4722">
</span><span data-line="4723"><span class="sd">    Each :class:`_schema.ForeignKey`</span>
</span><span data-line="4724"><span class="sd">    represents a single referring column/referred</span>
</span><span data-line="4725"><span class="sd">    column pair.</span>
</span><span data-line="4726">
</span><span data-line="4727"><span class="sd">    This collection is intended to be read-only.</span>
</span><span data-line="4728">
</span><span data-line="4729"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4730">
</span><span data-line="4731">    <span class="nd">@property</span>
</span><span data-line="4732">    <span class="k">def</span> <span class="nf">_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">]:</span>
</span><span data-line="4733">        <span class="c1"># legacy - provide a dictionary view of (column_key, fk)</span>
</span><span data-line="4734">        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span>
</span><span data-line="4735">
</span><span data-line="4736">    <span class="nd">@property</span>
</span><span data-line="4737">    <span class="k">def</span> <span class="nf">_referred_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="4738">        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
</span><span data-line="4739">            <span class="k">return</span> <span class="n">elem</span><span class="o">.</span><span class="n">_referred_schema</span>
</span><span data-line="4740">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4741">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="4742">
</span><span data-line="4743">    <span class="nd">@property</span>
</span><span data-line="4744">    <span class="k">def</span> <span class="nf">referred_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
</span><span data-line="4745"><span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`_schema.Table` object to which this</span>
</span><span data-line="4746"><span class="sd">        :class:`_schema.ForeignKeyConstraint` references.</span>
</span><span data-line="4747">
</span><span data-line="4748"><span class="sd">        This is a dynamically calculated attribute which may not be available</span>
</span><span data-line="4749"><span class="sd">        if the constraint and/or parent table is not yet associated with</span>
</span><span data-line="4750"><span class="sd">        a metadata collection that contains the referred table.</span>
</span><span data-line="4751">
</span><span data-line="4752"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4753">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span>
</span><span data-line="4754">
</span><span data-line="4755">    <span class="k">def</span> <span class="nf">_validate_dest_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4756">        <span class="n">table_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">_table_key</span><span class="p">()</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">}</span>
</span><span data-line="4757">        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table_keys</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="4758">            <span class="n">elem0</span><span class="p">,</span> <span class="n">elem1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">table_keys</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span data-line="4759">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="4760">                <span class="sa">f</span><span class="s2">&quot;ForeignKeyConstraint on &quot;</span>
</span><span data-line="4761">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">fullname</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_description</span><span class="si">}</span><span class="s2">) refers to &quot;</span>
</span><span data-line="4762">                <span class="sa">f</span><span class="s2">&quot;multiple remote tables: </span><span class="si">{</span><span class="n">elem0</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">elem1</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="4763">            <span class="p">)</span>
</span><span data-line="4764">
</span><span data-line="4765">    <span class="nd">@property</span>
</span><span data-line="4766">    <span class="k">def</span> <span class="nf">column_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="4767"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of string keys representing the local</span>
</span><span data-line="4768"><span class="sd">        columns in this :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="4769">
</span><span data-line="4770"><span class="sd">        This list is either the original string arguments sent</span>
</span><span data-line="4771"><span class="sd">        to the constructor of the :class:`_schema.ForeignKeyConstraint`,</span>
</span><span data-line="4772"><span class="sd">        or if the constraint has been initialized with :class:`_schema.Column`</span>
</span><span data-line="4773"><span class="sd">        objects, is the string ``.key`` of each element.</span>
</span><span data-line="4774">
</span><span data-line="4775"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4776">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">):</span>
</span><span data-line="4777">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span data-line="4778">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="4779">            <span class="k">return</span> <span class="p">[</span>
</span><span data-line="4780">                <span class="n">col</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span data-line="4781">                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_colargs</span>
</span><span data-line="4782">            <span class="p">]</span>
</span><span data-line="4783">
</span><span data-line="4784">    <span class="nd">@property</span>
</span><span data-line="4785">    <span class="k">def</span> <span class="nf">_col_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="4786">        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_keys</span><span class="p">)</span>
</span><span data-line="4787">
</span><span data-line="4788">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4789">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="4790">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="4791">        <span class="n">Constraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="4792">
</span><span data-line="4793">        <span class="n">ColumnCollectionConstraint</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="4794">
</span><span data-line="4795">        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">fk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
</span><span data-line="4796">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fk</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">col</span><span class="p">:</span>
</span><span data-line="4797">                <span class="n">fk</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span data-line="4798">
</span><span data-line="4799">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dest_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="4800">
</span><span data-line="4801">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="4802">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="4803">        <span class="s2">&quot;The :meth:`_schema.ForeignKeyConstraint.copy` method is deprecated &quot;</span>
</span><span data-line="4804">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="4805">    <span class="p">)</span>
</span><span data-line="4806">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span data-line="4807">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4808">        <span class="o">*</span><span class="p">,</span>
</span><span data-line="4809">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4810">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4811">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4812">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKeyConstraint</span><span class="p">:</span>
</span><span data-line="4813">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span> <span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="4814">
</span><span data-line="4815">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span data-line="4816">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4817">        <span class="o">*</span><span class="p">,</span>
</span><span data-line="4818">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4819">        <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4820">        <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4821">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForeignKeyConstraint</span><span class="p">:</span>
</span><span data-line="4822">        <span class="n">fkc</span> <span class="o">=</span> <span class="n">ForeignKeyConstraint</span><span class="p">(</span>
</span><span data-line="4823">            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">],</span>
</span><span data-line="4824">            <span class="p">[</span>
</span><span data-line="4825">                <span class="n">x</span><span class="o">.</span><span class="n">_get_colspec</span><span class="p">(</span>
</span><span data-line="4826">                    <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span data-line="4827">                    <span class="n">table_name</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="4828">                        <span class="n">target_table</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="4829">                        <span class="k">if</span> <span class="n">target_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="4830">                        <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">_table_key</span><span class="p">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="4831">                        <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="4832">                    <span class="p">),</span>
</span><span data-line="4833">                    <span class="n">_is_copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="4834">                <span class="p">)</span>
</span><span data-line="4835">                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>
</span><span data-line="4836">            <span class="p">],</span>
</span><span data-line="4837">            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4838">            <span class="n">onupdate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onupdate</span><span class="p">,</span>
</span><span data-line="4839">            <span class="n">ondelete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ondelete</span><span class="p">,</span>
</span><span data-line="4840">            <span class="n">use_alter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_alter</span><span class="p">,</span>
</span><span data-line="4841">            <span class="n">deferrable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4842">            <span class="n">initially</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4843">            <span class="n">link_to_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">link_to_name</span><span class="p">,</span>
</span><span data-line="4844">            <span class="n">match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
</span><span data-line="4845">            <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
</span><span data-line="4846">        <span class="p">)</span>
</span><span data-line="4847">        <span class="k">for</span> <span class="n">self_fk</span><span class="p">,</span> <span class="n">other_fk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span> <span class="n">fkc</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
</span><span data-line="4848">            <span class="n">self_fk</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">other_fk</span><span class="p">)</span>
</span><span data-line="4849">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">fkc</span><span class="p">)</span>
</span><span data-line="4850">
</span><span data-line="4851">
</span><span data-line="4852"><span class="k">class</span> <span class="nc">PrimaryKeyConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span data-line="4853"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level PRIMARY KEY constraint.</span>
</span><span data-line="4854">
</span><span data-line="4855"><span class="sd">    The :class:`.PrimaryKeyConstraint` object is present automatically</span>
</span><span data-line="4856"><span class="sd">    on any :class:`_schema.Table` object; it is assigned a set of</span>
</span><span data-line="4857"><span class="sd">    :class:`_schema.Column` objects corresponding to those marked with</span>
</span><span data-line="4858"><span class="sd">    the :paramref:`_schema.Column.primary_key` flag::</span>
</span><span data-line="4859">
</span><span data-line="4860"><span class="sd">        &gt;&gt;&gt; my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span data-line="4861"><span class="sd">        ...                 Column(&#39;id&#39;, Integer, primary_key=True),</span>
</span><span data-line="4862"><span class="sd">        ...                 Column(&#39;version_id&#39;, Integer, primary_key=True),</span>
</span><span data-line="4863"><span class="sd">        ...                 Column(&#39;data&#39;, String(50))</span>
</span><span data-line="4864"><span class="sd">        ...     )</span>
</span><span data-line="4865"><span class="sd">        &gt;&gt;&gt; my_table.primary_key</span>
</span><span data-line="4866"><span class="sd">        PrimaryKeyConstraint(</span>
</span><span data-line="4867"><span class="sd">            Column(&#39;id&#39;, Integer(), table=&lt;mytable&gt;,</span>
</span><span data-line="4868"><span class="sd">                   primary_key=True, nullable=False),</span>
</span><span data-line="4869"><span class="sd">            Column(&#39;version_id&#39;, Integer(), table=&lt;mytable&gt;,</span>
</span><span data-line="4870"><span class="sd">                   primary_key=True, nullable=False)</span>
</span><span data-line="4871"><span class="sd">        )</span>
</span><span data-line="4872">
</span><span data-line="4873"><span class="sd">    The primary key of a :class:`_schema.Table` can also be specified by using</span>
</span><span data-line="4874"><span class="sd">    a :class:`.PrimaryKeyConstraint` object explicitly; in this mode of usage,</span>
</span><span data-line="4875"><span class="sd">    the &quot;name&quot; of the constraint can also be specified, as well as other</span>
</span><span data-line="4876"><span class="sd">    options which may be recognized by dialects::</span>
</span><span data-line="4877">
</span><span data-line="4878"><span class="sd">        my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span data-line="4879"><span class="sd">                    Column(&#39;id&#39;, Integer),</span>
</span><span data-line="4880"><span class="sd">                    Column(&#39;version_id&#39;, Integer),</span>
</span><span data-line="4881"><span class="sd">                    Column(&#39;data&#39;, String(50)),</span>
</span><span data-line="4882"><span class="sd">                    PrimaryKeyConstraint(&#39;id&#39;, &#39;version_id&#39;,</span>
</span><span data-line="4883"><span class="sd">                                         name=&#39;mytable_pk&#39;)</span>
</span><span data-line="4884"><span class="sd">                )</span>
</span><span data-line="4885">
</span><span data-line="4886"><span class="sd">    The two styles of column-specification should generally not be mixed.</span>
</span><span data-line="4887"><span class="sd">    An warning is emitted if the columns present in the</span>
</span><span data-line="4888"><span class="sd">    :class:`.PrimaryKeyConstraint`</span>
</span><span data-line="4889"><span class="sd">    don&#39;t match the columns that were marked as ``primary_key=True``, if both</span>
</span><span data-line="4890"><span class="sd">    are present; in this case, the columns are taken strictly from the</span>
</span><span data-line="4891"><span class="sd">    :class:`.PrimaryKeyConstraint` declaration, and those columns otherwise</span>
</span><span data-line="4892"><span class="sd">    marked as ``primary_key=True`` are ignored.  This behavior is intended to</span>
</span><span data-line="4893"><span class="sd">    be backwards compatible with previous behavior.</span>
</span><span data-line="4894">
</span><span data-line="4895"><span class="sd">    For the use case where specific options are to be specified on the</span>
</span><span data-line="4896"><span class="sd">    :class:`.PrimaryKeyConstraint`, but the usual style of using</span>
</span><span data-line="4897"><span class="sd">    ``primary_key=True`` flags is still desirable, an empty</span>
</span><span data-line="4898"><span class="sd">    :class:`.PrimaryKeyConstraint` may be specified, which will take on the</span>
</span><span data-line="4899"><span class="sd">    primary key column collection from the :class:`_schema.Table` based on the</span>
</span><span data-line="4900"><span class="sd">    flags::</span>
</span><span data-line="4901">
</span><span data-line="4902"><span class="sd">        my_table = Table(&#39;mytable&#39;, metadata,</span>
</span><span data-line="4903"><span class="sd">                    Column(&#39;id&#39;, Integer, primary_key=True),</span>
</span><span data-line="4904"><span class="sd">                    Column(&#39;version_id&#39;, Integer, primary_key=True),</span>
</span><span data-line="4905"><span class="sd">                    Column(&#39;data&#39;, String(50)),</span>
</span><span data-line="4906"><span class="sd">                    PrimaryKeyConstraint(name=&#39;mytable_pk&#39;,</span>
</span><span data-line="4907"><span class="sd">                                         mssql_clustered=True)</span>
</span><span data-line="4908"><span class="sd">                )</span>
</span><span data-line="4909">
</span><span data-line="4910"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="4911">
</span><span data-line="4912">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;primary_key_constraint&quot;</span>
</span><span data-line="4913">
</span><span data-line="4914">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4915">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="4916">        <span class="o">*</span><span class="n">columns</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span data-line="4917">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4918">        <span class="n">deferrable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4919">        <span class="n">initially</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4920">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="4921">        <span class="n">_implicit_generated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="4922">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="4923">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4924">        <span class="bp">self</span><span class="o">.</span><span class="n">_implicit_generated</span> <span class="o">=</span> <span class="n">_implicit_generated</span>
</span><span data-line="4925">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="4926">            <span class="o">*</span><span class="n">columns</span><span class="p">,</span>
</span><span data-line="4927">            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span data-line="4928">            <span class="n">deferrable</span><span class="o">=</span><span class="n">deferrable</span><span class="p">,</span>
</span><span data-line="4929">            <span class="n">initially</span><span class="o">=</span><span class="n">initially</span><span class="p">,</span>
</span><span data-line="4930">            <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
</span><span data-line="4931">            <span class="o">**</span><span class="n">dialect_kw</span><span class="p">,</span>
</span><span data-line="4932">        <span class="p">)</span>
</span><span data-line="4933">
</span><span data-line="4934">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4935">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="4936">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="4937">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="4938">
</span><span data-line="4939">        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
</span><span data-line="4940">            <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">)</span>
</span><span data-line="4941">            <span class="n">table</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># type: ignore</span>
</span><span data-line="4942">            <span class="n">table</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="4943">
</span><span data-line="4944">        <span class="n">table_pks</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">primary_key</span><span class="p">]</span>
</span><span data-line="4945">        <span class="k">if</span> <span class="p">(</span>
</span><span data-line="4946">            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span>
</span><span data-line="4947">            <span class="ow">and</span> <span class="n">table_pks</span>
</span><span data-line="4948">            <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">table_pks</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span data-line="4949">        <span class="p">):</span>
</span><span data-line="4950">            <span class="c1"># black could not format these inline</span>
</span><span data-line="4951">            <span class="n">table_pk_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table_pks</span><span class="p">)</span>
</span><span data-line="4952">            <span class="n">col_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span data-line="4953">
</span><span data-line="4954">            <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span data-line="4955">                <span class="sa">f</span><span class="s2">&quot;Table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; specifies columns &quot;</span>
</span><span data-line="4956">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_pk_str</span><span class="si">}</span><span class="s2"> as &quot;</span>
</span><span data-line="4957">                <span class="sa">f</span><span class="s2">&quot;primary_key=True, &quot;</span>
</span><span data-line="4958">                <span class="sa">f</span><span class="s2">&quot;not matching locally specified columns </span><span class="si">{</span><span class="n">col_str</span><span class="si">}</span><span class="s2">; &quot;</span>
</span><span data-line="4959">                <span class="sa">f</span><span class="s2">&quot;setting the &quot;</span>
</span><span data-line="4960">                <span class="sa">f</span><span class="s2">&quot;current primary key columns to &quot;</span>
</span><span data-line="4961">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col_str</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span data-line="4962">                <span class="sa">f</span><span class="s2">&quot;This warning &quot;</span>
</span><span data-line="4963">                <span class="sa">f</span><span class="s2">&quot;may become an exception in a future release&quot;</span>
</span><span data-line="4964">            <span class="p">)</span>
</span><span data-line="4965">            <span class="n">table_pks</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="4966">
</span><span data-line="4967">        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span data-line="4968">            <span class="n">c</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="4969">            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span data-line="4970">                <span class="n">c</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="4971">        <span class="k">if</span> <span class="n">table_pks</span><span class="p">:</span>
</span><span data-line="4972">            <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">table_pks</span><span class="p">)</span>
</span><span data-line="4973">
</span><span data-line="4974">    <span class="k">def</span> <span class="nf">_reload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="4975"><span class="w">        </span><span class="sd">&quot;&quot;&quot;repopulate this :class:`.PrimaryKeyConstraint` given</span>
</span><span data-line="4976"><span class="sd">        a set of columns.</span>
</span><span data-line="4977">
</span><span data-line="4978"><span class="sd">        Existing columns in the table that are marked as primary_key=True</span>
</span><span data-line="4979"><span class="sd">        are maintained.</span>
</span><span data-line="4980">
</span><span data-line="4981"><span class="sd">        Also fires a new event.</span>
</span><span data-line="4982">
</span><span data-line="4983"><span class="sd">        This is basically like putting a whole new</span>
</span><span data-line="4984"><span class="sd">        :class:`.PrimaryKeyConstraint` object on the parent</span>
</span><span data-line="4985"><span class="sd">        :class:`_schema.Table` object without actually replacing the object.</span>
</span><span data-line="4986">
</span><span data-line="4987"><span class="sd">        The ordering of the given list of columns is also maintained; these</span>
</span><span data-line="4988"><span class="sd">        columns will be appended to the list of columns after any which</span>
</span><span data-line="4989"><span class="sd">        are already present.</span>
</span><span data-line="4990">
</span><span data-line="4991"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="4992">        <span class="c1"># set the primary key flag on new columns.</span>
</span><span data-line="4993">        <span class="c1"># note any existing PK cols on the table also have their</span>
</span><span data-line="4994">        <span class="c1"># flag still set.</span>
</span><span data-line="4995">        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
</span><span data-line="4996">            <span class="n">col</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="4997">
</span><span data-line="4998">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
</span><span data-line="4999">
</span><span data-line="5000">        <span class="n">PrimaryKeyConstraint</span><span class="o">.</span><span class="n">_autoincrement_column</span><span class="o">.</span><span class="n">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="5001">        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent_with_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="5002">
</span><span data-line="5003">    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5004">        <span class="n">PrimaryKeyConstraint</span><span class="o">.</span><span class="n">_autoincrement_column</span><span class="o">.</span><span class="n">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="5005">        <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</span><span data-line="5006">
</span><span data-line="5007">        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="o">.</span><span class="n">_sa_event_column_added_to_pk_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</span><span data-line="5008">
</span><span data-line="5009">    <span class="nd">@property</span>
</span><span data-line="5010">    <span class="k">def</span> <span class="nf">columns_autoinc_first</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
</span><span data-line="5011">        <span class="n">autoinc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoincrement_column</span>
</span><span data-line="5012">
</span><span data-line="5013">        <span class="k">if</span> <span class="n">autoinc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5014">            <span class="k">return</span> <span class="p">[</span><span class="n">autoinc</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">autoinc</span><span class="p">]</span>
</span><span data-line="5015">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="5016">            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span>
</span><span data-line="5017">
</span><span data-line="5018">    <span class="nd">@util</span><span class="o">.</span><span class="n">ro_memoized_property</span>
</span><span data-line="5019">    <span class="k">def</span> <span class="nf">_autoincrement_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span data-line="5020">        <span class="k">def</span> <span class="nf">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">:</span> <span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">autoinc_true</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="5021">            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_type_affinity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span>
</span><span data-line="5022">                <span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span data-line="5023">                <span class="p">(</span>
</span><span data-line="5024">                    <span class="n">type_api</span><span class="o">.</span><span class="n">INTEGERTYPE</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span data-line="5025">                    <span class="n">type_api</span><span class="o">.</span><span class="n">NUMERICTYPE</span><span class="o">.</span><span class="n">_type_affinity</span><span class="p">,</span>
</span><span data-line="5026">                <span class="p">),</span>
</span><span data-line="5027">            <span class="p">):</span>
</span><span data-line="5028">                <span class="k">if</span> <span class="n">autoinc_true</span><span class="p">:</span>
</span><span data-line="5029">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="5030">                        <span class="sa">f</span><span class="s2">&quot;Column type </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> on column &#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&#39; is not &quot;</span>
</span><span data-line="5031">                        <span class="sa">f</span><span class="s2">&quot;compatible with autoincrement=True&quot;</span>
</span><span data-line="5032">                    <span class="p">)</span>
</span><span data-line="5033">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="5034">                    <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="5035">            <span class="k">elif</span> <span class="p">(</span>
</span><span data-line="5036">                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Sequence</span><span class="p">))</span>
</span><span data-line="5037">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">autoinc_true</span>
</span><span data-line="5038">            <span class="p">):</span>
</span><span data-line="5039">                <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="5040">            <span class="k">elif</span> <span class="p">(</span>
</span><span data-line="5041">                <span class="n">col</span><span class="o">.</span><span class="n">server_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="5042">                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="n">Identity</span><span class="p">)</span>
</span><span data-line="5043">                <span class="ow">and</span> <span class="ow">not</span> <span class="n">autoinc_true</span>
</span><span data-line="5044">            <span class="p">):</span>
</span><span data-line="5045">                <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="5046">            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="ow">and</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
</span><span data-line="5047">                <span class="kc">True</span><span class="p">,</span>
</span><span data-line="5048">                <span class="s2">&quot;ignore_fk&quot;</span><span class="p">,</span>
</span><span data-line="5049">            <span class="p">):</span>
</span><span data-line="5050">                <span class="k">return</span> <span class="kc">False</span>
</span><span data-line="5051">            <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="5052">
</span><span data-line="5053">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="5054">            <span class="n">col</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="5055">
</span><span data-line="5056">            <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span data-line="5057">                <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span data-line="5058">                <span class="k">return</span> <span class="n">col</span>
</span><span data-line="5059">            <span class="k">elif</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">in</span> <span class="p">(</span>
</span><span data-line="5060">                <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span data-line="5061">                <span class="s2">&quot;ignore_fk&quot;</span><span class="p">,</span>
</span><span data-line="5062">            <span class="p">)</span> <span class="ow">and</span> <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span><span data-line="5063">                <span class="k">return</span> <span class="n">col</span>
</span><span data-line="5064">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="5065">                <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="5066">
</span><span data-line="5067">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="5068">            <span class="n">autoinc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="5069">            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_columns</span><span class="p">:</span>
</span><span data-line="5070">                <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span data-line="5071">                    <span class="n">_validate_autoinc</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span data-line="5072">                    <span class="k">if</span> <span class="n">autoinc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5073">                        <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="5074">                            <span class="sa">f</span><span class="s2">&quot;Only one Column may be marked &quot;</span>
</span><span data-line="5075">                            <span class="sa">f</span><span class="s2">&quot;autoincrement=True, found both &quot;</span>
</span><span data-line="5076">                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">autoinc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span data-line="5077">                        <span class="p">)</span>
</span><span data-line="5078">                    <span class="k">else</span><span class="p">:</span>
</span><span data-line="5079">                        <span class="n">autoinc</span> <span class="o">=</span> <span class="n">col</span>
</span><span data-line="5080">
</span><span data-line="5081">            <span class="k">return</span> <span class="n">autoinc</span>
</span><span data-line="5082">
</span><span data-line="5083">
</span><span data-line="5084"><span class="k">class</span> <span class="nc">UniqueConstraint</span><span class="p">(</span><span class="n">ColumnCollectionConstraint</span><span class="p">):</span>
</span><span data-line="5085"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level UNIQUE constraint.</span>
</span><span data-line="5086">
</span><span data-line="5087"><span class="sd">    Defines a single column or composite UNIQUE constraint. For a no-frills,</span>
</span><span data-line="5088"><span class="sd">    single column constraint, adding ``unique=True`` to the ``Column``</span>
</span><span data-line="5089"><span class="sd">    definition is a shorthand equivalent for an unnamed, single column</span>
</span><span data-line="5090"><span class="sd">    UniqueConstraint.</span>
</span><span data-line="5091"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="5092">
</span><span data-line="5093">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;unique_constraint&quot;</span>
</span><span data-line="5094">
</span><span data-line="5095">
</span><span data-line="5096"><span class="k">class</span> <span class="nc">Index</span><span class="p">(</span>
</span><span data-line="5097">    <span class="n">DialectKWArgs</span><span class="p">,</span> <span class="n">ColumnCollectionMixin</span><span class="p">,</span> <span class="n">HasConditionalDDL</span><span class="p">,</span> <span class="n">SchemaItem</span>
</span><span data-line="5098"><span class="p">):</span>
</span><span data-line="5099"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A table-level INDEX.</span>
</span><span data-line="5100">
</span><span data-line="5101"><span class="sd">    Defines a composite (one or more column) INDEX.</span>
</span><span data-line="5102">
</span><span data-line="5103"><span class="sd">    E.g.::</span>
</span><span data-line="5104">
</span><span data-line="5105"><span class="sd">        sometable = Table(&quot;sometable&quot;, metadata,</span>
</span><span data-line="5106"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span data-line="5107"><span class="sd">                        Column(&quot;address&quot;, String(100))</span>
</span><span data-line="5108"><span class="sd">                    )</span>
</span><span data-line="5109">
</span><span data-line="5110"><span class="sd">        Index(&quot;some_index&quot;, sometable.c.name)</span>
</span><span data-line="5111">
</span><span data-line="5112"><span class="sd">    For a no-frills, single column index, adding</span>
</span><span data-line="5113"><span class="sd">    :class:`_schema.Column` also supports ``index=True``::</span>
</span><span data-line="5114">
</span><span data-line="5115"><span class="sd">        sometable = Table(&quot;sometable&quot;, metadata,</span>
</span><span data-line="5116"><span class="sd">                        Column(&quot;name&quot;, String(50), index=True)</span>
</span><span data-line="5117"><span class="sd">                    )</span>
</span><span data-line="5118">
</span><span data-line="5119"><span class="sd">    For a composite index, multiple columns can be specified::</span>
</span><span data-line="5120">
</span><span data-line="5121"><span class="sd">        Index(&quot;some_index&quot;, sometable.c.name, sometable.c.address)</span>
</span><span data-line="5122">
</span><span data-line="5123"><span class="sd">    Functional indexes are supported as well, typically by using the</span>
</span><span data-line="5124"><span class="sd">    :data:`.func` construct in conjunction with table-bound</span>
</span><span data-line="5125"><span class="sd">    :class:`_schema.Column` objects::</span>
</span><span data-line="5126">
</span><span data-line="5127"><span class="sd">        Index(&quot;some_index&quot;, func.lower(sometable.c.name))</span>
</span><span data-line="5128">
</span><span data-line="5129"><span class="sd">    An :class:`.Index` can also be manually associated with a</span>
</span><span data-line="5130"><span class="sd">    :class:`_schema.Table`,</span>
</span><span data-line="5131"><span class="sd">    either through inline declaration or using</span>
</span><span data-line="5132"><span class="sd">    :meth:`_schema.Table.append_constraint`.  When this approach is used,</span>
</span><span data-line="5133"><span class="sd">    the names</span>
</span><span data-line="5134"><span class="sd">    of the indexed columns can be specified as strings::</span>
</span><span data-line="5135">
</span><span data-line="5136"><span class="sd">        Table(&quot;sometable&quot;, metadata,</span>
</span><span data-line="5137"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span data-line="5138"><span class="sd">                        Column(&quot;address&quot;, String(100)),</span>
</span><span data-line="5139"><span class="sd">                        Index(&quot;some_index&quot;, &quot;name&quot;, &quot;address&quot;)</span>
</span><span data-line="5140"><span class="sd">                )</span>
</span><span data-line="5141">
</span><span data-line="5142"><span class="sd">    To support functional or expression-based indexes in this form, the</span>
</span><span data-line="5143"><span class="sd">    :func:`_expression.text` construct may be used::</span>
</span><span data-line="5144">
</span><span data-line="5145"><span class="sd">        from sqlalchemy import text</span>
</span><span data-line="5146">
</span><span data-line="5147"><span class="sd">        Table(&quot;sometable&quot;, metadata,</span>
</span><span data-line="5148"><span class="sd">                        Column(&quot;name&quot;, String(50)),</span>
</span><span data-line="5149"><span class="sd">                        Column(&quot;address&quot;, String(100)),</span>
</span><span data-line="5150"><span class="sd">                        Index(&quot;some_index&quot;, text(&quot;lower(name)&quot;))</span>
</span><span data-line="5151"><span class="sd">                )</span>
</span><span data-line="5152">
</span><span data-line="5153"><span class="sd">    .. seealso::</span>
</span><span data-line="5154">
</span><span data-line="5155"><span class="sd">        :ref:`schema_indexes` - General information on :class:`.Index`.</span>
</span><span data-line="5156">
</span><span data-line="5157"><span class="sd">        :ref:`postgresql_indexes` - PostgreSQL-specific options available for</span>
</span><span data-line="5158"><span class="sd">        the :class:`.Index` construct.</span>
</span><span data-line="5159">
</span><span data-line="5160"><span class="sd">        :ref:`mysql_indexes` - MySQL-specific options available for the</span>
</span><span data-line="5161"><span class="sd">        :class:`.Index` construct.</span>
</span><span data-line="5162">
</span><span data-line="5163"><span class="sd">        :ref:`mssql_indexes` - MSSQL-specific options available for the</span>
</span><span data-line="5164"><span class="sd">        :class:`.Index` construct.</span>
</span><span data-line="5165">
</span><span data-line="5166"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="5167">
</span><span data-line="5168">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
</span><span data-line="5169">
</span><span data-line="5170">    <span class="n">table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
</span><span data-line="5171">    <span class="n">expressions</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span>
</span><span data-line="5172">    <span class="n">_table_bound_expressions</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">ColumnElement</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="5173">
</span><span data-line="5174">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="5175">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5176">        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span data-line="5177">        <span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span>
</span><span data-line="5178">        <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="5179">        <span class="n">quote</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5180">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5181">        <span class="n">_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5182">        <span class="n">_column_flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="5183">        <span class="o">**</span><span class="n">dialect_kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="5184">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5185"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Construct an index object.</span>
</span><span data-line="5186">
</span><span data-line="5187"><span class="sd">        :param name:</span>
</span><span data-line="5188"><span class="sd">          The name of the index</span>
</span><span data-line="5189">
</span><span data-line="5190"><span class="sd">        :param \*expressions:</span>
</span><span data-line="5191"><span class="sd">          Column expressions to include in the index.   The expressions</span>
</span><span data-line="5192"><span class="sd">          are normally instances of :class:`_schema.Column`, but may also</span>
</span><span data-line="5193"><span class="sd">          be arbitrary SQL expressions which ultimately refer to a</span>
</span><span data-line="5194"><span class="sd">          :class:`_schema.Column`.</span>
</span><span data-line="5195">
</span><span data-line="5196"><span class="sd">        :param unique=False:</span>
</span><span data-line="5197"><span class="sd">            Keyword only argument; if True, create a unique index.</span>
</span><span data-line="5198">
</span><span data-line="5199"><span class="sd">        :param quote=None:</span>
</span><span data-line="5200"><span class="sd">            Keyword only argument; whether to apply quoting to the name of</span>
</span><span data-line="5201"><span class="sd">            the index.  Works in the same manner as that of</span>
</span><span data-line="5202"><span class="sd">            :paramref:`_schema.Column.quote`.</span>
</span><span data-line="5203">
</span><span data-line="5204"><span class="sd">        :param info=None: Optional data dictionary which will be populated</span>
</span><span data-line="5205"><span class="sd">            into the :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="5206">
</span><span data-line="5207"><span class="sd">        :param \**dialect_kw: Additional keyword arguments not mentioned above</span>
</span><span data-line="5208"><span class="sd">            are dialect specific, and passed in the form</span>
</span><span data-line="5209"><span class="sd">            ``&lt;dialectname&gt;_&lt;argname&gt;``. See the documentation regarding an</span>
</span><span data-line="5210"><span class="sd">            individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span data-line="5211"><span class="sd">            documented arguments.</span>
</span><span data-line="5212">
</span><span data-line="5213"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5214">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="5215">
</span><span data-line="5216">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">quote</span><span class="p">)</span>
</span><span data-line="5217">        <span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="n">unique</span>
</span><span data-line="5218">        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5219">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="5220">
</span><span data-line="5221">        <span class="c1"># TODO: consider &quot;table&quot; argument being public, but for</span>
</span><span data-line="5222">        <span class="c1"># the purpose of the fix here, it starts as private.</span>
</span><span data-line="5223">        <span class="k">if</span> <span class="n">_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5224">            <span class="n">table</span> <span class="o">=</span> <span class="n">_table</span>
</span><span data-line="5225">
</span><span data-line="5226">        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect_kwargs</span><span class="p">(</span><span class="n">dialect_kw</span><span class="p">)</span>
</span><span data-line="5227">
</span><span data-line="5228">        <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="5229">        <span class="c1"># will call _set_parent() if table-bound column</span>
</span><span data-line="5230">        <span class="c1"># objects are present</span>
</span><span data-line="5231">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="5232">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5233">            <span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span data-line="5234">            <span class="n">_column_flag</span><span class="o">=</span><span class="n">_column_flag</span><span class="p">,</span>
</span><span data-line="5235">            <span class="n">_gather_expressions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">,</span>
</span><span data-line="5236">        <span class="p">)</span>
</span><span data-line="5237">        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5238">            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="5239">
</span><span data-line="5240">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5241">        <span class="n">table</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="5242">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">)</span>
</span><span data-line="5243">        <span class="n">ColumnCollectionMixin</span><span class="o">.</span><span class="n">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="5244">
</span><span data-line="5245">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
</span><span data-line="5246">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="5247">                <span class="sa">f</span><span class="s2">&quot;Index &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is against table &quot;</span>
</span><span data-line="5248">                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;, and &quot;</span>
</span><span data-line="5249">                <span class="sa">f</span><span class="s2">&quot;cannot be associated with table &#39;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span data-line="5250">            <span class="p">)</span>
</span><span data-line="5251">        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">table</span>
</span><span data-line="5252">        <span class="n">table</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="5253">
</span><span data-line="5254">        <span class="n">expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span>
</span><span data-line="5255">        <span class="n">col_expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_expressions</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span data-line="5256">        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">expressions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_expressions</span><span class="p">)</span>
</span><span data-line="5257">
</span><span data-line="5258">        <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="5259">        <span class="k">for</span> <span class="n">expr</span><span class="p">,</span> <span class="n">colexpr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expressions</span><span class="p">,</span> <span class="n">col_expressions</span><span class="p">):</span>
</span><span data-line="5260">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ClauseElement</span><span class="p">):</span>
</span><span data-line="5261">                <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</span><span data-line="5262">            <span class="k">elif</span> <span class="n">colexpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5263">                <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colexpr</span><span class="p">)</span>
</span><span data-line="5264">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="5265">                <span class="k">assert</span> <span class="kc">False</span>
</span><span data-line="5266">        <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_bound_expressions</span> <span class="o">=</span> <span class="n">exprs</span>
</span><span data-line="5267">
</span><span data-line="5268">    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5269"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``CREATE`` statement for this</span>
</span><span data-line="5270"><span class="sd">        :class:`.Index`, using the given</span>
</span><span data-line="5271"><span class="sd">        :class:`.Connection` or :class:`.Engine`` for connectivity.</span>
</span><span data-line="5272">
</span><span data-line="5273"><span class="sd">        .. seealso::</span>
</span><span data-line="5274">
</span><span data-line="5275"><span class="sd">            :meth:`_schema.MetaData.create_all`.</span>
</span><span data-line="5276">
</span><span data-line="5277"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5278">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="5279">
</span><span data-line="5280">    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span> <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5281"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Issue a ``DROP`` statement for this</span>
</span><span data-line="5282"><span class="sd">        :class:`.Index`, using the given</span>
</span><span data-line="5283"><span class="sd">        :class:`.Connection` or :class:`.Engine` for connectivity.</span>
</span><span data-line="5284">
</span><span data-line="5285"><span class="sd">        .. seealso::</span>
</span><span data-line="5286">
</span><span data-line="5287"><span class="sd">            :meth:`_schema.MetaData.drop_all`.</span>
</span><span data-line="5288">
</span><span data-line="5289"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5290">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span><span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">)</span>
</span><span data-line="5291">
</span><span data-line="5292">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="5293">        <span class="n">exprs</span><span class="p">:</span> <span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>  <span class="c1"># noqa: F842</span>
</span><span data-line="5294">
</span><span data-line="5295">        <span class="k">return</span> <span class="s2">&quot;Index(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
</span><span data-line="5296">            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span data-line="5297">                <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
</span><span data-line="5298">                <span class="o">+</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">]</span>
</span><span data-line="5299">                <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique</span> <span class="ow">and</span> <span class="p">[</span><span class="s2">&quot;unique=True&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[])</span>
</span><span data-line="5300">            <span class="p">)</span>
</span><span data-line="5301">        <span class="p">)</span>
</span><span data-line="5302">
</span><span data-line="5303">
</span><span data-line="5304"><span class="n">_NamingSchemaCallable</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Constraint</span><span class="p">,</span> <span class="n">Table</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span>
</span><span data-line="5305"><span class="n">_NamingSchemaDirective</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_NamingSchemaCallable</span><span class="p">]</span>
</span><span data-line="5306">
</span><span data-line="5307">
</span><span data-line="5308"><span class="k">class</span> <span class="nc">_NamingSchemaTD</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span data-line="5309">    <span class="n">fk</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span data-line="5310">    <span class="n">pk</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span data-line="5311">    <span class="n">ix</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span data-line="5312">    <span class="n">ck</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span data-line="5313">    <span class="n">uq</span><span class="p">:</span> <span class="n">_NamingSchemaDirective</span>
</span><span data-line="5314">
</span><span data-line="5315">
</span><span data-line="5316"><span class="n">_NamingSchemaParameter</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
</span><span data-line="5317">    <span class="c1"># it seems like the TypedDict here is useful for pylance typeahead,</span>
</span><span data-line="5318">    <span class="c1"># and not much else</span>
</span><span data-line="5319">    <span class="n">_NamingSchemaTD</span><span class="p">,</span>
</span><span data-line="5320">    <span class="c1"># there is no form that allows Union[Type[Any], str] to work in all</span>
</span><span data-line="5321">    <span class="c1"># cases, including breaking out Mapping[] entries for each combination</span>
</span><span data-line="5322">    <span class="c1"># even, therefore keys must be `Any` (see #10264)</span>
</span><span data-line="5323">    <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">_NamingSchemaDirective</span><span class="p">],</span>
</span><span data-line="5324"><span class="p">]</span>
</span><span data-line="5325">
</span><span data-line="5326">
</span><span data-line="5327"><span class="n">DEFAULT_NAMING_CONVENTION</span><span class="p">:</span> <span class="n">_NamingSchemaParameter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">immutabledict</span><span class="p">(</span>
</span><span data-line="5328">    <span class="p">{</span><span class="s2">&quot;ix&quot;</span><span class="p">:</span> <span class="s2">&quot;ix_</span><span class="si">%(column_0_label)s</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span data-line="5329"><span class="p">)</span>
</span><span data-line="5330">
</span><span data-line="5331">
</span><span data-line="5332"><span class="k">class</span> <span class="nc">MetaData</span><span class="p">(</span><span class="n">HasSchemaAttr</span><span class="p">):</span>
</span><span data-line="5333"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of :class:`_schema.Table`</span>
</span><span data-line="5334"><span class="sd">    objects and their associated schema</span>
</span><span data-line="5335"><span class="sd">    constructs.</span>
</span><span data-line="5336">
</span><span data-line="5337"><span class="sd">    Holds a collection of :class:`_schema.Table` objects as well as</span>
</span><span data-line="5338"><span class="sd">    an optional binding to an :class:`_engine.Engine` or</span>
</span><span data-line="5339"><span class="sd">    :class:`_engine.Connection`.  If bound, the :class:`_schema.Table` objects</span>
</span><span data-line="5340"><span class="sd">    in the collection and their columns may participate in implicit SQL</span>
</span><span data-line="5341"><span class="sd">    execution.</span>
</span><span data-line="5342">
</span><span data-line="5343"><span class="sd">    The :class:`_schema.Table` objects themselves are stored in the</span>
</span><span data-line="5344"><span class="sd">    :attr:`_schema.MetaData.tables` dictionary.</span>
</span><span data-line="5345">
</span><span data-line="5346"><span class="sd">    :class:`_schema.MetaData` is a thread-safe object for read operations.</span>
</span><span data-line="5347"><span class="sd">    Construction of new tables within a single :class:`_schema.MetaData`</span>
</span><span data-line="5348"><span class="sd">    object,</span>
</span><span data-line="5349"><span class="sd">    either explicitly or via reflection, may not be completely thread-safe.</span>
</span><span data-line="5350">
</span><span data-line="5351"><span class="sd">    .. seealso::</span>
</span><span data-line="5352">
</span><span data-line="5353"><span class="sd">        :ref:`metadata_describing` - Introduction to database metadata</span>
</span><span data-line="5354">
</span><span data-line="5355"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="5356">
</span><span data-line="5357">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;metadata&quot;</span>
</span><span data-line="5358">
</span><span data-line="5359">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="5360">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5361">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5362">        <span class="n">quote_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5363">        <span class="n">naming_convention</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_NamingSchemaParameter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5364">        <span class="n">info</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_InfoType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5365">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5366"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new MetaData object.</span>
</span><span data-line="5367">
</span><span data-line="5368"><span class="sd">        :param schema:</span>
</span><span data-line="5369"><span class="sd">           The default schema to use for the :class:`_schema.Table`,</span>
</span><span data-line="5370"><span class="sd">           :class:`.Sequence`, and potentially other objects associated with</span>
</span><span data-line="5371"><span class="sd">           this :class:`_schema.MetaData`. Defaults to ``None``.</span>
</span><span data-line="5372">
</span><span data-line="5373"><span class="sd">           .. seealso::</span>
</span><span data-line="5374">
</span><span data-line="5375"><span class="sd">                :ref:`schema_metadata_schema_name` - details on how the</span>
</span><span data-line="5376"><span class="sd">                :paramref:`_schema.MetaData.schema` parameter is used.</span>
</span><span data-line="5377">
</span><span data-line="5378"><span class="sd">                :paramref:`_schema.Table.schema`</span>
</span><span data-line="5379">
</span><span data-line="5380"><span class="sd">                :paramref:`.Sequence.schema`</span>
</span><span data-line="5381">
</span><span data-line="5382"><span class="sd">        :param quote_schema:</span>
</span><span data-line="5383"><span class="sd">            Sets the ``quote_schema`` flag for those :class:`_schema.Table`,</span>
</span><span data-line="5384"><span class="sd">            :class:`.Sequence`, and other objects which make usage of the</span>
</span><span data-line="5385"><span class="sd">            local ``schema`` name.</span>
</span><span data-line="5386">
</span><span data-line="5387"><span class="sd">        :param info: Optional data dictionary which will be populated into the</span>
</span><span data-line="5388"><span class="sd">            :attr:`.SchemaItem.info` attribute of this object.</span>
</span><span data-line="5389">
</span><span data-line="5390"><span class="sd">        :param naming_convention: a dictionary referring to values which</span>
</span><span data-line="5391"><span class="sd">          will establish default naming conventions for :class:`.Constraint`</span>
</span><span data-line="5392"><span class="sd">          and :class:`.Index` objects, for those objects which are not given</span>
</span><span data-line="5393"><span class="sd">          a name explicitly.</span>
</span><span data-line="5394">
</span><span data-line="5395"><span class="sd">          The keys of this dictionary may be:</span>
</span><span data-line="5396">
</span><span data-line="5397"><span class="sd">          * a constraint or Index class, e.g. the :class:`.UniqueConstraint`,</span>
</span><span data-line="5398"><span class="sd">            :class:`_schema.ForeignKeyConstraint` class, the :class:`.Index`</span>
</span><span data-line="5399"><span class="sd">            class</span>
</span><span data-line="5400">
</span><span data-line="5401"><span class="sd">          * a string mnemonic for one of the known constraint classes;</span>
</span><span data-line="5402"><span class="sd">            ``&quot;fk&quot;``, ``&quot;pk&quot;``, ``&quot;ix&quot;``, ``&quot;ck&quot;``, ``&quot;uq&quot;`` for foreign key,</span>
</span><span data-line="5403"><span class="sd">            primary key, index, check, and unique constraint, respectively.</span>
</span><span data-line="5404">
</span><span data-line="5405"><span class="sd">          * the string name of a user-defined &quot;token&quot; that can be used</span>
</span><span data-line="5406"><span class="sd">            to define new naming tokens.</span>
</span><span data-line="5407">
</span><span data-line="5408"><span class="sd">          The values associated with each &quot;constraint class&quot; or &quot;constraint</span>
</span><span data-line="5409"><span class="sd">          mnemonic&quot; key are string naming templates, such as</span>
</span><span data-line="5410"><span class="sd">          ``&quot;uq_%(table_name)s_%(column_0_name)s&quot;``,</span>
</span><span data-line="5411"><span class="sd">          which describe how the name should be composed.  The values</span>
</span><span data-line="5412"><span class="sd">          associated with user-defined &quot;token&quot; keys should be callables of the</span>
</span><span data-line="5413"><span class="sd">          form ``fn(constraint, table)``, which accepts the constraint/index</span>
</span><span data-line="5414"><span class="sd">          object and :class:`_schema.Table` as arguments, returning a string</span>
</span><span data-line="5415"><span class="sd">          result.</span>
</span><span data-line="5416">
</span><span data-line="5417"><span class="sd">          The built-in names are as follows, some of which may only be</span>
</span><span data-line="5418"><span class="sd">          available for certain types of constraint:</span>
</span><span data-line="5419">
</span><span data-line="5420"><span class="sd">            * ``%(table_name)s`` - the name of the :class:`_schema.Table`</span>
</span><span data-line="5421"><span class="sd">              object</span>
</span><span data-line="5422"><span class="sd">              associated with the constraint.</span>
</span><span data-line="5423">
</span><span data-line="5424"><span class="sd">            * ``%(referred_table_name)s`` - the name of the</span>
</span><span data-line="5425"><span class="sd">              :class:`_schema.Table`</span>
</span><span data-line="5426"><span class="sd">              object associated with the referencing target of a</span>
</span><span data-line="5427"><span class="sd">              :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="5428">
</span><span data-line="5429"><span class="sd">            * ``%(column_0_name)s`` - the name of the :class:`_schema.Column`</span>
</span><span data-line="5430"><span class="sd">              at</span>
</span><span data-line="5431"><span class="sd">              index position &quot;0&quot; within the constraint.</span>
</span><span data-line="5432">
</span><span data-line="5433"><span class="sd">            * ``%(column_0N_name)s`` - the name of all :class:`_schema.Column`</span>
</span><span data-line="5434"><span class="sd">              objects in order within the constraint, joined without a</span>
</span><span data-line="5435"><span class="sd">              separator.</span>
</span><span data-line="5436">
</span><span data-line="5437"><span class="sd">            * ``%(column_0_N_name)s`` - the name of all</span>
</span><span data-line="5438"><span class="sd">              :class:`_schema.Column`</span>
</span><span data-line="5439"><span class="sd">              objects in order within the constraint, joined with an</span>
</span><span data-line="5440"><span class="sd">              underscore as a separator.</span>
</span><span data-line="5441">
</span><span data-line="5442"><span class="sd">            * ``%(column_0_label)s``, ``%(column_0N_label)s``,</span>
</span><span data-line="5443"><span class="sd">              ``%(column_0_N_label)s`` - the label of either the zeroth</span>
</span><span data-line="5444"><span class="sd">              :class:`_schema.Column` or all :class:`.Columns`, separated with</span>
</span><span data-line="5445"><span class="sd">              or without an underscore</span>
</span><span data-line="5446">
</span><span data-line="5447"><span class="sd">            * ``%(column_0_key)s``, ``%(column_0N_key)s``,</span>
</span><span data-line="5448"><span class="sd">              ``%(column_0_N_key)s`` - the key of either the zeroth</span>
</span><span data-line="5449"><span class="sd">              :class:`_schema.Column` or all :class:`.Columns`, separated with</span>
</span><span data-line="5450"><span class="sd">              or without an underscore</span>
</span><span data-line="5451">
</span><span data-line="5452"><span class="sd">            * ``%(referred_column_0_name)s``, ``%(referred_column_0N_name)s``</span>
</span><span data-line="5453"><span class="sd">              ``%(referred_column_0_N_name)s``,  ``%(referred_column_0_key)s``,</span>
</span><span data-line="5454"><span class="sd">              ``%(referred_column_0N_key)s``, ...  column tokens which</span>
</span><span data-line="5455"><span class="sd">              render the names/keys/labels of columns that are referenced</span>
</span><span data-line="5456"><span class="sd">              by a  :class:`_schema.ForeignKeyConstraint`.</span>
</span><span data-line="5457">
</span><span data-line="5458"><span class="sd">            * ``%(constraint_name)s`` - a special key that refers to the</span>
</span><span data-line="5459"><span class="sd">              existing name given to the constraint.  When this key is</span>
</span><span data-line="5460"><span class="sd">              present, the :class:`.Constraint` object&#39;s existing name will be</span>
</span><span data-line="5461"><span class="sd">              replaced with one that is composed from template string that</span>
</span><span data-line="5462"><span class="sd">              uses this token. When this token is present, it is required that</span>
</span><span data-line="5463"><span class="sd">              the :class:`.Constraint` is given an explicit name ahead of time.</span>
</span><span data-line="5464">
</span><span data-line="5465"><span class="sd">            * user-defined: any additional token may be implemented by passing</span>
</span><span data-line="5466"><span class="sd">              it along with a ``fn(constraint, table)`` callable to the</span>
</span><span data-line="5467"><span class="sd">              naming_convention dictionary.</span>
</span><span data-line="5468">
</span><span data-line="5469"><span class="sd">          .. versionadded:: 1.3.0 - added new ``%(column_0N_name)s``,</span>
</span><span data-line="5470"><span class="sd">             ``%(column_0_N_name)s``, and related tokens that produce</span>
</span><span data-line="5471"><span class="sd">             concatenations of names, keys, or labels for all columns referred</span>
</span><span data-line="5472"><span class="sd">             to by a given constraint.</span>
</span><span data-line="5473">
</span><span data-line="5474"><span class="sd">          .. seealso::</span>
</span><span data-line="5475">
</span><span data-line="5476"><span class="sd">                :ref:`constraint_naming_conventions` - for detailed usage</span>
</span><span data-line="5477"><span class="sd">                examples.</span>
</span><span data-line="5478">
</span><span data-line="5479"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5480">        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="5481">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="5482">                <span class="s2">&quot;expected schema argument to be a string, &quot;</span>
</span><span data-line="5483">                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span data-line="5484">            <span class="p">)</span>
</span><span data-line="5485">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">FacadeDict</span><span class="p">()</span>
</span><span data-line="5486">        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">quoted_name</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">quote_schema</span><span class="p">)</span>
</span><span data-line="5487">        <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="5488">            <span class="n">naming_convention</span>
</span><span data-line="5489">            <span class="k">if</span> <span class="n">naming_convention</span>
</span><span data-line="5490">            <span class="k">else</span> <span class="n">DEFAULT_NAMING_CONVENTION</span>
</span><span data-line="5491">        <span class="p">)</span>
</span><span data-line="5492">        <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
</span><span data-line="5493">            <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
</span><span data-line="5494">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span data-line="5495">        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="5496">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForeignKey</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="5497">            <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span data-line="5498">        <span class="p">)</span>
</span><span data-line="5499">
</span><span data-line="5500">    <span class="n">tables</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">FacadeDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Table</span><span class="p">]</span>
</span><span data-line="5501"><span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary of :class:`_schema.Table`</span>
</span><span data-line="5502"><span class="sd">    objects keyed to their name or &quot;table key&quot;.</span>
</span><span data-line="5503">
</span><span data-line="5504"><span class="sd">    The exact key is that determined by the :attr:`_schema.Table.key`</span>
</span><span data-line="5505"><span class="sd">    attribute;</span>
</span><span data-line="5506"><span class="sd">    for a table with no :attr:`_schema.Table.schema` attribute,</span>
</span><span data-line="5507"><span class="sd">    this is the same</span>
</span><span data-line="5508"><span class="sd">    as :attr:`_schema.Table.name`.  For a table with a schema,</span>
</span><span data-line="5509"><span class="sd">    it is typically of the</span>
</span><span data-line="5510"><span class="sd">    form ``schemaname.tablename``.</span>
</span><span data-line="5511">
</span><span data-line="5512"><span class="sd">    .. seealso::</span>
</span><span data-line="5513">
</span><span data-line="5514"><span class="sd">        :attr:`_schema.MetaData.sorted_tables`</span>
</span><span data-line="5515">
</span><span data-line="5516"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="5517">
</span><span data-line="5518">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="5519">        <span class="k">return</span> <span class="s2">&quot;MetaData()&quot;</span>
</span><span data-line="5520">
</span><span data-line="5521">    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_or_key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Table</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="5522">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_or_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="5523">            <span class="n">table_or_key</span> <span class="o">=</span> <span class="n">table_or_key</span><span class="o">.</span><span class="n">key</span>
</span><span data-line="5524">        <span class="k">return</span> <span class="n">table_or_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span>
</span><span data-line="5525">
</span><span data-line="5526">    <span class="k">def</span> <span class="nf">_add_table</span><span class="p">(</span>
</span><span data-line="5527">        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span>
</span><span data-line="5528">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5529">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="5530">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">_insert_item</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span data-line="5531">        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
</span><span data-line="5532">            <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span data-line="5533">
</span><span data-line="5534">    <span class="k">def</span> <span class="nf">_remove_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5535">        <span class="n">key</span> <span class="o">=</span> <span class="n">_get_table_key</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span><span data-line="5536">        <span class="n">removed</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="5537">        <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5538">            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">removed</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
</span><span data-line="5539">                <span class="n">fk</span><span class="o">.</span><span class="n">_remove_from_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="5540">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
</span><span data-line="5541">            <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="5542">                <span class="n">t</span><span class="o">.</span><span class="n">schema</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span data-line="5543">            <span class="p">}</span>
</span><span data-line="5544">
</span><span data-line="5545">    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span data-line="5546">        <span class="k">return</span> <span class="p">{</span>
</span><span data-line="5547">            <span class="s2">&quot;tables&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">,</span>
</span><span data-line="5548">            <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span data-line="5549">            <span class="s2">&quot;schemas&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">,</span>
</span><span data-line="5550">            <span class="s2">&quot;sequences&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span><span class="p">,</span>
</span><span data-line="5551">            <span class="s2">&quot;fk_memos&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="p">,</span>
</span><span data-line="5552">            <span class="s2">&quot;naming_convention&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span><span class="p">,</span>
</span><span data-line="5553">        <span class="p">}</span>
</span><span data-line="5554">
</span><span data-line="5555">    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5556">        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;tables&quot;</span><span class="p">]</span>
</span><span data-line="5557">        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span>
</span><span data-line="5558">        <span class="bp">self</span><span class="o">.</span><span class="n">naming_convention</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;naming_convention&quot;</span><span class="p">]</span>
</span><span data-line="5559">        <span class="bp">self</span><span class="o">.</span><span class="n">_sequences</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;sequences&quot;</span><span class="p">]</span>
</span><span data-line="5560">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;schemas&quot;</span><span class="p">]</span>
</span><span data-line="5561">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;fk_memos&quot;</span><span class="p">]</span>
</span><span data-line="5562">
</span><span data-line="5563">    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5564"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear all Table objects from this MetaData.&quot;&quot;&quot;</span>
</span><span data-line="5565">
</span><span data-line="5566">        <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="5567">        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="5568">        <span class="bp">self</span><span class="o">.</span><span class="n">_fk_memos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="5569">
</span><span data-line="5570">    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5571"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the given Table object from this MetaData.&quot;&quot;&quot;</span>
</span><span data-line="5572">
</span><span data-line="5573">        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_table</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span><span data-line="5574">
</span><span data-line="5575">    <span class="nd">@property</span>
</span><span data-line="5576">    <span class="k">def</span> <span class="nf">sorted_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
</span><span data-line="5577"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of :class:`_schema.Table` objects sorted in order of</span>
</span><span data-line="5578"><span class="sd">        foreign key dependency.</span>
</span><span data-line="5579">
</span><span data-line="5580"><span class="sd">        The sorting will place :class:`_schema.Table`</span>
</span><span data-line="5581"><span class="sd">        objects that have dependencies</span>
</span><span data-line="5582"><span class="sd">        first, before the dependencies themselves, representing the</span>
</span><span data-line="5583"><span class="sd">        order in which they can be created.   To get the order in which</span>
</span><span data-line="5584"><span class="sd">        the tables would be dropped, use the ``reversed()`` Python built-in.</span>
</span><span data-line="5585">
</span><span data-line="5586"><span class="sd">        .. warning::</span>
</span><span data-line="5587">
</span><span data-line="5588"><span class="sd">            The :attr:`.MetaData.sorted_tables` attribute cannot by itself</span>
</span><span data-line="5589"><span class="sd">            accommodate automatic resolution of dependency cycles between</span>
</span><span data-line="5590"><span class="sd">            tables, which are usually caused by mutually dependent foreign key</span>
</span><span data-line="5591"><span class="sd">            constraints. When these cycles are detected, the foreign keys</span>
</span><span data-line="5592"><span class="sd">            of these tables are omitted from consideration in the sort.</span>
</span><span data-line="5593"><span class="sd">            A warning is emitted when this condition occurs, which will be an</span>
</span><span data-line="5594"><span class="sd">            exception raise in a future release.   Tables which are not part</span>
</span><span data-line="5595"><span class="sd">            of the cycle will still be returned in dependency order.</span>
</span><span data-line="5596">
</span><span data-line="5597"><span class="sd">            To resolve these cycles, the</span>
</span><span data-line="5598"><span class="sd">            :paramref:`_schema.ForeignKeyConstraint.use_alter` parameter may be</span>
</span><span data-line="5599"><span class="sd">            applied to those constraints which create a cycle.  Alternatively,</span>
</span><span data-line="5600"><span class="sd">            the :func:`_schema.sort_tables_and_constraints` function will</span>
</span><span data-line="5601"><span class="sd">            automatically return foreign key constraints in a separate</span>
</span><span data-line="5602"><span class="sd">            collection when cycles are detected so that they may be applied</span>
</span><span data-line="5603"><span class="sd">            to a schema separately.</span>
</span><span data-line="5604">
</span><span data-line="5605"><span class="sd">            .. versionchanged:: 1.3.17 - a warning is emitted when</span>
</span><span data-line="5606"><span class="sd">               :attr:`.MetaData.sorted_tables` cannot perform a proper sort</span>
</span><span data-line="5607"><span class="sd">               due to cyclical dependencies.  This will be an exception in a</span>
</span><span data-line="5608"><span class="sd">               future release.  Additionally, the sort will continue to return</span>
</span><span data-line="5609"><span class="sd">               other tables not involved in the cycle in dependency order which</span>
</span><span data-line="5610"><span class="sd">               was not the case previously.</span>
</span><span data-line="5611">
</span><span data-line="5612"><span class="sd">        .. seealso::</span>
</span><span data-line="5613">
</span><span data-line="5614"><span class="sd">            :func:`_schema.sort_tables`</span>
</span><span data-line="5615">
</span><span data-line="5616"><span class="sd">            :func:`_schema.sort_tables_and_constraints`</span>
</span><span data-line="5617">
</span><span data-line="5618"><span class="sd">            :attr:`_schema.MetaData.tables`</span>
</span><span data-line="5619">
</span><span data-line="5620"><span class="sd">            :meth:`_reflection.Inspector.get_table_names`</span>
</span><span data-line="5621">
</span><span data-line="5622"><span class="sd">            :meth:`_reflection.Inspector.get_sorted_table_and_fkc_names`</span>
</span><span data-line="5623">
</span><span data-line="5624">
</span><span data-line="5625"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5626">        <span class="k">return</span> <span class="n">ddl</span><span class="o">.</span><span class="n">sort_tables</span><span class="p">(</span>
</span><span data-line="5627">            <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span data-line="5628">        <span class="p">)</span>
</span><span data-line="5629">
</span><span data-line="5630">    <span class="c1"># overload needed to work around mypy this mypy</span>
</span><span data-line="5631">    <span class="c1"># https://github.com/python/mypy/issues/17093</span>
</span><span data-line="5632">    <span class="nd">@overload</span>
</span><span data-line="5633">    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span>
</span><span data-line="5634">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5635">        <span class="n">bind</span><span class="p">:</span> <span class="n">Engine</span><span class="p">,</span>
</span><span data-line="5636">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5637">        <span class="n">views</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5638">        <span class="n">only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span data-line="5639">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span>
</span><span data-line="5640">        <span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5641">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5642">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5643">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5644">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="5645">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="5646">
</span><span data-line="5647">    <span class="nd">@overload</span>
</span><span data-line="5648">    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span>
</span><span data-line="5649">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5650">        <span class="n">bind</span><span class="p">:</span> <span class="n">Connection</span><span class="p">,</span>
</span><span data-line="5651">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5652">        <span class="n">views</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5653">        <span class="n">only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span data-line="5654">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span>
</span><span data-line="5655">        <span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5656">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5657">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5658">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span>
</span><span data-line="5659">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="5660">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</span><span data-line="5661">
</span><span data-line="5662">    <span class="nd">@util</span><span class="o">.</span><span class="n">preload_module</span><span class="p">(</span><span class="s2">&quot;sqlalchemy.engine.reflection&quot;</span><span class="p">)</span>
</span><span data-line="5663">    <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span>
</span><span data-line="5664">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5665">        <span class="n">bind</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Engine</span><span class="p">,</span> <span class="n">Connection</span><span class="p">],</span>
</span><span data-line="5666">        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5667">        <span class="n">views</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="5668">        <span class="n">only</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
</span><span data-line="5669">            <span class="n">_typing_Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="kc">None</span>
</span><span data-line="5670">        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5671">        <span class="n">extend_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="5672">        <span class="n">autoload_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="5673">        <span class="n">resolve_fks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="5674">        <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span data-line="5675">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5676"><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Load all available table definitions from the database.</span>
</span><span data-line="5677">
</span><span data-line="5678"><span class="sd">        Automatically creates ``Table`` entries in this ``MetaData`` for any</span>
</span><span data-line="5679"><span class="sd">        table available in the database but not yet present in the</span>
</span><span data-line="5680"><span class="sd">        ``MetaData``.  May be called multiple times to pick up tables recently</span>
</span><span data-line="5681"><span class="sd">        added to the database, however no special action is taken if a table</span>
</span><span data-line="5682"><span class="sd">        in this ``MetaData`` no longer exists in the database.</span>
</span><span data-line="5683">
</span><span data-line="5684"><span class="sd">        :param bind:</span>
</span><span data-line="5685"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span data-line="5686"><span class="sd">          database.</span>
</span><span data-line="5687">
</span><span data-line="5688"><span class="sd">        :param schema:</span>
</span><span data-line="5689"><span class="sd">          Optional, query and reflect tables from an alternate schema.</span>
</span><span data-line="5690"><span class="sd">          If None, the schema associated with this :class:`_schema.MetaData`</span>
</span><span data-line="5691"><span class="sd">          is used, if any.</span>
</span><span data-line="5692">
</span><span data-line="5693"><span class="sd">        :param views:</span>
</span><span data-line="5694"><span class="sd">          If True, also reflect views (materialized and plain).</span>
</span><span data-line="5695">
</span><span data-line="5696"><span class="sd">        :param only:</span>
</span><span data-line="5697"><span class="sd">          Optional.  Load only a sub-set of available named tables.  May be</span>
</span><span data-line="5698"><span class="sd">          specified as a sequence of names or a callable.</span>
</span><span data-line="5699">
</span><span data-line="5700"><span class="sd">          If a sequence of names is provided, only those tables will be</span>
</span><span data-line="5701"><span class="sd">          reflected.  An error is raised if a table is requested but not</span>
</span><span data-line="5702"><span class="sd">          available.  Named tables already present in this ``MetaData`` are</span>
</span><span data-line="5703"><span class="sd">          ignored.</span>
</span><span data-line="5704">
</span><span data-line="5705"><span class="sd">          If a callable is provided, it will be used as a boolean predicate to</span>
</span><span data-line="5706"><span class="sd">          filter the list of potential table names.  The callable is called</span>
</span><span data-line="5707"><span class="sd">          with a table name and this ``MetaData`` instance as positional</span>
</span><span data-line="5708"><span class="sd">          arguments and should return a true value for any table to reflect.</span>
</span><span data-line="5709">
</span><span data-line="5710"><span class="sd">        :param extend_existing: Passed along to each :class:`_schema.Table` as</span>
</span><span data-line="5711"><span class="sd">          :paramref:`_schema.Table.extend_existing`.</span>
</span><span data-line="5712">
</span><span data-line="5713"><span class="sd">        :param autoload_replace: Passed along to each :class:`_schema.Table`</span>
</span><span data-line="5714"><span class="sd">          as</span>
</span><span data-line="5715"><span class="sd">          :paramref:`_schema.Table.autoload_replace`.</span>
</span><span data-line="5716">
</span><span data-line="5717"><span class="sd">        :param resolve_fks: if True, reflect :class:`_schema.Table`</span>
</span><span data-line="5718"><span class="sd">         objects linked</span>
</span><span data-line="5719"><span class="sd">         to :class:`_schema.ForeignKey` objects located in each</span>
</span><span data-line="5720"><span class="sd">         :class:`_schema.Table`.</span>
</span><span data-line="5721"><span class="sd">         For :meth:`_schema.MetaData.reflect`,</span>
</span><span data-line="5722"><span class="sd">         this has the effect of reflecting</span>
</span><span data-line="5723"><span class="sd">         related tables that might otherwise not be in the list of tables</span>
</span><span data-line="5724"><span class="sd">         being reflected, for example if the referenced table is in a</span>
</span><span data-line="5725"><span class="sd">         different schema or is omitted via the</span>
</span><span data-line="5726"><span class="sd">         :paramref:`.MetaData.reflect.only` parameter.  When False,</span>
</span><span data-line="5727"><span class="sd">         :class:`_schema.ForeignKey` objects are not followed to the</span>
</span><span data-line="5728"><span class="sd">         :class:`_schema.Table`</span>
</span><span data-line="5729"><span class="sd">         in which they link, however if the related table is also part of the</span>
</span><span data-line="5730"><span class="sd">         list of tables that would be reflected in any case, the</span>
</span><span data-line="5731"><span class="sd">         :class:`_schema.ForeignKey` object will still resolve to its related</span>
</span><span data-line="5732"><span class="sd">         :class:`_schema.Table` after the :meth:`_schema.MetaData.reflect`</span>
</span><span data-line="5733"><span class="sd">         operation is</span>
</span><span data-line="5734"><span class="sd">         complete.   Defaults to True.</span>
</span><span data-line="5735">
</span><span data-line="5736"><span class="sd">         .. versionadded:: 1.3.0</span>
</span><span data-line="5737">
</span><span data-line="5738"><span class="sd">         .. seealso::</span>
</span><span data-line="5739">
</span><span data-line="5740"><span class="sd">            :paramref:`_schema.Table.resolve_fks`</span>
</span><span data-line="5741">
</span><span data-line="5742"><span class="sd">        :param \**dialect_kwargs: Additional keyword arguments not mentioned</span>
</span><span data-line="5743"><span class="sd">         above are dialect specific, and passed in the form</span>
</span><span data-line="5744"><span class="sd">         ``&lt;dialectname&gt;_&lt;argname&gt;``.  See the documentation regarding an</span>
</span><span data-line="5745"><span class="sd">         individual dialect at :ref:`dialect_toplevel` for detail on</span>
</span><span data-line="5746"><span class="sd">         documented arguments.</span>
</span><span data-line="5747">
</span><span data-line="5748"><span class="sd">        .. seealso::</span>
</span><span data-line="5749">
</span><span data-line="5750"><span class="sd">            :ref:`metadata_reflection_toplevel`</span>
</span><span data-line="5751">
</span><span data-line="5752"><span class="sd">            :meth:`_events.DDLEvents.column_reflect` - Event used to customize</span>
</span><span data-line="5753"><span class="sd">            the reflected columns. Usually used to generalize the types using</span>
</span><span data-line="5754"><span class="sd">            :meth:`_types.TypeEngine.as_generic`</span>
</span><span data-line="5755">
</span><span data-line="5756"><span class="sd">            :ref:`metadata_reflection_dbagnostic_types` - describes how to</span>
</span><span data-line="5757"><span class="sd">            reflect tables using general types.</span>
</span><span data-line="5758">
</span><span data-line="5759"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5760">
</span><span data-line="5761">        <span class="k">with</span> <span class="n">inspection</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">bind</span><span class="p">)</span><span class="o">.</span><span class="n">_inspection_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">insp</span><span class="p">:</span>
</span><span data-line="5762">            <span class="n">reflect_opts</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="5763">                <span class="s2">&quot;autoload_with&quot;</span><span class="p">:</span> <span class="n">insp</span><span class="p">,</span>
</span><span data-line="5764">                <span class="s2">&quot;extend_existing&quot;</span><span class="p">:</span> <span class="n">extend_existing</span><span class="p">,</span>
</span><span data-line="5765">                <span class="s2">&quot;autoload_replace&quot;</span><span class="p">:</span> <span class="n">autoload_replace</span><span class="p">,</span>
</span><span data-line="5766">                <span class="s2">&quot;resolve_fks&quot;</span><span class="p">:</span> <span class="n">resolve_fks</span><span class="p">,</span>
</span><span data-line="5767">                <span class="s2">&quot;_extend_on&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
</span><span data-line="5768">            <span class="p">}</span>
</span><span data-line="5769">
</span><span data-line="5770">            <span class="n">reflect_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dialect_kwargs</span><span class="p">)</span>
</span><span data-line="5771">
</span><span data-line="5772">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5773">                <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
</span><span data-line="5774">
</span><span data-line="5775">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5776">                <span class="n">reflect_opts</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>
</span><span data-line="5777">
</span><span data-line="5778">            <span class="n">kind</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectKind</span><span class="o">.</span><span class="n">TABLE</span>
</span><span data-line="5779">            <span class="n">available</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span>
</span><span data-line="5780">                <span class="n">insp</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span data-line="5781">            <span class="p">)</span>
</span><span data-line="5782">            <span class="k">if</span> <span class="n">views</span><span class="p">:</span>
</span><span data-line="5783">                <span class="n">kind</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectKind</span><span class="o">.</span><span class="n">ANY</span>
</span><span data-line="5784">                <span class="n">available</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_view_names</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span>
</span><span data-line="5785">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="5786">                    <span class="n">available</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_materialized_view_names</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span>
</span><span data-line="5787">                <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
</span><span data-line="5788">                    <span class="k">pass</span>
</span><span data-line="5789">
</span><span data-line="5790">            <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5791">                <span class="n">available_w_schema</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span>
</span><span data-line="5792">                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">available</span><span class="p">]</span>
</span><span data-line="5793">                <span class="p">)</span>
</span><span data-line="5794">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="5795">                <span class="n">available_w_schema</span> <span class="o">=</span> <span class="n">available</span>
</span><span data-line="5796">
</span><span data-line="5797">            <span class="n">current</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">)</span>
</span><span data-line="5798">
</span><span data-line="5799">            <span class="k">if</span> <span class="n">only</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5800">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="5801">                    <span class="n">name</span>
</span><span data-line="5802">                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">schname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">available_w_schema</span><span class="p">)</span>
</span><span data-line="5803">                    <span class="k">if</span> <span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">schname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span>
</span><span data-line="5804">                <span class="p">]</span>
</span><span data-line="5805">            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">only</span><span class="p">):</span>
</span><span data-line="5806">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="5807">                    <span class="n">name</span>
</span><span data-line="5808">                    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">schname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">available</span><span class="p">,</span> <span class="n">available_w_schema</span><span class="p">)</span>
</span><span data-line="5809">                    <span class="k">if</span> <span class="p">(</span><span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">schname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="p">)</span>
</span><span data-line="5810">                    <span class="ow">and</span> <span class="n">only</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span data-line="5811">                <span class="p">]</span>
</span><span data-line="5812">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="5813">                <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">only</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available</span><span class="p">]</span>
</span><span data-line="5814">                <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
</span><span data-line="5815">                    <span class="n">s</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot; schema &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">schema</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
</span><span data-line="5816">                    <span class="n">missing_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
</span><span data-line="5817">                    <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">(</span>
</span><span data-line="5818">                        <span class="sa">f</span><span class="s2">&quot;Could not reflect: requested table(s) not available &quot;</span>
</span><span data-line="5819">                        <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">bind</span><span class="o">.</span><span class="n">engine</span><span class="si">!r}{</span><span class="n">s</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="n">missing_str</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span data-line="5820">                    <span class="p">)</span>
</span><span data-line="5821">                <span class="n">load</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="5822">                    <span class="n">name</span>
</span><span data-line="5823">                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">only</span>
</span><span data-line="5824">                    <span class="k">if</span> <span class="n">extend_existing</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span>
</span><span data-line="5825">                <span class="p">]</span>
</span><span data-line="5826">            <span class="c1"># pass the available tables so the inspector can</span>
</span><span data-line="5827">            <span class="c1"># choose to ignore the filter_names</span>
</span><span data-line="5828">            <span class="n">_reflect_info</span> <span class="o">=</span> <span class="n">insp</span><span class="o">.</span><span class="n">_get_reflection_info</span><span class="p">(</span>
</span><span data-line="5829">                <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">,</span>
</span><span data-line="5830">                <span class="n">filter_names</span><span class="o">=</span><span class="n">load</span><span class="p">,</span>
</span><span data-line="5831">                <span class="n">available</span><span class="o">=</span><span class="n">available</span><span class="p">,</span>
</span><span data-line="5832">                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
</span><span data-line="5833">                <span class="n">scope</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">preloaded</span><span class="o">.</span><span class="n">engine_reflection</span><span class="o">.</span><span class="n">ObjectScope</span><span class="o">.</span><span class="n">ANY</span><span class="p">,</span>
</span><span data-line="5834">                <span class="o">**</span><span class="n">dialect_kwargs</span><span class="p">,</span>
</span><span data-line="5835">            <span class="p">)</span>
</span><span data-line="5836">            <span class="n">reflect_opts</span><span class="p">[</span><span class="s2">&quot;_reflect_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_reflect_info</span>
</span><span data-line="5837">
</span><span data-line="5838">            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">load</span><span class="p">:</span>
</span><span data-line="5839">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="5840">                    <span class="n">Table</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">reflect_opts</span><span class="p">)</span>
</span><span data-line="5841">                <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">UnreflectableTableError</span> <span class="k">as</span> <span class="n">uerr</span><span class="p">:</span>
</span><span data-line="5842">                    <span class="n">util</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping table </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">uerr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="5843">
</span><span data-line="5844">    <span class="k">def</span> <span class="nf">create_all</span><span class="p">(</span>
</span><span data-line="5845">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5846">        <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span>
</span><span data-line="5847">        <span class="n">tables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5848">        <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="5849">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5850"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create all tables stored in this metadata.</span>
</span><span data-line="5851">
</span><span data-line="5852"><span class="sd">        Conditional by default, will not attempt to recreate tables already</span>
</span><span data-line="5853"><span class="sd">        present in the target database.</span>
</span><span data-line="5854">
</span><span data-line="5855"><span class="sd">        :param bind:</span>
</span><span data-line="5856"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span data-line="5857"><span class="sd">          database.</span>
</span><span data-line="5858">
</span><span data-line="5859"><span class="sd">        :param tables:</span>
</span><span data-line="5860"><span class="sd">          Optional list of ``Table`` objects, which is a subset of the total</span>
</span><span data-line="5861"><span class="sd">          tables in the ``MetaData`` (others are ignored).</span>
</span><span data-line="5862">
</span><span data-line="5863"><span class="sd">        :param checkfirst:</span>
</span><span data-line="5864"><span class="sd">          Defaults to True, don&#39;t issue CREATEs for tables already present</span>
</span><span data-line="5865"><span class="sd">          in the target database.</span>
</span><span data-line="5866">
</span><span data-line="5867"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5868">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span>
</span><span data-line="5869">            <span class="n">ddl</span><span class="o">.</span><span class="n">SchemaGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span>
</span><span data-line="5870">        <span class="p">)</span>
</span><span data-line="5871">
</span><span data-line="5872">    <span class="k">def</span> <span class="nf">drop_all</span><span class="p">(</span>
</span><span data-line="5873">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="5874">        <span class="n">bind</span><span class="p">:</span> <span class="n">_CreateDropBind</span><span class="p">,</span>
</span><span data-line="5875">        <span class="n">tables</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_typing_Sequence</span><span class="p">[</span><span class="n">Table</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="5876">        <span class="n">checkfirst</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="5877">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5878"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drop all tables stored in this metadata.</span>
</span><span data-line="5879">
</span><span data-line="5880"><span class="sd">        Conditional by default, will not attempt to drop tables not present in</span>
</span><span data-line="5881"><span class="sd">        the target database.</span>
</span><span data-line="5882">
</span><span data-line="5883"><span class="sd">        :param bind:</span>
</span><span data-line="5884"><span class="sd">          A :class:`.Connection` or :class:`.Engine` used to access the</span>
</span><span data-line="5885"><span class="sd">          database.</span>
</span><span data-line="5886">
</span><span data-line="5887"><span class="sd">        :param tables:</span>
</span><span data-line="5888"><span class="sd">          Optional list of ``Table`` objects, which is a subset of the</span>
</span><span data-line="5889"><span class="sd">          total tables in the ``MetaData`` (others are ignored).</span>
</span><span data-line="5890">
</span><span data-line="5891"><span class="sd">        :param checkfirst:</span>
</span><span data-line="5892"><span class="sd">          Defaults to True, only issue DROPs for tables confirmed to be</span>
</span><span data-line="5893"><span class="sd">          present in the target database.</span>
</span><span data-line="5894">
</span><span data-line="5895"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5896">        <span class="n">bind</span><span class="o">.</span><span class="n">_run_ddl_visitor</span><span class="p">(</span>
</span><span data-line="5897">            <span class="n">ddl</span><span class="o">.</span><span class="n">SchemaDropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="n">checkfirst</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span>
</span><span data-line="5898">        <span class="p">)</span>
</span><span data-line="5899">
</span><span data-line="5900">
</span><span data-line="5901"><span class="k">class</span> <span class="nc">Computed</span><span class="p">(</span><span class="n">FetchedValue</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="5902"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines a generated column, i.e. &quot;GENERATED ALWAYS AS&quot; syntax.</span>
</span><span data-line="5903">
</span><span data-line="5904"><span class="sd">    The :class:`.Computed` construct is an inline construct added to the</span>
</span><span data-line="5905"><span class="sd">    argument list of a :class:`_schema.Column` object::</span>
</span><span data-line="5906">
</span><span data-line="5907"><span class="sd">        from sqlalchemy import Computed</span>
</span><span data-line="5908">
</span><span data-line="5909"><span class="sd">        Table(&#39;square&#39;, metadata_obj,</span>
</span><span data-line="5910"><span class="sd">            Column(&#39;side&#39;, Float, nullable=False),</span>
</span><span data-line="5911"><span class="sd">            Column(&#39;area&#39;, Float, Computed(&#39;side * side&#39;))</span>
</span><span data-line="5912"><span class="sd">        )</span>
</span><span data-line="5913">
</span><span data-line="5914"><span class="sd">    See the linked documentation below for complete details.</span>
</span><span data-line="5915">
</span><span data-line="5916"><span class="sd">    .. versionadded:: 1.3.11</span>
</span><span data-line="5917">
</span><span data-line="5918"><span class="sd">    .. seealso::</span>
</span><span data-line="5919">
</span><span data-line="5920"><span class="sd">        :ref:`computed_ddl`</span>
</span><span data-line="5921">
</span><span data-line="5922"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="5923">
</span><span data-line="5924">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;computed_column&quot;</span>
</span><span data-line="5925">
</span><span data-line="5926">    <span class="n">column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Column</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>
</span><span data-line="5927">
</span><span data-line="5928">    <span class="nd">@_document_text_coercion</span><span class="p">(</span>
</span><span data-line="5929">        <span class="s2">&quot;sqltext&quot;</span><span class="p">,</span> <span class="s2">&quot;:class:`.Computed`&quot;</span><span class="p">,</span> <span class="s2">&quot;:paramref:`.Computed.sqltext`&quot;</span>
</span><span data-line="5930">    <span class="p">)</span>
</span><span data-line="5931">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="5932">        <span class="bp">self</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">:</span> <span class="n">_DDLColumnArgument</span><span class="p">,</span> <span class="n">persisted</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="5933">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5934"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a GENERATED ALWAYS AS DDL construct to accompany a</span>
</span><span data-line="5935"><span class="sd">        :class:`_schema.Column`.</span>
</span><span data-line="5936">
</span><span data-line="5937"><span class="sd">        :param sqltext:</span>
</span><span data-line="5938"><span class="sd">          A string containing the column generation expression, which will be</span>
</span><span data-line="5939"><span class="sd">          used verbatim, or a SQL expression construct, such as a</span>
</span><span data-line="5940"><span class="sd">          :func:`_expression.text`</span>
</span><span data-line="5941"><span class="sd">          object.   If given as a string, the object is converted to a</span>
</span><span data-line="5942"><span class="sd">          :func:`_expression.text` object.</span>
</span><span data-line="5943">
</span><span data-line="5944"><span class="sd">        :param persisted:</span>
</span><span data-line="5945"><span class="sd">          Optional, controls how this column should be persisted by the</span>
</span><span data-line="5946"><span class="sd">          database.   Possible values are:</span>
</span><span data-line="5947">
</span><span data-line="5948"><span class="sd">          * ``None``, the default, it will use the default persistence</span>
</span><span data-line="5949"><span class="sd">            defined by the database.</span>
</span><span data-line="5950"><span class="sd">          * ``True``, will render ``GENERATED ALWAYS AS ... STORED``, or the</span>
</span><span data-line="5951"><span class="sd">            equivalent for the target database if supported.</span>
</span><span data-line="5952"><span class="sd">          * ``False``, will render ``GENERATED ALWAYS AS ... VIRTUAL``, or</span>
</span><span data-line="5953"><span class="sd">            the equivalent for the target database if supported.</span>
</span><span data-line="5954">
</span><span data-line="5955"><span class="sd">          Specifying ``True`` or ``False`` may raise an error when the DDL</span>
</span><span data-line="5956"><span class="sd">          is emitted to the target database if the database does not support</span>
</span><span data-line="5957"><span class="sd">          that persistence option.   Leaving this parameter at its default</span>
</span><span data-line="5958"><span class="sd">          of ``None`` is guaranteed to succeed for all databases that support</span>
</span><span data-line="5959"><span class="sd">          ``GENERATED ALWAYS AS``.</span>
</span><span data-line="5960">
</span><span data-line="5961"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="5962">        <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span> <span class="o">=</span> <span class="n">coercions</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">roles</span><span class="o">.</span><span class="n">DDLExpressionRole</span><span class="p">,</span> <span class="n">sqltext</span><span class="p">)</span>
</span><span data-line="5963">        <span class="bp">self</span><span class="o">.</span><span class="n">persisted</span> <span class="o">=</span> <span class="n">persisted</span>
</span><span data-line="5964">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="5965">
</span><span data-line="5966">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5967">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="5968">
</span><span data-line="5969">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span data-line="5970">            <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Computed</span><span class="p">)</span>
</span><span data-line="5971">        <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Computed</span><span class="p">)):</span>
</span><span data-line="5972">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="5973">                <span class="s2">&quot;A generated column cannot specify a server_default or a &quot;</span>
</span><span data-line="5974">                <span class="s2">&quot;server_onupdate argument&quot;</span>
</span><span data-line="5975">            <span class="p">)</span>
</span><span data-line="5976">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="5977">        <span class="n">parent</span><span class="o">.</span><span class="n">computed</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="5978">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_onupdate</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="5979">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="5980">
</span><span data-line="5981">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span data-line="5982">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="5983">
</span><span data-line="5984">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="5985">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="5986">        <span class="s2">&quot;The :meth:`_schema.Computed.copy` method is deprecated &quot;</span>
</span><span data-line="5987">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="5988">    <span class="p">)</span>
</span><span data-line="5989">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span>
</span><span data-line="5990">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="5991">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Computed</span><span class="p">:</span>
</span><span data-line="5992">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">target_table</span><span class="o">=</span><span class="n">target_table</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="5993">
</span><span data-line="5994">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span>
</span><span data-line="5995">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span>
</span><span data-line="5996">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Computed</span><span class="p">:</span>
</span><span data-line="5997">        <span class="n">sqltext</span> <span class="o">=</span> <span class="n">_copy_expression</span><span class="p">(</span>
</span><span data-line="5998">            <span class="bp">self</span><span class="o">.</span><span class="n">sqltext</span><span class="p">,</span>
</span><span data-line="5999">            <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">table</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6000">            <span class="n">target_table</span><span class="p">,</span>
</span><span data-line="6001">        <span class="p">)</span>
</span><span data-line="6002">        <span class="n">g</span> <span class="o">=</span> <span class="n">Computed</span><span class="p">(</span><span class="n">sqltext</span><span class="p">,</span> <span class="n">persisted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">persisted</span><span class="p">)</span>
</span><span data-line="6003">
</span><span data-line="6004">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span><span data-line="6005">
</span><span data-line="6006">
</span><span data-line="6007"><span class="k">class</span> <span class="nc">Identity</span><span class="p">(</span><span class="n">IdentityOptions</span><span class="p">,</span> <span class="n">FetchedValue</span><span class="p">,</span> <span class="n">SchemaItem</span><span class="p">):</span>
</span><span data-line="6008"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines an identity column, i.e. &quot;GENERATED { ALWAYS | BY DEFAULT }</span>
</span><span data-line="6009"><span class="sd">    AS IDENTITY&quot; syntax.</span>
</span><span data-line="6010">
</span><span data-line="6011"><span class="sd">    The :class:`.Identity` construct is an inline construct added to the</span>
</span><span data-line="6012"><span class="sd">    argument list of a :class:`_schema.Column` object::</span>
</span><span data-line="6013">
</span><span data-line="6014"><span class="sd">        from sqlalchemy import Identity</span>
</span><span data-line="6015">
</span><span data-line="6016"><span class="sd">        Table(&#39;foo&#39;, metadata_obj,</span>
</span><span data-line="6017"><span class="sd">            Column(&#39;id&#39;, Integer, Identity())</span>
</span><span data-line="6018"><span class="sd">            Column(&#39;description&#39;, Text),</span>
</span><span data-line="6019"><span class="sd">        )</span>
</span><span data-line="6020">
</span><span data-line="6021"><span class="sd">    See the linked documentation below for complete details.</span>
</span><span data-line="6022">
</span><span data-line="6023"><span class="sd">    .. versionadded:: 1.4</span>
</span><span data-line="6024">
</span><span data-line="6025"><span class="sd">    .. seealso::</span>
</span><span data-line="6026">
</span><span data-line="6027"><span class="sd">        :ref:`identity_ddl`</span>
</span><span data-line="6028">
</span><span data-line="6029"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="6030">
</span><span data-line="6031">    <span class="n">__visit_name__</span> <span class="o">=</span> <span class="s2">&quot;identity_column&quot;</span>
</span><span data-line="6032">
</span><span data-line="6033">    <span class="n">is_identity</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="6034">
</span><span data-line="6035">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="6036">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="6037">        <span class="n">always</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="6038">        <span class="n">on_null</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6039">        <span class="n">start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6040">        <span class="n">increment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6041">        <span class="n">minvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6042">        <span class="n">maxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6043">        <span class="n">nominvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6044">        <span class="n">nomaxvalue</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6045">        <span class="n">cycle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6046">        <span class="n">cache</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6047">        <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="6048">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="6049"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct a GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY DDL</span>
</span><span data-line="6050"><span class="sd">        construct to accompany a :class:`_schema.Column`.</span>
</span><span data-line="6051">
</span><span data-line="6052"><span class="sd">        See the :class:`.Sequence` documentation for a complete description</span>
</span><span data-line="6053"><span class="sd">        of most parameters.</span>
</span><span data-line="6054">
</span><span data-line="6055"><span class="sd">        .. note::</span>
</span><span data-line="6056"><span class="sd">            MSSQL supports this construct as the preferred alternative to</span>
</span><span data-line="6057"><span class="sd">            generate an IDENTITY on a column, but it uses non standard</span>
</span><span data-line="6058"><span class="sd">            syntax that only support :paramref:`_schema.Identity.start`</span>
</span><span data-line="6059"><span class="sd">            and :paramref:`_schema.Identity.increment`.</span>
</span><span data-line="6060"><span class="sd">            All other parameters are ignored.</span>
</span><span data-line="6061">
</span><span data-line="6062"><span class="sd">        :param always:</span>
</span><span data-line="6063"><span class="sd">          A boolean, that indicates the type of identity column.</span>
</span><span data-line="6064"><span class="sd">          If ``False`` is specified, the default, then the user-specified</span>
</span><span data-line="6065"><span class="sd">          value takes precedence.</span>
</span><span data-line="6066"><span class="sd">          If ``True`` is specified, a user-specified value is not accepted (</span>
</span><span data-line="6067"><span class="sd">          on some backends, like PostgreSQL, OVERRIDING SYSTEM VALUE, or</span>
</span><span data-line="6068"><span class="sd">          similar, may be specified in an INSERT to override the sequence</span>
</span><span data-line="6069"><span class="sd">          value).</span>
</span><span data-line="6070"><span class="sd">          Some backends also have a default value for this parameter,</span>
</span><span data-line="6071"><span class="sd">          ``None`` can be used to omit rendering this part in the DDL. It</span>
</span><span data-line="6072"><span class="sd">          will be treated as ``False`` if a backend does not have a default</span>
</span><span data-line="6073"><span class="sd">          value.</span>
</span><span data-line="6074">
</span><span data-line="6075"><span class="sd">        :param on_null:</span>
</span><span data-line="6076"><span class="sd">          Set to ``True`` to specify ON NULL in conjunction with a</span>
</span><span data-line="6077"><span class="sd">          ``always=False`` identity column. This option is only supported on</span>
</span><span data-line="6078"><span class="sd">          some backends, like Oracle.</span>
</span><span data-line="6079">
</span><span data-line="6080"><span class="sd">        :param start: the starting index of the sequence.</span>
</span><span data-line="6081"><span class="sd">        :param increment: the increment value of the sequence.</span>
</span><span data-line="6082"><span class="sd">        :param minvalue: the minimum value of the sequence.</span>
</span><span data-line="6083"><span class="sd">        :param maxvalue: the maximum value of the sequence.</span>
</span><span data-line="6084"><span class="sd">        :param nominvalue: no minimum value of the sequence.</span>
</span><span data-line="6085"><span class="sd">        :param nomaxvalue: no maximum value of the sequence.</span>
</span><span data-line="6086"><span class="sd">        :param cycle: allows the sequence to wrap around when the maxvalue</span>
</span><span data-line="6087"><span class="sd">         or minvalue has been reached.</span>
</span><span data-line="6088"><span class="sd">        :param cache: optional integer value; number of future values in the</span>
</span><span data-line="6089"><span class="sd">         sequence which are calculated in advance.</span>
</span><span data-line="6090"><span class="sd">        :param order: optional boolean value; if true, renders the</span>
</span><span data-line="6091"><span class="sd">         ORDER keyword.</span>
</span><span data-line="6092">
</span><span data-line="6093"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="6094">        <span class="n">IdentityOptions</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="6095">            <span class="bp">self</span><span class="p">,</span>
</span><span data-line="6096">            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
</span><span data-line="6097">            <span class="n">increment</span><span class="o">=</span><span class="n">increment</span><span class="p">,</span>
</span><span data-line="6098">            <span class="n">minvalue</span><span class="o">=</span><span class="n">minvalue</span><span class="p">,</span>
</span><span data-line="6099">            <span class="n">maxvalue</span><span class="o">=</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span data-line="6100">            <span class="n">nominvalue</span><span class="o">=</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span data-line="6101">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span data-line="6102">            <span class="n">cycle</span><span class="o">=</span><span class="n">cycle</span><span class="p">,</span>
</span><span data-line="6103">            <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span>
</span><span data-line="6104">            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span data-line="6105">        <span class="p">)</span>
</span><span data-line="6106">        <span class="bp">self</span><span class="o">.</span><span class="n">always</span> <span class="o">=</span> <span class="n">always</span>
</span><span data-line="6107">        <span class="bp">self</span><span class="o">.</span><span class="n">on_null</span> <span class="o">=</span> <span class="n">on_null</span>
</span><span data-line="6108">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="6109">
</span><span data-line="6110">    <span class="k">def</span> <span class="nf">_set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">SchemaEventTarget</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="6111">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">Column</span><span class="p">)</span>
</span><span data-line="6112">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span data-line="6113">            <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="n">Identity</span><span class="p">)</span>
</span><span data-line="6114">        <span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">server_onupdate</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
</span><span data-line="6115">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="6116">                <span class="s2">&quot;A column with an Identity object cannot specify a &quot;</span>
</span><span data-line="6117">                <span class="s2">&quot;server_default or a server_onupdate argument&quot;</span>
</span><span data-line="6118">            <span class="p">)</span>
</span><span data-line="6119">        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">autoincrement</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span data-line="6120">            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ArgumentError</span><span class="p">(</span>
</span><span data-line="6121">                <span class="s2">&quot;A column with an Identity object cannot specify &quot;</span>
</span><span data-line="6122">                <span class="s2">&quot;autoincrement=False&quot;</span>
</span><span data-line="6123">            <span class="p">)</span>
</span><span data-line="6124">        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">parent</span>
</span><span data-line="6125">
</span><span data-line="6126">        <span class="n">parent</span><span class="o">.</span><span class="n">identity</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="6127">        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">_user_defined_nullable</span> <span class="ow">is</span> <span class="n">NULL_UNSPECIFIED</span><span class="p">:</span>
</span><span data-line="6128">            <span class="n">parent</span><span class="o">.</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="6129">
</span><span data-line="6130">        <span class="n">parent</span><span class="o">.</span><span class="n">server_default</span> <span class="o">=</span> <span class="bp">self</span>
</span><span data-line="6131">
</span><span data-line="6132">    <span class="k">def</span> <span class="nf">_as_for_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_update</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FetchedValue</span><span class="p">:</span>
</span><span data-line="6133">        <span class="k">return</span> <span class="bp">self</span>
</span><span data-line="6134">
</span><span data-line="6135">    <span class="nd">@util</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span>
</span><span data-line="6136">        <span class="s2">&quot;1.4&quot;</span><span class="p">,</span>
</span><span data-line="6137">        <span class="s2">&quot;The :meth:`_schema.Identity.copy` method is deprecated &quot;</span>
</span><span data-line="6138">        <span class="s2">&quot;and will be removed in a future release.&quot;</span><span class="p">,</span>
</span><span data-line="6139">    <span class="p">)</span>
</span><span data-line="6140">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Identity</span><span class="p">:</span>
</span><span data-line="6141">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span data-line="6142">
</span><span data-line="6143">    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Identity</span><span class="p">:</span>
</span><span data-line="6144">        <span class="n">i</span> <span class="o">=</span> <span class="n">Identity</span><span class="p">(</span>
</span><span data-line="6145">            <span class="n">always</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">always</span><span class="p">,</span>
</span><span data-line="6146">            <span class="n">on_null</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_null</span><span class="p">,</span>
</span><span data-line="6147">            <span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
</span><span data-line="6148">            <span class="n">increment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increment</span><span class="p">,</span>
</span><span data-line="6149">            <span class="n">minvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minvalue</span><span class="p">,</span>
</span><span data-line="6150">            <span class="n">maxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxvalue</span><span class="p">,</span>
</span><span data-line="6151">            <span class="n">nominvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nominvalue</span><span class="p">,</span>
</span><span data-line="6152">            <span class="n">nomaxvalue</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nomaxvalue</span><span class="p">,</span>
</span><span data-line="6153">            <span class="n">cycle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span>
</span><span data-line="6154">            <span class="n">cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span>
</span><span data-line="6155">            <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
</span><span data-line="6156">        <span class="p">)</span>
</span><span data-line="6157">
</span><span data-line="6158">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_item_copy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024, Litestar Organization</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/litestar-org/advanced-alchemy" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a>
<a href="https://twitter.com/LitestarAPI" aria-label="X (Twitter)">
  <iconify-icon icon="prime:twitter"></iconify-icon>
</a>
<a href="https://discord.gg/litestar" aria-label="Discord">
  <iconify-icon icon="simple-icons:discord"></iconify-icon>
</a>
<a href="https://www.reddit.com/r/LitestarAPI" aria-label="Reddit">
  <iconify-icon icon="simple-icons:reddit"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=c6cf4326"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../_static/litestar-theme.js?v=ab2dcc9e"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../../_static/shibuya.js?v=e2e99575"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../../../_static/versioning.js"></script></body>
</html>